import{r as f,d as F,c as _,k as B,o as P,b as i,e as u,g as h,h as l,i as R,t as w,y as H,z as U,n as N,u as S,F as K,l as G,v as Q}from"./index-CAHFE_9E.js";import{g as J,d as W,A as V}from"./PathologistList.vue_vue_type_style_index_0_scoped_45f5ffeb_lang-FwbajLSj.js";import"./DiseaseList.vue_vue_type_style_index_0_scoped_2e8ef3ac_lang-CSxq79ax.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";class Y{async makeRequest(r,e={}){const o=W(r),v={headers:J(),...e};try{const y=await fetch(o,v);if(!y.ok){const E=await y.json().catch(()=>({}));throw new Error(E.detail||`HTTP error! status: ${y.status}`)}return await y.json()}catch(y){throw y}}async getEntities(){try{const r=await this.makeRequest(`${V.ENDPOINTS.ENTITIES}/`);return r.entidades&&Array.isArray(r.entidades)?r.entidades.map(e=>({codigo:e.EntidadCode||e.codigo||e.id||"",nombre:e.EntidadName||e.nombre||e.name||""})):Array.isArray(r)?r.map(e=>({codigo:e.EntidadCode||e.codigo||e.id||"",nombre:e.EntidadName||e.nombre||e.name||""})):[]}catch{return[]}}async getEntityByCode(r){try{const o=(await this.getEntities()).find(v=>v.codigo===r);if(o)return o;throw new Error(`Entidad con cÃ³digo ${r} no encontrada`)}catch(e){throw new Error(e.message||`Error al obtener la entidad ${r}`)}}async searchEntities(r){try{const e=await this.getEntities();if(!r.trim())return e;const o=r.toLowerCase().trim();return e.filter(v=>v.nombre.toLowerCase().includes(o)||v.codigo.toLowerCase().includes(o))}catch(e){throw new Error(e.message||"Error al buscar entidades")}}async createEntity(r){try{return{codigo:`ENT-${Date.now()}`,nombre:r.nombre}}catch(e){throw new Error(e.message||"Error al crear la entidad")}}async updateEntity(r,e){try{return{...await this.getEntityByCode(r),...e}}catch(o){throw new Error(o.message||`Error al actualizar la entidad ${r}`)}}async deleteEntity(r){try{return await this.getEntityByCode(r),{message:`Entidad ${r} eliminada exitosamente`}}catch(e){throw new Error(e.message||`Error al eliminar la entidad ${r}`)}}async checkBackendConnection(){try{const r=await this.makeRequest(V.ENDPOINTS.ENTITIES);return!0}catch{return!1}}}const Z=new Y;function ee(){const p=f(!1),r=f(""),e=f([]);return{isLoading:p,error:r,entities:e,loadEntities:async()=>{p.value=!0,r.value="";try{const d=await Z.getEntities();return e.value=d,{success:!0,message:"Entidades cargadas exitosamente",entities:e.value}}catch(d){const s=d.message||"Error al cargar entidades";return r.value=s,{success:!1,message:s,entities:[]}}finally{p.value=!1}},clearState:()=>{e.value=[],r.value="",p.value=!1},getEntityByCode:d=>e.value.find(s=>s.codigo===d),searchEntitiesByName:d=>{if(!d.trim())return e.value;const s=d.toLowerCase().trim();return e.value.filter(n=>n.nombre.toLowerCase().includes(s)||n.codigo.toLowerCase().includes(s))}}}const te={class:"entity-combobox"},re={key:0,class:"block text-sm font-medium text-gray-700 mb-1"},ae={key:0,class:"text-red-500 ml-1"},se={class:"relative"},oe={class:"relative"},le=["placeholder","disabled"],ne={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},ie={key:1,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},ue={key:0,class:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"},de={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},ce={key:1,class:"px-3 py-2 text-sm text-gray-500 text-center"},ve=["onClick","onMouseenter"],me={class:"flex items-center justify-between"},fe={class:"flex flex-col"},ye={class:"font-medium"},ge={key:0,class:"text-xs text-gray-500"},he={key:0,class:"h-4 w-4 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20"},pe={key:1,class:"mt-1 text-xs text-gray-500"},be={key:2,class:"mt-1 text-sm text-red-600"},we={key:3,class:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg"},Ee=F({__name:"EntityList",props:{modelValue:{default:""},label:{default:""},placeholder:{default:"Buscar y seleccionar entidad..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},helpText:{default:""},errors:{default:()=>[]},autoLoad:{type:Boolean,default:!0}},emits:["update:modelValue","entity-selected","load-error","load-success"],setup(p,{emit:r}){const e=p,o=r,{entities:v,loadEntities:y,isLoading:E}=ee(),d=f(),s=f(""),n=f(!1),c=f(-1),x=f(""),b=f(!1),g=f(e.modelValue),L=_(()=>Array.isArray(e.errors)?e.errors.join(", "):""),A=_(()=>Array.isArray(v.value)?v.value.map(t=>({value:t.codigo,label:t.nombre,entity:t})):[]),k=_(()=>{if(!s.value.trim())return A.value;const t=s.value.toLowerCase().trim();return A.value.filter(a=>{const m=a.label.toLowerCase(),C=a.entity;return m.includes(t)||C.nombre.toLowerCase().includes(t)||C.codigo.toLowerCase().includes(t)})}),T=_(()=>{if(!g.value)return null;const t=A.value.find(a=>a.value===g.value);return(t==null?void 0:t.entity)||null}),D=_(()=>b.value?s.value:g.value&&T.value?T.value.nombre:s.value),$=()=>{b.value=!0,s.value="",n.value=!0,c.value=-1},z=()=>{setTimeout(()=>{b.value=!1,n.value=!1,g.value||(s.value="")},150)},O=()=>{var t,a;e.disabled||(n.value?(t=d.value)==null||t.blur():(a=d.value)==null||a.focus())},I=t=>{var a;g.value=t.value,s.value="",n.value=!1,c.value=-1,o("update:modelValue",t.value),o("entity-selected",t.entity),(a=d.value)==null||a.blur()},j=t=>{var a;if(!e.disabled)switch(t.key){case"ArrowDown":t.preventDefault(),n.value||(n.value=!0),c.value=Math.min(c.value+1,k.value.length-1);break;case"ArrowUp":t.preventDefault(),n.value&&(c.value=Math.max(c.value-1,-1));break;case"Enter":t.preventDefault(),n.value&&c.value>=0&&k.value[c.value]&&I(k.value[c.value]);break;case"Escape":t.preventDefault(),n.value=!1,c.value=-1,(a=d.value)==null||a.blur();break;case"Tab":n.value=!1;break}},M=async()=>{try{x.value="";const t=await y();t.success?o("load-success",v.value):(x.value=t.message||"Error al cargar entidades",o("load-error",x.value))}catch(t){const a="Error al cargar la lista de entidades";x.value=a,o("load-error",a),console.error("Error al recargar entidades:",t)}};return B(()=>e.modelValue,t=>{g.value=t||""},{immediate:!0}),B(g,t=>{t!==e.modelValue&&o("update:modelValue",t)}),B(s,()=>{b.value&&s.value.trim()&&(n.value=!0,c.value=-1)}),P(async()=>{e.autoLoad&&v.value.length===0&&await M()}),B([D,b],()=>{b.value||Q(()=>{s.value=D.value})}),(t,a)=>(u(),i("div",te,[t.label?(u(),i("label",re,[R(w(t.label)+" ",1),t.required?(u(),i("span",ae,"*")):h("",!0)])):h("",!0),l("div",se,[l("div",oe,[H(l("input",{ref_key:"inputRef",ref:d,"onUpdate:modelValue":a[0]||(a[0]=m=>s.value=m),type:"text",placeholder:t.placeholder,disabled:t.disabled,class:N(["w-full px-3 py-2 pr-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-colors bg-white appearance-none",L.value?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300",t.disabled?"bg-gray-50 text-gray-500 cursor-not-allowed":"text-gray-900"]),onFocus:$,onBlur:z,onKeydown:j,autocomplete:"off"},null,42,le),[[U,s.value]]),S(E)?(u(),i("div",ne,[...a[1]||(a[1]=[l("svg",{class:"animate-spin h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24"},[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),l("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):(u(),i("div",ie,[(u(),i("svg",{class:N(["h-4 w-4 text-gray-400 cursor-pointer transition-transform",{"transform rotate-180":n.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:O},[...a[2]||(a[2]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]))]),n.value&&!t.disabled?(u(),i("div",ue,[S(E)?(u(),i("div",de," Cargando entidades... ")):k.value.length===0?(u(),i("div",ce,w(s.value.trim()?"No se encontraron entidades":"No hay entidades disponibles"),1)):h("",!0),(u(!0),i(K,null,G(k.value,(m,C)=>(u(),i("div",{key:m.value,class:N(["px-3 py-2 text-sm cursor-pointer transition-colors",C===c.value?"bg-blue-50 text-blue-900":"text-gray-900 hover:bg-gray-100",g.value===m.value?"bg-blue-100 text-blue-900 font-medium":""]),onClick:q=>I(m),onMouseenter:q=>c.value=C},[l("div",me,[l("div",fe,[l("span",ye,w(m.label),1),m.entity.codigo?(u(),i("span",ge,w(m.entity.codigo),1)):h("",!0)]),g.value===m.value?(u(),i("svg",he,[...a[3]||(a[3]=[l("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):h("",!0)])],42,ve))),128))])):h("",!0)]),t.helpText?(u(),i("p",pe,w(t.helpText),1)):h("",!0),L.value?(u(),i("p",be,w(L.value),1)):h("",!0),x.value?(u(),i("div",we,[l("div",{class:"flex items-center"},[a[5]||(a[5]=l("svg",{class:"w-5 h-5 text-amber-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),l("div",null,[a[4]||(a[4]=l("p",{class:"text-sm text-amber-800"},"No se pudieron cargar las entidades.",-1)),l("button",{onClick:M,class:"mt-1 text-sm text-amber-700 hover:text-amber-800 underline font-medium"}," Intentar cargar nuevamente ")])])])):h("",!0)]))}}),Be=X(Ee,[["__scopeId","data-v-74407efd"]]);export{Be as E,Z as e};
