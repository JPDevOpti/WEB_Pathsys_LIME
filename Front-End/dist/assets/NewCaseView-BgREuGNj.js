import{b as je}from"./PathologistList.vue_vue_type_style_index_0_scoped_45f5ffeb_lang-FwbajLSj.js";import{G as se,r as V,c as O,d as pe,k as he,j as D,e as _,w as Q,h as e,f as x,u as o,H as qe,t as f,v as Le,b as F,g as U,i as me,F as ue,l as ce,I as Ue,q as Oe}from"./index-CAHFE_9E.js";import{C as xe,_ as Ye}from"./DiseaseList.vue_vue_type_style_index_0_scoped_2e8ef3ac_lang-CSxq79ax.js";/* empty css                                                                   */import{u as ye}from"./useNotifications-DFiSmdMU.js";import{p as ne,u as He,B as Ke,_ as De,a as Ge}from"./BodyRegionList-BxiVbBtb.js";import{_ as K,a as Me}from"./SearchButton.vue_vue_type_script_setup_true_lang-y2wCoroa.js";import{F as ve}from"./FormSelect-Dz8sviG5.js";import{_ as Be,a as Ce}from"./Notification.vue_vue_type_script_setup_true_lang-Dr_eoe6-.js";import{_ as ge,a as _e}from"./ClearButton.vue_vue_type_script_setup_true_lang-iqMnWNPk.js";import{_ as we}from"./ValidationAlert.vue_vue_type_script_setup_true_lang-CKSrl8Ug.js";import{e as Re,E as ze}from"./EntityList-gIDUOf46.js";import{c as be}from"./casesApi.service-DwGpQD03.js";import{T as Je}from"./TestList-BA4OK-D1.js";import{u as We,P as Ze}from"./PathologistList-CbsQJHAr.js";import{u as Qe}from"./cases.store-BuW2t6qD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function Xe(){const h=se({numeroCedula:"",nombrePaciente:"",sexo:"",edad:"",entidad:"",tipoAtencion:"",observaciones:""}),m=se({hasAttemptedSubmit:!1,isValidating:!1,showValidationError:!1}),i=se({numeroCedula:[],nombrePaciente:[],edad:[]}),l=se({numeroCedula:[],edad:[]}),v=V(!1),w=()=>{const d=h.numeroCedula.trim();if(i.numeroCedula=[],l.numeroCedula=[],!d)return m.hasAttemptedSubmit&&i.numeroCedula.push("La c√©dula es obligatoria"),!1;if(!/^\d+$/.test(d))return i.numeroCedula.push("La c√©dula debe contener solo n√∫meros"),!1;if(d.length>10)return i.numeroCedula.push("La c√©dula no puede tener m√°s de 10 d√≠gitos"),!1;if(d.length>0&&d.length<6){const N=6-d.length;if(l.numeroCedula.push(`Faltan ${N} d√≠gito${N===1?"":"s"} para una c√©dula v√°lida`),m.hasAttemptedSubmit)return i.numeroCedula.push("La c√©dula debe tener al menos 6 d√≠gitos"),l.numeroCedula=[],!1}return!0},s=()=>{const d=h.nombrePaciente.trim();return i.nombrePaciente=[],d?d.length<2?(i.nombrePaciente.push("El nombre debe tener al menos 2 caracteres"),!1):d.split(/\s+/).filter(z=>z.length>0).length<2?(i.nombrePaciente.push("Ingrese el nombre completo (nombre y apellido)"),!1):/^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë√º√ú\s\-']+$/.test(d)?!0:(i.nombrePaciente.push("El nombre solo puede contener letras, espacios, guiones y apostrofes"),!1):(m.hasAttemptedSubmit&&i.nombrePaciente.push("El nombre del paciente es obligatorio"),!1)},u=()=>{const d=parseInt(h.edad);return i.edad=[],l.edad=[],!h.edad||isNaN(d)?(m.hasAttemptedSubmit&&i.edad.push("La edad es obligatoria"),!1):d<0?(i.edad.push("La edad no puede ser negativa"),!1):d>150?(i.edad.push("La edad no puede ser mayor a 150 a√±os"),!1):(d>120?l.edad.push("Edad muy alta, verifique que sea correcta"):d===0&&l.edad.push("¬øEs un reci√©n nacido? Considere usar meses si es menor a 1 a√±o"),!0)},y=()=>["sexo","entidad","tipoAtencion"].every(N=>h[N]),q=()=>{m.hasAttemptedSubmit=!0;const d=w(),N=s(),z=u(),T=y();return d&&N&&z&&T},C=d=>{const N=d.replace(/\D/g,"");h.numeroCedula=N,N.length>0?w():(i.numeroCedula=[],l.numeroCedula=[])},a=d=>{const N=d.replace(/\b\w/g,z=>z.toUpperCase());h.nombrePaciente=N,N.length>0?s():i.nombrePaciente=[]},n=d=>{const N=d.replace(/\D/g,"");h.edad=N,N.length>0?u():(i.edad=[],l.edad=[])},P=()=>{Object.keys(i).forEach(d=>{i[d]=[]}),Object.keys(l).forEach(d=>{l[d]=[]})},$=()=>{m.hasAttemptedSubmit=!1,m.showValidationError=!1,m.isValidating=!1},L=()=>{Object.keys(h).forEach(d=>{h[d]=""}),P(),$()},k=O(()=>{const d="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors";return i.numeroCedula.length>0?`${d} border-red-500 bg-red-50`:l.numeroCedula.length>0?`${d} border-yellow-500 bg-yellow-50`:h.numeroCedula&&i.numeroCedula.length===0?`${d} border-green-500 bg-green-50`:`${d} border-gray-300`}),A=O(()=>{const d="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors";return i.nombrePaciente.length>0?`${d} border-red-500 bg-red-50`:h.nombrePaciente&&i.nombrePaciente.length===0?`${d} border-green-500 bg-green-50`:`${d} border-gray-300`}),S=O(()=>{const d="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors";return i.edad.length>0?`${d} border-red-500 bg-red-50`:l.edad.length>0?`${d} border-yellow-500 bg-yellow-50`:h.edad&&i.edad.length===0?`${d} border-green-500 bg-green-50`:`${d} border-gray-300`});return{formData:h,validationState:m,errors:i,warnings:l,isLoading:v,validateForm:q,validateCedula:w,validateNombre:s,validateEdad:u,handleCedulaInput:C,handleNombreInput:a,handleEdadInput:n,clearForm:L,getCedulaFieldClasses:k,getNombreFieldClasses:A,getEdadFieldClasses:S}}function eo(){const h=V(!1),m=V(""),i=V(new Map),l=async a=>{if(console.log("üîç getEntityNameByCode llamado con c√≥digo:",a),i.value.has(a)){const n=i.value.get(a);return console.log("‚úÖ Nombre encontrado en cache:",n),n||a}try{console.log("üì° Llamando a la API para obtener entidad:",a);const n=await Re.getEntityByCode(a);console.log("üìã Respuesta de la API para entidad:",n);const P=n.nombre||a;return console.log("üè∑Ô∏è Nombre de entidad extra√≠do:",P),i.value.set(a,P),console.log("üíæ Entidad guardada en cache:",a,"->",P),P}catch(n){return console.error("üí• Error al obtener nombre de entidad:",a,n),console.warn(`No se pudo obtener el nombre de la entidad ${a}:`,n),a}},v=a=>{const n=a.toLowerCase();return n==="masculino"||n==="m"||n==="hombre"?"Masculino":n==="femenino"||n==="f"||n==="mujer"?"Femenino":"Masculino"},w=a=>{const n=a.toLowerCase();return n==="ambulatorio"||n==="ambulatoria"?"Ambulatorio":n==="hospitalizado"||n==="hospitalizada"||n==="hospitalizacion"?"Hospitalizado":"Ambulatorio"},s=async(a,n)=>{console.log("üîÑ transformCaseFormToApiRequest - Datos de entrada:",{entidadPaciente:a.entidadPaciente,entidadCodigo:n.entidadCodigo,entidad:n.entidad});let P=n.entidad;a.entidadPaciente&&(console.log("üè• Obteniendo nombre de entidad para c√≥digo:",a.entidadPaciente),P=await l(a.entidadPaciente),console.log("üè∑Ô∏è Nombre de entidad obtenido:",P));const $={paciente:{codigo:n.codigo||`PAC_${n.numeroCedula}`,cedula:n.numeroCedula,nombre:n.nombrePaciente,edad:parseInt(n.edad),sexo:v(n.sexo),entidad_info:{codigo:a.entidadPaciente||n.entidadCodigo||"ent_default",nombre:P},tipo_atencion:w(a.tipoAtencionPaciente),observaciones:n.observaciones||void 0},medico_solicitante:a.medicoSolicitante?{nombre:a.medicoSolicitante}:void 0,servicio:a.servicio||void 0,muestras:a.muestras.map(L=>({region_cuerpo:L.regionCuerpo,pruebas:L.pruebas.map(k=>({id:k.code,nombre:k.code,cantidad:k.cantidad||1}))})),estado:"En proceso",observaciones_generales:a.observaciones||void 0};return console.log("üì§ Datos finales enviados a la API:",JSON.stringify($,null,2)),$},u=(a,n,P)=>{var $,L,k,A,S,d,N,z,T,Y;return{id:a._id||a.CasoCode,codigo:a.CasoCode,paciente:{cedula:(($=a.paciente)==null?void 0:$.cedula)||n.numeroCedula,nombre:((L=a.paciente)==null?void 0:L.nombre)||n.nombrePaciente,edad:((k=a.paciente)==null?void 0:k.edad)||parseInt(n.edad),sexo:((A=a.paciente)==null?void 0:A.sexo)||n.sexo,entidad:((d=(S=a.paciente)==null?void 0:S.entidad_info)==null?void 0:d.nombre)||n.entidad,entidadCodigo:((z=(N=a.paciente)==null?void 0:N.entidad_info)==null?void 0:z.codigo)||P.entidadPaciente,tipoAtencion:((T=a.paciente)==null?void 0:T.tipo_atencion)||P.tipoAtencionPaciente},fechaIngreso:a.fecha_ingreso||P.fechaIngreso,medicoSolicitante:((Y=a.medico_solicitante)==null?void 0:Y.nombre)||P.medicoSolicitante,servicio:P.servicio,muestras:P.muestras,observaciones:a.observaciones_generales||P.observaciones||"",estado:a.estado||"Pendiente",fechaCreacion:a.fecha_ingreso||new Date().toISOString()}};return{isLoading:h,error:m,createCase:async(a,n)=>{h.value=!0,m.value="";try{if(!n)throw new Error("Informaci√≥n del paciente verificado requerida");const P=await s(a,n),$=await be.createCase(P);try{let k=n.entidad;a.entidadPaciente&&a.entidadPaciente!==n.entidadCodigo&&(k=await l(a.entidadPaciente));const A={numeroCedula:n.numeroCedula,nombrePaciente:n.nombrePaciente,sexo:n.sexo,edad:n.edad,entidad:k,entidadCodigo:a.entidadPaciente||n.entidadCodigo,tipoAtencion:a.tipoAtencionPaciente||n.tipoAtencion,observaciones:n.observaciones||""};await ne.updatePatient(n.numeroCedula,A),console.log("Paciente actualizado con nuevos valores del formulario:",{entidad:k,entidadCodigo:a.entidadPaciente,tipoAtencion:a.tipoAtencionPaciente})}catch(k){console.warn("El caso se cre√≥ pero fall√≥ la actualizaci√≥n del paciente:",k)}return{success:!0,codigo:$.CasoCode,message:"Caso creado exitosamente",case:u($,n,a)}}catch(P){return m.value=P.message||"Error desconocido al crear el caso",{success:!1,message:m.value}}finally{h.value=!1}},searchCases:async a=>{h.value=!0,m.value="";try{return{success:!0,cases:(await be.searchCases({query:a,limit:10})).casos}}catch(n){return m.value=n.message||"Error al buscar casos",{success:!1,message:m.value,cases:[]}}finally{h.value=!1}},clearState:()=>{m.value="",h.value=!1}}}function oo(){const h=V(!1),m=V(null),i=V(!1),l=se({totalCreated:0,lastCreatedId:null});async function v(a){h.value=!0,m.value=null,i.value=!1;try{const n=u(a);if(!n.isValid)throw new Error(n.errors.join(", "));if(await s(a.numeroCedula))throw new Error(`Ya existe un paciente registrado con la c√©dula ${a.numeroCedula}`);const $=await ne.createPatient(a);return y($.id),i.value=!0,{success:!0,patient:$,message:`Paciente ${$.nombre} registrado exitosamente`}}catch(n){return m.value=n.message||"Error desconocido al crear el paciente",{success:!1,patient:null,message:m.value}}finally{h.value=!1}}async function w(a){h.value=!0,m.value=null;try{const n=await ne.getPatientByCedula(a);return{success:!0,patient:n,found:n!==null}}catch(n){return m.value=n.message||"Error al buscar el paciente",{success:!1,patient:null,found:!1}}finally{h.value=!1}}async function s(a){try{return await ne.checkPatientExists(a)}catch{return!1}}function u(a){return ne.validatePatientData(a)}function y(a){l.totalCreated++,l.lastCreatedId=a}function q(){m.value=null,i.value=!1,h.value=!1}function C(){l.totalCreated=0,l.lastCreatedId=null}return{isLoading:h,error:m,success:i,stats:l,createPatient:v,findPatientByCedula:w,checkPatientExists:s,validatePatientData:u,clearState:q,resetStats:C}}function to(){const h=V(!1),m=V(""),i=V(!1),l=V(null),v=a=>{var L,k,A;const n=a.tipo_atencion||"",P=(()=>{const S=String(n).toLowerCase();return S.includes("ambulator")?"ambulatorio":S.includes("hospital")?"hospitalizado":""})(),$=((L=a.entidad_info)==null?void 0:L.codigo)||((k=a.entidad_info)==null?void 0:k.id);return{numeroCedula:a.cedula,nombrePaciente:a.nombre,sexo:a.sexo.toLowerCase(),edad:a.edad.toString(),entidad:((A=a.entidad_info)==null?void 0:A.nombre)||"Sin entidad",entidadCodigo:$,tipoAtencion:P,observaciones:a.observaciones,codigo:a.id}},w=async a=>{if(!a.trim())return m.value="La c√©dula es obligatoria",{found:!1};h.value=!0,m.value="";try{const n=await ne.getPatientByCedula(a);return n?y(n):q()}catch(n){return C(n)}finally{h.value=!1}},s=a=>{l.value=a,i.value=!0},u=()=>{i.value=!1,l.value=null,m.value="",h.value=!1},y=a=>{const n=v(a);return l.value=n,i.value=!0,{found:!0,patient:n}},q=()=>(m.value="Paciente no encontrado en el sistema",i.value=!1,l.value=null,{found:!1,message:"Paciente no encontrado"}),C=a=>(m.value=a.message||"Error al buscar el paciente",i.value=!1,l.value=null,{found:!1,error:m.value});return{isSearching:h,searchError:m,patientVerified:i,verifiedPatient:l,searchPatientByCedula:w,useNewPatient:s,clearVerification:u}}const ao={class:"space-y-6"},so={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},no={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},ro={class:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm"},lo={class:"space-y-4"},io={class:"mb-4 pb-3 border-b border-gray-100"},uo={class:"text-xl font-bold text-gray-900 mb-2"},co={class:"text-gray-600"},mo={class:"font-mono font-bold text-gray-800 ml-1"},go={class:"grid grid-cols-4 gap-6 text-sm"},po={class:"text-gray-800 font-semibold"},fo={class:"text-gray-800 font-semibold"},vo={class:"text-gray-800 font-semibold"},bo={class:"text-gray-800 font-semibold"},ho=pe({__name:"NewPatient",emits:["patient-saved","update-patient-data"],setup(h,{emit:m}){const i=V(null),l=V(null),v=V(null),w=V(0),{formData:s,errors:u,warnings:y,isLoading:q,validationState:C,handleCedulaInput:a,handleNombreInput:n,handleEdadInput:P,clearForm:$,validateForm:L}=Xe(),{notification:k,showNotification:A,closeNotification:S}=ye(),{createPatient:d,isLoading:N,error:z,clearState:T}=oo(),Y=[{value:"masculino",label:"Masculino"},{value:"femenino",label:"Femenino"}],re=[{value:"ambulatorio",label:"Ambulatorio"},{value:"hospitalizado",label:"Hospitalizado"}],oe=O(()=>q.value||N.value),le=O(()=>{var b,I,W;const E=[];return(!s.numeroCedula||((b=u.numeroCedula)==null?void 0:b.length)>0)&&E.push("C√©dula v√°lida requerida"),(!s.nombrePaciente||((I=u.nombrePaciente)==null?void 0:I.length)>0)&&E.push("Nombre completo requerido"),(!s.edad||((W=u.edad)==null?void 0:W.length)>0)&&E.push("Edad v√°lida requerida"),s.sexo||E.push("Sexo requerido"),s.entidad||E.push("Entidad requerida"),s.tipoAtencion||E.push("Tipo de atenci√≥n requerido"),E}),ie=O(()=>C.hasAttemptedSubmit&&!s.sexo?"Por favor seleccione el sexo":""),H=O(()=>C.hasAttemptedSubmit&&!s.entidad?"La entidad es obligatoria":""),G=O(()=>C.hasAttemptedSubmit&&!s.tipoAtencion?"Por favor seleccione el tipo de atenci√≥n":""),de=async()=>{await Le(),i.value&&i.value.scrollIntoView({behavior:"smooth",block:"center"})},te=E=>{v.value=E},r=()=>{$(),v.value=null,w.value++},c=async()=>{var b,I;if(!L()){C.showValidationError=!0;return}C.showValidationError=!1,T();try{const W={numeroCedula:s.numeroCedula,nombrePaciente:s.nombrePaciente,sexo:s.sexo,edad:String(s.edad),entidad:((b=v.value)==null?void 0:b.nombre)||s.entidad,entidadCodigo:(I=v.value)==null?void 0:I.codigo,tipoAtencion:s.tipoAtencion,observaciones:s.observaciones},ae=await d(W);if(ae.success&&ae.patient)await M(ae.patient,W);else throw new Error(ae.message||"Error desconocido al crear el paciente")}catch(W){await R(W)}},M=async(E,b)=>{l.value=E,A("success","¬°Paciente Registrado Exitosamente!","",15e3),J("patient-saved",b),$(),v.value=null,w.value++},R=async E=>{console.error("Error al guardar paciente:",E);const b=z.value||E.message||"No se pudo guardar el paciente. Por favor, int√©ntelo nuevamente.";A("error","Error al Guardar Paciente",b,0)};he(()=>k.visible,E=>{E&&de()});const J=m;return(E,b)=>(_(),D(xe,{title:"Ingresar un nuevo paciente al sistema",description:"Complete la informaci√≥n del paciente para ingresarlo al sistema."},{icon:Q(()=>[...b[7]||(b[7]=[e("svg",{class:"w-5 h-5 mr-2 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)])]),default:Q(()=>[e("div",ao,[x(K,{modelValue:o(s).numeroCedula,"onUpdate:modelValue":b[0]||(b[0]=I=>o(s).numeroCedula=I),label:"C√©dula",placeholder:"Ejemplo: 12345678",required:!0,"max-length":10,"show-counter":!0,errors:o(u).numeroCedula,warnings:o(y).numeroCedula,"is-validating":!1,inputmode:"numeric",onInput:o(a)},null,8,["modelValue","errors","warnings","onInput"]),x(K,{modelValue:o(s).nombrePaciente,"onUpdate:modelValue":b[1]||(b[1]=I=>o(s).nombrePaciente=I),label:"Nombre del Paciente",placeholder:"Ingrese el nombre completo del paciente",required:!0,"max-length":100,errors:o(u).nombrePaciente,onInput:o(n)},null,8,["modelValue","errors","onInput"]),e("div",so,[x(K,{modelValue:o(s).edad,"onUpdate:modelValue":b[2]||(b[2]=I=>o(s).edad=I),label:"Edad",placeholder:"Edad en a√±os",required:!0,"max-length":3,errors:o(u).edad,warnings:o(y).edad,inputmode:"numeric",onInput:o(P)},null,8,["modelValue","errors","warnings","onInput"]),x(ve,{modelValue:o(s).sexo,"onUpdate:modelValue":b[3]||(b[3]=I=>o(s).sexo=I),label:"Sexo",placeholder:"Seleccione el sexo",required:!0,options:Y,error:ie.value},null,8,["modelValue","error"])]),(_(),D(o(ze),{modelValue:o(s).entidad,"onUpdate:modelValue":b[4]||(b[4]=I=>o(s).entidad=I),label:"Entidad",placeholder:"Buscar entidad...",required:!0,"auto-load":!0,error:H.value,key:w.value,onEntitySelected:te},null,8,["modelValue","error"])),x(ve,{modelValue:o(s).tipoAtencion,"onUpdate:modelValue":b[5]||(b[5]=I=>o(s).tipoAtencion=I),label:"Tipo de Atenci√≥n",placeholder:"Seleccione el tipo de atenci√≥n",required:!0,options:re,error:G.value},null,8,["modelValue","error"]),x(Be,{modelValue:o(s).observaciones,"onUpdate:modelValue":b[6]||(b[6]=I=>o(s).observaciones=I),label:"Observaciones",placeholder:"Observaciones adicionales (opcional)",rows:3,"max-length":500,"show-counter":!0,"help-text":"Informaci√≥n adicional sobre el paciente o el caso"},null,8,["modelValue"]),e("div",no,[x(ge,{onClick:r,disabled:oe.value},null,8,["disabled"]),x(_e,{text:"Guardar Paciente",onClick:c,disabled:oe.value,loading:oe.value},null,8,["disabled","loading"])]),e("div",{ref_key:"notificationContainer",ref:i},[x(Ce,{visible:o(k).visible,type:o(k).type,title:o(k).title,message:o(k).message,inline:!0,"auto-close":!1,onClose:o(S)},qe({_:2},[o(k).type==="success"&&l.value?{name:"content",fn:Q(()=>{var I;return[e("div",ro,[e("div",lo,[e("div",io,[e("h3",uo,f(l.value.nombre),1),e("p",co,[b[8]||(b[8]=e("span",{class:"font-medium"},"C√©dula:",-1)),e("span",mo,f(l.value.cedula),1)])]),e("div",go,[e("div",null,[b[9]||(b[9]=e("span",{class:"text-gray-500 font-medium block mb-1"},"Edad:",-1)),e("p",po,f(l.value.edad)+" a√±os",1)]),e("div",null,[b[10]||(b[10]=e("span",{class:"text-gray-500 font-medium block mb-1"},"Sexo:",-1)),e("p",fo,f(l.value.sexo),1)]),e("div",null,[b[11]||(b[11]=e("span",{class:"text-gray-500 font-medium block mb-1"},"Entidad:",-1)),e("p",vo,f((I=l.value.entidad_info)==null?void 0:I.nombre),1)]),e("div",null,[b[12]||(b[12]=e("span",{class:"text-gray-500 font-medium block mb-1"},"Atenci√≥n:",-1)),e("p",bo,f(l.value.tipo_atencion),1)])])])])]}),key:"0"}:void 0]),1032,["visible","type","title","message","onClose"])],512),x(we,{visible:o(C).showValidationError,errors:le.value},null,8,["visible","errors"])])]),_:1}))}}),xo={class:"space-y-6"},yo={class:"bg-gray-50 rounded-lg p-3 sm:p-4 lg:p-6 border border-gray-200"},Co={class:"flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch sm:items-end"},_o={class:"flex-1"},wo={class:"flex gap-2 sm:gap-3"},Po={key:0,class:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg"},Eo={class:"text-sm text-red-600"},Vo={key:1,class:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg"},ko={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 text-sm"},So={class:"text-green-800 break-words"},$o={class:"text-green-800 font-mono"},Ao={class:"text-green-800"},No={class:"text-green-800"},Io={class:"text-green-800 break-words"},Fo={class:"text-green-800 break-words"},qo={key:0,class:"space-y-6"},Lo={class:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6"},Mo={class:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6"},Bo={class:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6"},zo={class:"space-y-4"},To={class:"space-y-6"},jo={class:"font-medium text-gray-700 mb-4"},Uo={class:"mb-4"},Oo={class:"space-y-3"},Yo={class:"flex items-center justify-between"},Ho={class:"space-y-2"},Ko={class:"flex-1 min-w-0"},Do={class:"w-full sm:w-24"},Go={class:"flex items-center justify-center sm:justify-start sm:w-10 sm:mt-6"},Ro={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},Jo={class:"list-disc list-inside space-y-1"},Wo={class:"flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t border-gray-200"},Zo={class:"relative p-4 sm:p-5 bg-white border border-gray-200 rounded-lg shadow-sm"},Qo={class:"space-y-4"},Xo={class:"text-center pb-3 border-b border-gray-200"},et={class:"inline-block"},ot={class:"font-mono font-bold text-2xl text-gray-900 mb-1"},tt={class:"text-gray-500 text-sm"},at={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},st={class:"space-y-2 text-sm"},nt={class:"text-gray-900 font-semibold"},rt={class:"text-gray-900 font-mono font-semibold"},lt={class:"text-gray-900 font-semibold"},it={class:"text-gray-900 font-semibold"},dt={class:"text-gray-900 font-semibold"},ut={class:"text-gray-900 font-semibold"},ct={class:"space-y-2 text-sm"},mt={class:"text-gray-900 font-semibold"},gt={class:"text-gray-900 font-semibold"},pt={class:"text-gray-900 font-semibold"},ft={class:"text-gray-900 font-semibold"},vt={key:0},bt={class:"text-gray-900"},ht={class:"space-y-3"},xt={class:"flex items-center justify-between mb-2"},yt={class:"font-medium text-gray-900 text-sm"},Ct={class:"text-sm text-gray-500"},_t={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm"},wt={class:"text-gray-900"},Pt={class:"text-gray-900"},Et={key:0},Vt={key:1,class:"text-gray-400"},kt=pe({__name:"NewCase",emits:["case-saved","patient-verified"],setup(h,{expose:m,emit:i}){const l=V(null),v=V(null),w=i,{formData:s,validationState:u,errors:y,warnings:q,isFormValid:C,validateForm:a,clearForm:n,handleNumeroMuestrasChange:P,addPruebaToMuestra:$,removePruebaFromMuestra:L}=He(),{searchError:k,patientVerified:A,verifiedPatient:S,searchPatientByCedula:d,useNewPatient:N,clearVerification:z}=to(),{notification:T,showNotification:Y,closeNotification:re}=ye(),{createCase:oe,error:le,clearState:ie}=eo(),H=V(""),G=[{value:"ambulatorio",label:"Ambulatorio"},{value:"hospitalizado",label:"Hospitalizado"}],de=O(()=>{var t,p,B,j;const g=[];return A.value||g.push("Debe verificar un paciente antes de crear el caso"),(!s.fechaIngreso||((t=y.fechaIngreso)==null?void 0:t.length)>0)&&g.push("Fecha de ingreso v√°lida requerida"),((p=y.medicoSolicitante)==null?void 0:p.length)>0&&g.push("M√©dico solicitante debe tener formato v√°lido"),(!s.numeroMuestras||((B=y.numeroMuestras)==null?void 0:B.length)>0)&&g.push("N√∫mero de muestras v√°lido requerido"),((j=y.muestras)==null?void 0:j.length)>0&&g.push("Complete la informaci√≥n de todas las submuestras"),s.entidadPaciente||g.push("Entidad requerida"),s.tipoAtencionPaciente||g.push("Tipo de atenci√≥n requerido"),g}),te=g=>{if(!g)return"";let t;const p=/^\d{4}-\d{2}-\d{2}$/.test(String(g));if(p?t=new Date(`${g}T00:00:00`):t=new Date(String(g)),isNaN(t.getTime()))return String(g);const B=new Intl.DateTimeFormat("es-CO",{day:"2-digit",month:"long",year:"numeric"}).format(t);if(p)return B;const j=new Intl.DateTimeFormat("es-CO",{hour:"2-digit",minute:"2-digit"}).format(t);return`${B} ${j}`},r=O(()=>{var t;const g=((t=v.value)==null?void 0:t.fechaIngreso)||s.fechaIngreso;return te(g)}),c=g=>{const t=g.replace(/\D/g,"");H.value=t},M=(g,t,p)=>{if(p&&g>=0&&g<s.muestras.length){const B=s.muestras[g];t>=0&&t<B.pruebas.length&&(B.pruebas[t].code=p.pruebaCode,B.pruebas[t].nombre=p.pruebasName)}},R=async()=>{if(!H.value.trim())return;const g=await d(H.value);if(g.found&&"patient"in g&&g.patient){const t=g.patient;E(t),w("patient-verified",t)}},J=g=>{const t=String(g||"").toLowerCase();return t.includes("ambulator")?"ambulatorio":t.includes("hospital")?"hospitalizado":""},E=g=>{s.pacienteCedula=g.numeroCedula,s.entidadPaciente=g.entidadCodigo||"",s.tipoAtencionPaciente=J(g.tipoAtencion)},b=()=>{s.pacienteCedula="",s.entidadPaciente="",s.tipoAtencionPaciente="",s.servicio=""},I=()=>{z(),H.value="",b()},W=g=>{N(g),H.value=g.numeroCedula,E(g),w("patient-verified",g)},ae=async()=>{await Le(),l.value&&l.value.scrollIntoView({behavior:"smooth",block:"center"})};he(()=>T.visible,g=>{g&&ae()});const Pe=()=>{n(),I()},Te=async()=>{if(!A.value||!S.value){u.showValidationError=!0;return}if(!a()){u.showValidationError=!0;return}u.showValidationError=!1,ie();try{const t=await oe(s,S.value);if(t.success&&t.case)v.value=t.case,Y("success","¬°Caso Creado Exitosamente!","",0),w("case-saved",t.case),Pe();else throw new Error(t.message||"Error desconocido al crear el caso")}catch(t){const p=le.value||t.message||"No se pudo guardar el caso. Por favor, int√©ntelo nuevamente.";Y("error","Error al Guardar Caso",p,0)}};return m({handleNewPatient:W}),(g,t)=>(_(),D(xe,{title:"Crear nuevo caso",description:"Complete la informaci√≥n del caso para ingresarlo al sistema."},{icon:Q(()=>[...t[8]||(t[8]=[e("svg",{class:"w-5 h-5 mr-2 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])]),default:Q(()=>[e("div",xo,[e("div",yo,[t[16]||(t[16]=e("h3",{class:"text-sm font-semibold text-gray-700 mb-3 flex items-center"},[e("svg",{class:"w-4 h-4 mr-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})]),me(" Buscar Paciente ")],-1)),e("div",Co,[e("div",_o,[x(K,{modelValue:H.value,"onUpdate:modelValue":t[0]||(t[0]=p=>H.value=p),placeholder:"Ingrese n√∫mero de c√©dula",required:!0,"max-length":10,inputmode:"numeric",disabled:o(A),onInput:c},null,8,["modelValue","disabled"])]),e("div",wo,[o(A)?U("",!0):(_(),D(Me,{key:0,text:"Buscar","loading-text":"Buscando...",onClick:R,size:"md"})),o(A)?(_(),D(ge,{key:1,text:"Limpiar",onClick:I})):U("",!0)])]),o(k)?(_(),F("div",Po,[e("p",Eo,f(o(k)),1)])):U("",!0),o(A)&&o(S)?(_(),F("div",Vo,[t[15]||(t[15]=e("div",{class:"flex items-center mb-3"},[e("svg",{class:"w-5 h-5 text-green-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("h4",{class:"text-sm font-semibold text-green-800"},"Paciente Verificado")],-1)),e("div",ko,[e("div",null,[t[9]||(t[9]=e("span",{class:"font-medium text-green-700"},"Nombre:",-1)),e("p",So,f(o(S).nombrePaciente),1)]),e("div",null,[t[10]||(t[10]=e("span",{class:"font-medium text-green-700"},"C√©dula:",-1)),e("p",$o,f(o(S).numeroCedula),1)]),e("div",null,[t[11]||(t[11]=e("span",{class:"font-medium text-green-700"},"Edad:",-1)),e("p",Ao,f(o(S).edad)+" a√±os",1)]),e("div",null,[t[12]||(t[12]=e("span",{class:"font-medium text-green-700"},"Sexo:",-1)),e("p",No,f(o(S).sexo),1)]),e("div",null,[t[13]||(t[13]=e("span",{class:"font-medium text-green-700"},"Entidad:",-1)),e("p",Io,f(o(S).entidad),1)]),e("div",null,[t[14]||(t[14]=e("span",{class:"font-medium text-green-700"},"Tipo de Atenci√≥n:",-1)),e("p",Fo,f(o(S).tipoAtencion),1)])])])):U("",!0)]),o(A)?(_(),F("div",qo,[e("div",Lo,[x(K,{modelValue:o(s).medicoSolicitante,"onUpdate:modelValue":t[1]||(t[1]=p=>o(s).medicoSolicitante=p),label:"M√©dico Solicitante",placeholder:"M√©dico que solicita el estudio",required:!1,"max-length":100,errors:o(y).medicoSolicitante,warnings:o(q).medicoSolicitante},null,8,["modelValue","errors","warnings"]),x(K,{modelValue:o(s).servicio,"onUpdate:modelValue":t[2]||(t[2]=p=>o(s).servicio=p),label:"Servicio",placeholder:"Procedencia del caso",required:!1,"max-length":100,errors:o(y).servicio,warnings:o(q).servicio},null,8,["modelValue","errors","warnings"])]),e("div",Mo,[x(o(ze),{modelValue:o(s).entidadPaciente,"onUpdate:modelValue":t[3]||(t[3]=p=>o(s).entidadPaciente=p),label:"Entidad del Paciente",placeholder:"Buscar entidad...",required:!0,"auto-load":!0,error:o(u).hasAttemptedSubmit&&!o(s).entidadPaciente?"La entidad es obligatoria":""},null,8,["modelValue","error"]),x(ve,{modelValue:o(s).tipoAtencionPaciente,"onUpdate:modelValue":t[4]||(t[4]=p=>o(s).tipoAtencionPaciente=p),label:"Tipo de Atenci√≥n",placeholder:"Seleccione el tipo de atenci√≥n",required:!0,options:G,error:o(u).hasAttemptedSubmit&&!o(s).tipoAtencionPaciente?"Por favor seleccione el tipo de atenci√≥n":""},null,8,["modelValue","error"])]),e("div",Bo,[x(K,{modelValue:o(s).numeroMuestras,"onUpdate:modelValue":t[5]||(t[5]=p=>o(s).numeroMuestras=p),label:"N√∫mero de Muestras",type:"number",min:1,max:10,required:!0,errors:o(y).numeroMuestras,warnings:o(q).numeroMuestras,"help-text":"Cantidad de submuestras para este caso (m√°ximo 10)",onInput:o(P)},null,8,["modelValue","errors","warnings","onInput"]),x(K,{modelValue:o(s).fechaIngreso,"onUpdate:modelValue":t[6]||(t[6]=p=>o(s).fechaIngreso=p),label:"Fecha de Ingreso",type:"date",required:!0,errors:o(y).fechaIngreso,warnings:o(q).fechaIngreso,"help-text":"Fecha en que ingresa el caso al sistema"},null,8,["modelValue","errors","warnings"])]),e("div",zo,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold text-gray-800 flex items-center"},[e("svg",{class:"w-5 h-5 mr-2 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})]),me(" Informaci√≥n de Submuestras ")],-1)),e("div",To,[(_(!0),F(ue,null,ce(o(s).muestras,(p,B)=>(_(),F("div",{key:p.numero,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},[e("h4",jo," Submuestra "+f(p.numero),1),e("div",Uo,[x(o(Ke),{modelValue:p.regionCuerpo,"onUpdate:modelValue":j=>p.regionCuerpo=j,label:`Regi√≥n del Cuerpo - Submuestra ${p.numero}`,placeholder:"Buscar regi√≥n del cuerpo...",required:!0,"auto-load":!0,"help-text":"Seleccione la regi√≥n anat√≥mica de donde proviene la muestra"},null,8,["modelValue","onUpdate:modelValue","label"])]),e("div",Oo,[e("div",Yo,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700"},[me(" Pruebas a Realizar "),e("span",{class:"text-red-500"},"*")],-1)),x(De,{text:"Agregar Prueba",onClick:j=>o($)(B)},null,8,["onClick"])]),e("div",Ho,[(_(!0),F(ue,null,ce(p.pruebas,(j,X)=>(_(),F("div",{key:X,class:"flex flex-col sm:flex-row gap-2 sm:gap-3 items-stretch sm:items-center"},[e("div",Ko,[x(o(Je),{modelValue:j.code,"onUpdate:modelValue":Z=>j.code=Z,label:`Prueba ${X+1}`,placeholder:`Buscar y seleccionar prueba ${X+1}...`,required:!0,"auto-load":!0,onTestSelected:Z=>M(B,X,Z)},null,8,["modelValue","onUpdate:modelValue","label","placeholder","onTestSelected"])]),e("div",Do,[x(K,{modelValue:j.cantidad,"onUpdate:modelValue":Z=>j.cantidad=Z,modelModifiers:{number:!0},label:"Cantidad",type:"number",min:1,max:10,placeholder:"Cantidad"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",Go,[p.pruebas.length>1?(_(),D(Ge,{key:0,onClick:Z=>o(L)(B,X),title:"Eliminar prueba"},null,8,["onClick"])):U("",!0)])]))),128))])])]))),128))])]),x(Be,{modelValue:o(s).observaciones,"onUpdate:modelValue":t[7]||(t[7]=p=>o(s).observaciones=p),label:"Observaciones del Caso",placeholder:"Observaciones adicionales sobre el caso o procedimiento...",rows:3,"max-length":500,"show-counter":!0,"help-text":"Informaci√≥n adicional relevante para el procesamiento del caso"},null,8,["modelValue"]),o(y).muestras.length>0?(_(),F("div",Ro,[t[19]||(t[19]=e("h4",{class:"text-sm font-semibold text-red-800 mb-2"},"Errores en las Submuestras:",-1)),e("ul",Jo,[(_(!0),F(ue,null,ce(o(y).muestras,p=>(_(),F("li",{key:p,class:"text-sm text-red-600"},f(p),1))),128))])])):U("",!0),e("div",Wo,[x(ge,{onClick:Pe}),x(_e,{text:"Guardar Caso",onClick:Te,disabled:!o(C)},null,8,["disabled"])]),x(we,{visible:o(u).showValidationError,errors:de.value},null,8,["visible","errors"])])):U("",!0),e("div",{ref_key:"notificationContainer",ref:l},[x(Ce,{visible:o(T).visible,type:o(T).type,title:o(T).title,message:o(T).message,inline:!0,"auto-close":!1,onClose:o(re)},qe({_:2},[o(T).type==="success"&&v.value?{name:"content",fn:Q(()=>{var p,B,j,X,Z,Ee,Ve,ke,Se,$e,Ae,Ne,Ie;return[e("div",Zo,[e("div",Qo,[e("div",Xo,[e("div",et,[e("p",ot,f(v.value.codigo),1),e("p",tt,f(r.value),1)])]),e("div",at,[e("div",null,[t[26]||(t[26]=e("h4",{class:"font-semibold text-gray-800 mb-3 text-base"},"Informaci√≥n del Paciente",-1)),e("div",st,[e("div",null,[t[20]||(t[20]=e("span",{class:"text-gray-500 font-medium"},"Nombre:",-1)),e("p",nt,f(((p=v.value.paciente)==null?void 0:p.nombre)||((B=o(S))==null?void 0:B.nombrePaciente)),1)]),e("div",null,[t[21]||(t[21]=e("span",{class:"text-gray-500 font-medium"},"C√©dula:",-1)),e("p",rt,f(((j=v.value.paciente)==null?void 0:j.cedula)||((X=o(S))==null?void 0:X.numeroCedula)),1)]),e("div",null,[t[22]||(t[22]=e("span",{class:"text-gray-500 font-medium"},"Edad:",-1)),e("p",lt,f(((Z=v.value.paciente)==null?void 0:Z.edad)||((Ee=o(S))==null?void 0:Ee.edad))+" a√±os",1)]),e("div",null,[t[23]||(t[23]=e("span",{class:"text-gray-500 font-medium"},"Sexo:",-1)),e("p",it,f(((Ve=v.value.paciente)==null?void 0:Ve.sexo)||((ke=o(S))==null?void 0:ke.sexo)),1)]),e("div",null,[t[24]||(t[24]=e("span",{class:"text-gray-500 font-medium"},"Entidad:",-1)),e("p",dt,f(((Se=v.value.paciente)==null?void 0:Se.entidad)||(($e=o(S))==null?void 0:$e.entidad)),1)]),e("div",null,[t[25]||(t[25]=e("span",{class:"text-gray-500 font-medium"},"Tipo de Atenci√≥n:",-1)),e("p",ut,f(((Ae=v.value.paciente)==null?void 0:Ae.tipoAtencion)||((Ne=o(S))==null?void 0:Ne.tipoAtencion)),1)])])]),e("div",null,[t[32]||(t[32]=e("h4",{class:"font-semibold text-gray-800 mb-3 text-base"},"Detalles del Caso",-1)),e("div",ct,[e("div",null,[t[27]||(t[27]=e("span",{class:"text-gray-500 font-medium"},"Estado:",-1)),e("p",mt,f(v.value.estado||"Pendiente"),1)]),e("div",null,[t[28]||(t[28]=e("span",{class:"text-gray-500 font-medium"},"M√©dico Solicitante:",-1)),e("p",gt,f(v.value.medicoSolicitante||o(s).medicoSolicitante),1)]),e("div",null,[t[29]||(t[29]=e("span",{class:"text-gray-500 font-medium"},"Servicio:",-1)),e("p",pt,f(v.value.servicio||o(s).servicio||"No especificado"),1)]),e("div",null,[t[30]||(t[30]=e("span",{class:"text-gray-500 font-medium"},"N√∫mero de Submuestras:",-1)),e("p",ft,f(((Ie=v.value.muestras)==null?void 0:Ie.length)||o(s).muestras.length),1)]),v.value.observaciones||o(s).observaciones?(_(),F("div",vt,[t[31]||(t[31]=e("span",{class:"text-gray-500 font-medium"},"Observaciones:",-1)),e("p",bt,f(v.value.observaciones||o(s).observaciones),1)])):U("",!0)])])]),e("div",null,[t[35]||(t[35]=e("h4",{class:"font-semibold text-gray-800 mb-3 text-base"},"Submuestras Creadas",-1)),e("div",ht,[(_(!0),F(ue,null,ce(v.value.muestras||o(s).muestras,(ee,Fe)=>(_(),F("div",{key:Fe,class:"border border-gray-200 rounded-lg p-3 bg-gray-50"},[e("div",xt,[e("span",yt,"Submuestra "+f(Fe+1),1),e("span",Ct,f(ee.pruebas&&ee.pruebas.length||0)+" prueba"+f((ee.pruebas&&ee.pruebas.length||0)!==1?"s":""),1)]),e("div",_t,[e("div",null,[t[33]||(t[33]=e("span",{class:"text-gray-500 font-medium"},"Regi√≥n:",-1)),e("p",wt,f(ee.regionCuerpo||"Sin especificar"),1)]),e("div",null,[t[34]||(t[34]=e("span",{class:"text-gray-500 font-medium"},"Pruebas:",-1)),e("div",Pt,[ee.pruebas&&ee.pruebas.length>0?(_(),F("span",Et,f(ee.pruebas.map(fe=>`${fe.code||fe.nombre||"Sin c√≥digo"} (${fe.cantidad||1})`).join(", ")),1)):(_(),F("span",Vt,"Sin pruebas"))])])])]))),128))])])])])]}),key:"0"}:void 0]),1032,["visible","type","title","message","onClose"])],512)])]),_:1}))}}),St={class:"space-y-6"},$t={class:"bg-gray-50 rounded-lg p-3 sm:p-4 lg:p-6 border border-gray-200"},At={class:"flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch sm:items-end"},Nt={class:"flex-1"},It={key:0,class:"mt-1 text-xs text-red-600"},Ft={class:"flex gap-2 sm:gap-3"},qt={key:0,class:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg"},Lt={class:"flex items-center"},Mt={class:"text-sm text-red-600"},Bt={key:1,class:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg"},zt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 text-sm"},Tt={class:"text-green-800 font-mono"},jt={class:"text-green-800"},Ut={class:"text-green-800 break-words"},Ot={class:"text-green-800 font-mono"},Yt={class:"text-green-800 break-words"},Ht={class:"text-green-800 break-words"},Kt={key:0,class:"mt-3"},Dt={class:"flex flex-wrap gap-2 mt-1"},Gt={key:0,class:"space-y-6"},Rt={class:"bg-white border border-gray-200 rounded-lg p-3 sm:p-4 lg:p-6"},Jt={class:"max-w-md"},Wt={class:"flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t border-gray-200"},Zt=pe({__name:"CasePathologist",emits:["patologo-asignado"],setup(h,{expose:m,emit:i}){const l=V(""),v=V(!1),w=V(!1),s=V(""),u=V(null),y=se({patologoId:"",fechaAsignacion:""}),q=V(!1),C=V(!1),a=V(!1),n=V(null),{assignPathologist:P}=We(),{notification:$,showNotification:L,closeNotification:k}=ye(),A=O(()=>w.value&&y.patologoId.trim()!==""),S=O(()=>{const r={patologoId:[]};return q.value&&!y.patologoId&&r.patologoId.push("Debe seleccionar un pat√≥logo"),r}),d=O(()=>{const r=[];return w.value||r.push("Debe buscar y encontrar un caso primero"),y.patologoId||r.push("Debe seleccionar un pat√≥logo"),r}),N=O(()=>{var r;return(r=u.value)!=null&&r.patologo_asignado?"Reasignar Pat√≥logo":"Asignar Pat√≥logo"}),z=r=>!r||typeof r!="string"||r.trim()===""?!1:/^\d{4}-\d{5}$/.test(r.trim()),T=r=>{r=r.replace(/[^\d-]/g,""),r=r.slice(0,10),r.length>=4&&!r.includes("-")&&(r=r.slice(0,4)+"-"+r.slice(4));const c=r.split("-");if(c.length>2&&(r=c[0]+"-"+c.slice(1).join("")),r.includes("-")&&r.indexOf("-")!==4){const M=r.replace(/-/g,"");M.length>=4?r=M.slice(0,4)+"-"+M.slice(4,9):r=M}l.value=r},Y=async()=>{if(!l.value.trim()){s.value="Por favor, ingrese un c√≥digo de caso";return}if(!z(l.value)){s.value="El c√≥digo debe tener el formato YYYY-NNNNN (Ejemplo: 2025-00001)";return}v.value=!0,s.value="",w.value=!1;try{const r=await be.getCaseByCode(l.value.trim());w.value=!0,u.value=r}catch(r){console.error("‚ùå Error al buscar caso:",r),w.value=!1,u.value=null,s.value=re(r)}finally{v.value=!1}},re=r=>r.message.includes("404")||r.message.includes("no encontrado")?`No existe un caso con el c√≥digo "${l.value}"`:r.message.includes("400")?"Formato de c√≥digo de caso inv√°lido":r.message.includes("500")?"Error interno del servidor. Int√©ntelo m√°s tarde.":"Error al buscar el caso. Int√©ntelo nuevamente.",oe=async()=>{if(!(!A.value||!u.value)){a.value=!0;try{const r=await P(u.value.CasoCode,{patologoId:y.patologoId,fechaAsignacion:new Date().toISOString().split("T")[0]});if(r.success)await le(r);else throw new Error(r.message||"Error al asignar pat√≥logo")}catch(r){await ie(r)}finally{a.value=!1}}},le=async r=>{var M,R,J,E;(M=r.assignment)!=null&&M.pathologist&&u.value&&(u.value.patologo_asignado={codigo:r.assignment.pathologist.id,nombre:r.assignment.pathologist.nombre});const c=(R=u.value)!=null&&R.patologo_asignado?"reasignado":"asignado";L("success",`¬°Pat√≥logo ${c} exitosamente!`,`El pat√≥logo ha sido ${c} al caso ${(J=u.value)==null?void 0:J.CasoCode} correctamente.`,0),te("patologo-asignado",{codigoCaso:((E=u.value)==null?void 0:E.CasoCode)||"",patologo:y.patologoId}),G()},ie=async r=>{var c,M;console.error("‚ùå Error al asignar pat√≥logo:",r),H(r.message)?(L("success","¬°Pat√≥logo reasignado exitosamente!",`El pat√≥logo ha sido reasignado al caso ${(c=u.value)==null?void 0:c.CasoCode} correctamente.`,0),te("patologo-asignado",{codigoCaso:((M=u.value)==null?void 0:M.CasoCode)||"",patologo:y.patologoId}),G()):L("error","Error al Asignar Pat√≥logo",r.message||"No se pudo asignar el pat√≥logo. Por favor, int√©ntelo nuevamente.",0)},H=r=>["ya tiene","already","asignado","assigned"].some(M=>r.includes(M)),G=()=>{l.value="",w.value=!1,s.value="",u.value=null,y.patologoId="",y.fechaAsignacion="",C.value=!1,q.value=!1},de=()=>{if(q.value=!0,!A.value){C.value=!0;return}C.value=!1,oe()};he([()=>y.patologoId,w],()=>{C.value&&A.value&&(C.value=!1)});const te=i;return m({limpiarFormulario:G,buscarCaso:Y}),(r,c)=>(_(),D(xe,{title:"Asignaci√≥n de pat√≥logo a un caso",description:"Busque un caso y asigne un pat√≥logo responsable para el an√°lisis."},{icon:Q(()=>[...c[2]||(c[2]=[e("svg",{class:"w-5 h-5 mr-2 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)])]),default:Q(()=>{var M,R,J;return[e("div",St,[e("div",$t,[c[12]||(c[12]=e("h3",{class:"text-sm font-semibold text-gray-700 mb-3 flex items-center"},[e("svg",{class:"w-4 h-4 mr-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})]),me(" Buscar Caso ")],-1)),e("div",At,[e("div",Nt,[x(K,{id:"codigo-caso",modelValue:l.value,"onUpdate:modelValue":[c[0]||(c[0]=E=>l.value=E),T],type:"text",placeholder:"Ej: 2025-00001",maxlength:"10",autocomplete:"off",disabled:v.value,onKeydown:Ue(Oe(Y,["prevent"]),["enter"]),class:"flex-1"},null,8,["modelValue","disabled","onKeydown"]),l.value&&!z(l.value)?(_(),F("div",It," El c√≥digo debe tener el formato YYYY-NNNNN (Ejemplo: 2025-00001) ")):U("",!0)]),e("div",Ft,[w.value?U("",!0):(_(),D(Me,{key:0,text:"Buscar","loading-text":"Buscando...",loading:v.value,onClick:Y,size:"md",variant:"primary"},null,8,["loading"])),w.value?(_(),D(ge,{key:1,text:"Limpiar",onClick:G})):U("",!0)])]),s.value?(_(),F("div",qt,[e("div",Lt,[c[3]||(c[3]=e("svg",{class:"w-5 h-5 text-red-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("p",Mt,f(s.value),1)])])):U("",!0),w.value&&u.value?(_(),F("div",Bt,[c[11]||(c[11]=e("div",{class:"flex items-center mb-3"},[e("svg",{class:"w-5 h-5 text-green-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("h4",{class:"text-sm font-semibold text-green-800"},"Caso Encontrado")],-1)),e("div",zt,[e("div",null,[c[4]||(c[4]=e("span",{class:"font-medium text-green-700"},"C√≥digo:",-1)),e("p",Tt,f(u.value.CasoCode),1)]),e("div",null,[c[5]||(c[5]=e("span",{class:"font-medium text-green-700"},"Estado:",-1)),e("p",jt,f(u.value.estado),1)]),e("div",null,[c[6]||(c[6]=e("span",{class:"font-medium text-green-700"},"Paciente:",-1)),e("p",Ut,f(u.value.paciente.nombre),1)]),e("div",null,[c[7]||(c[7]=e("span",{class:"font-medium text-green-700"},"C√©dula:",-1)),e("p",Ot,f(u.value.paciente.cedula),1)]),e("div",null,[c[8]||(c[8]=e("span",{class:"font-medium text-green-700"},"Entidad:",-1)),e("p",Yt,f(((M=u.value.paciente.entidad_info)==null?void 0:M.nombre)||"N/A"),1)]),e("div",null,[c[9]||(c[9]=e("span",{class:"font-medium text-green-700"},"Pat√≥logo Actual:",-1)),e("p",Ht,f(((R=u.value.patologo_asignado)==null?void 0:R.nombre)||"Sin asignar"),1)])]),((J=u.value.muestras)==null?void 0:J.length)>0?(_(),F("div",Kt,[c[10]||(c[10]=e("span",{class:"font-medium text-green-700 text-sm"},"Muestras:",-1)),e("div",Dt,[(_(!0),F(ue,null,ce(u.value.muestras,E=>(_(),F("span",{key:E.region_cuerpo,class:"inline-flex items-center px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-md"},f(E.region_cuerpo),1))),128))])])):U("",!0)])):U("",!0)]),w.value?(_(),F("div",Gt,[e("div",Rt,[c[13]||(c[13]=e("h3",{class:"text-sm font-semibold text-gray-700 mb-4 flex items-center"},[e("svg",{class:"w-4 h-4 mr-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})]),me(" Paso 2: Asignar Pat√≥logo ")],-1)),e("div",Jt,[x(o(Ze),{modelValue:y.patologoId,"onUpdate:modelValue":c[1]||(c[1]=E=>y.patologoId=E),label:"Pat√≥logo Responsable",placeholder:"Buscar y seleccionar pat√≥logo...",required:!0,errors:S.value.patologoId,"help-text":"Seleccione el pat√≥logo responsable del an√°lisis de este caso"},null,8,["modelValue","errors"])])]),e("div",Wt,[x(ge,{onClick:G}),x(_e,{text:N.value,"loading-text":"Asignando...",loading:a.value,onClick:de,disabled:!A.value},null,8,["text","loading","disabled"])]),x(we,{visible:C.value,errors:d.value},null,8,["visible","errors"])])):U("",!0),e("div",{ref_key:"notificationContainer",ref:n},[x(Ce,{visible:o($).visible,type:o($).type,title:o($).title,message:o($).message,inline:!0,"auto-close":!1,onClose:o(k)},null,8,["visible","type","title","message","onClose"])],512)])]}),_:1}))}}),Qt={class:"p-6"},Xt={class:"grid grid-cols-1 gap-6 lg:grid-cols-2"},ea={class:"space-y-6"},oa={class:"space-y-6"},xa=pe({__name:"NewCaseView",setup(h){const m=V("Nuevo Caso M√©dico"),i=V(),l=V(null),v=V(null),w=C=>{v.value=C,i.value&&i.value.handleNewPatient&&i.value.handleNewPatient(C)},s=C=>{},u=C=>{v.value=C},y=Qe(),q=C=>{l.value=C,y.notifyCaseCreated(),window.dispatchEvent(new CustomEvent("case-created",{detail:{case:C,timestamp:new Date().toISOString()}}))};return(C,a)=>(_(),D(o(je),null,{default:Q(()=>[x(o(Ye),{pageTitle:m.value},null,8,["pageTitle"]),e("div",Qt,[e("div",Xt,[e("div",ea,[x(kt,{ref_key:"newCaseRef",ref:i,onCaseSaved:q,onPatientVerified:u},null,512),x(Zt,{"case-to-assign":l.value},null,8,["case-to-assign"])]),e("div",oa,[x(ho,{onPatientSaved:w,onUpdatePatientData:s})])])])]),_:1}))}});export{xa as default};
