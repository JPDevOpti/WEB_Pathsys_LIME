var Ye=Object.defineProperty;var He=(r,a,e)=>a in r?Ye(r,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[a]=e;var ie=(r,a,e)=>He(r,typeof a!="symbol"?a+"":a,e);import{A as te,a as Z,b as Ge}from"./PathologistList.vue_vue_type_style_index_0_scoped_45f5ffeb_lang-FwbajLSj.js";import{b as F,e as q,h as o,d as ae,g as K,i as Be,t as P,j as oe,B as Le,n as se,G as Y,r as M,c as H,M as xe,N as Ce,k as X,f as _,u as h,H as le,w as ee,q as ne,v as de,l as Me,F as Re,I as Ze,o as Je,J as je}from"./index-CAHFE_9E.js";import{C as De,_ as Ke}from"./DiseaseList.vue_vue_type_style_index_0_scoped_2e8ef3ac_lang-CSxq79ax.js";/* empty css                                                                   */import{_ as ce}from"./FormCheckbox.vue_vue_type_script_setup_true_lang-DxUtxK1N.js";import{_ as G,a as Xe}from"./SearchButton.vue_vue_type_script_setup_true_lang-y2wCoroa.js";import{_ as ue,a as me}from"./Notification.vue_vue_type_script_setup_true_lang-Dr_eoe6-.js";import{_ as re,a as pe}from"./ClearButton.vue_vue_type_script_setup_true_lang-iqMnWNPk.js";import{_ as ge}from"./ValidationAlert.vue_vue_type_script_setup_true_lang-CKSrl8Ug.js";import{_ as Qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const We={},es={width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ss(r,a){return q(),F("svg",es,[...a[0]||(a[0]=[o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.72763 4.33443C7.92401 3.6437 9.30836 3.34945 10.6823 3.49385C12.0562 3.63826 13.3491 4.2139 14.3757 5.13828C15.0468 5.74252 15.5815 6.4755 15.9517 7.28815L13.6069 6.49282C13.2147 6.35977 12.7888 6.5699 12.6557 6.96216C12.5227 7.35443 12.7328 7.78028 13.1251 7.91333L16.8227 9.16752C16.8668 9.18743 16.9129 9.20314 16.9605 9.21426L17.0868 9.25712C17.2752 9.32101 17.4813 9.30746 17.6597 9.21943C17.838 9.1314 17.9741 8.97611 18.038 8.78772L19.3816 4.82561C19.5147 4.43334 19.3045 4.0075 18.9122 3.87447C18.52 3.74145 18.0941 3.95161 17.9611 4.34388L17.2335 6.48938C16.783 5.5609 16.1553 4.72223 15.3794 4.02356C14.1174 2.88722 12.528 2.17958 10.839 2.00207C9.15012 1.82455 7.44834 2.18628 5.97763 3.03539C4.50692 3.88451 3.34277 5.17743 2.65203 6.72884C1.9613 8.28025 1.77944 10.0105 2.13252 11.6716C2.4856 13.3328 3.3555 14.8395 4.61753 15.9758C5.87957 17.1121 7.46894 17.8198 9.15788 17.9973C10.8468 18.1748 12.5486 17.8131 14.0193 16.964C14.378 16.7569 14.5009 16.2982 14.2938 15.9395C14.0867 15.5807 13.628 15.4578 13.2693 15.6649C12.0729 16.3557 10.6886 16.6499 9.31467 16.5055C7.94077 16.3611 6.64786 15.7855 5.62123 14.8611C4.5946 13.9367 3.88697 12.711 3.59974 11.3598C3.31252 10.0085 3.46046 8.60098 4.02235 7.33894C4.58424 6.07691 5.53125 5.02516 6.72763 4.33443Z",fill:"currentColor"},null,-1)])])}const we=Qe(We,[["render",ss]]),as={class:"relative group"},os=["for"],is={key:0,class:"text-error-500"},ts={class:"relative"},rs={key:0,class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-brand-500 transition-colors duration-300"},ls=["id","type","value","placeholder","required","disabled"],ns={key:1,class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-brand-500 transition-colors duration-300"},ds={key:1,class:"mt-1 text-sm text-error-500"},cs={key:2,class:"mt-1 text-sm text-gray-500"},us=ae({__name:"FormInput",props:{modelValue:{},id:{},type:{default:"text"},label:{},placeholder:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},error:{},success:{type:Boolean,default:!1},helpText:{},leftIcon:{},rightIcon:{}},emits:["update:modelValue"],setup(r){return(a,e)=>(q(),F("div",as,[a.label?(q(),F("label",{key:0,for:a.id,class:"mb-1.5 block text-sm font-semibold text-gray-700"},[Be(P(a.label),1),a.required?(q(),F("span",is,"*")):K("",!0)],8,os)):K("",!0),o("div",ts,[a.leftIcon?(q(),F("span",rs,[(q(),oe(Le(a.leftIcon)))])):K("",!0),o("input",{id:a.id,type:a.type,value:a.modelValue,onInput:e[0]||(e[0]=i=>a.$emit("update:modelValue",i.target.value)),placeholder:a.placeholder,required:a.required,disabled:a.disabled,class:se(["h-12 w-full rounded-lg border bg-transparent py-2.5 text-base text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-500 focus:ring-2 focus:ring-brand-200/40 transition-all duration-300 outline-none",a.leftIcon?"pl-10":"pl-3",a.rightIcon?"pr-10":"pr-3",a.error?"border-error-500 focus:border-error-500 focus:ring-error-200/40":"border-gray-300",a.success?"border-success-500 focus:border-success-500 focus:ring-success-200/40":"",a.disabled?"opacity-50 cursor-not-allowed":""])},null,42,ls),a.rightIcon?(q(),F("span",ns,[(q(),oe(Le(a.rightIcon)))])):K("",!0)]),a.error?(q(),F("p",ds,P(a.error),1)):a.helpText?(q(),F("p",cs,P(a.helpText),1)):K("",!0)]))}});class ms{constructor(){ie(this,"auxiliaryEndpoint",te.ENDPOINTS.AUXILIARIES)}async createAuxiliary(a){var e,i,t,d,c,m,f,g;try{return await Z.post(`${this.auxiliaryEndpoint}/`,a)}catch(u){if(((e=u.response)==null?void 0:e.status)===409){const w=((i=u.response.data)==null?void 0:i.detail)||u.message||"Datos duplicados",y=new Error(w);throw y.response=u.response,y}else{if(((t=u.response)==null?void 0:t.status)===400)throw(d=u.message)!=null&&d.includes("email")?new Error("Ya existe un auxiliar con este email"):(c=u.message)!=null&&c.includes("código")||(m=u.message)!=null&&m.includes("code")?new Error("Ya existe un auxiliar con este código"):new Error(u.message||"Datos duplicados");if(((f=u.response)==null?void 0:f.status)===422){const w=(g=u.response.data)==null?void 0:g.detail;if(Array.isArray(w)){const y=w.map(N=>{var s,p,j;const $=((s=N.loc)==null?void 0:s[N.loc.length-1])||"campo";let n=$;switch($){case"auxiliarCode":n="Código del auxiliar";break;case"auxiliarName":n="Nombre del auxiliar";break;case"AuxiliarEmail":n="Email";break;case"password":n="Contraseña";break;case"observaciones":n="Observaciones";break}let l=N.msg;return l.includes("String should have at most")?l=`debe tener máximo ${(p=l.match(/\d+/))==null?void 0:p[0]} caracteres`:l.includes("String should have at least")?l=`debe tener mínimo ${(j=l.match(/\d+/))==null?void 0:j[0]} caracteres`:l.includes("field required")?l="es requerido":l.includes("value is not a valid email")&&(l="debe tener un formato de email válido"),`${n} ${l}`}).join(", ");throw new Error(y)}throw new Error("Datos inválidos en el formulario")}else throw new Error(u.message||"Error al crear el auxiliar")}}}async checkCodeExists(a){var e;try{return await Z.get(`${this.auxiliaryEndpoint}/${a}`),!0}catch(i){return((e=i.response)==null?void 0:e.status)!==404}}async checkEmailExists(a){var e;try{const i=await Z.get(`${this.auxiliaryEndpoint}/search?AuxiliarEmail=${a}`);return i.auxiliares&&i.auxiliares.length>0}catch(i){return((e=i.response)==null?void 0:e.status)===404,!1}}validateAuxiliaryData(a){var i,t,d,c;const e=[];return(i=a.auxiliarName)!=null&&i.trim()?a.auxiliarName.length<2?e.push("El nombre debe tener al menos 2 caracteres"):a.auxiliarName.length>100&&e.push("El nombre no puede tener más de 100 caracteres"):e.push("El nombre del auxiliar es requerido"),(t=a.auxiliarCode)!=null&&t.trim()?a.auxiliarCode.length<3?e.push("El código debe tener al menos 3 caracteres"):a.auxiliarCode.length>20&&e.push("El código no puede tener más de 20 caracteres"):e.push("El código del auxiliar es requerido"),(d=a.AuxiliarEmail)!=null&&d.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.AuxiliarEmail)||e.push("El email debe tener un formato válido"):e.push("El email es requerido"),(c=a.password)!=null&&c.trim()?a.password.length<6&&e.push("La contraseña debe tener al menos 6 caracteres"):e.push("La contraseña es requerida"),a.observaciones&&a.observaciones.length>500&&e.push("Las observaciones no pueden tener más de 500 caracteres"),{isValid:e.length===0,errors:e}}}const Pe=new ms;function ps(){const r=Y({isLoading:!1,isSuccess:!1,error:"",successMessage:""}),a=M(!1),e=M(!1),i=M(""),t=M(""),d=H(()=>!0),c=y=>{var $,n,l,s;const N={};return($=y.auxiliarName)!=null&&$.trim()?y.auxiliarName.length<2?N.auxiliarName="El nombre debe tener al menos 2 caracteres":y.auxiliarName.length>100&&(N.auxiliarName="El nombre no puede tener más de 100 caracteres"):N.auxiliarName="El nombre es requerido",(n=y.auxiliarCode)!=null&&n.trim()?y.auxiliarCode.length<3?N.auxiliarCode="El código debe tener al menos 3 caracteres":y.auxiliarCode.length>20&&(N.auxiliarCode="El código no puede tener más de 20 caracteres"):N.auxiliarCode="El código es requerido",(l=y.AuxiliarEmail)!=null&&l.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y.AuxiliarEmail)||(N.AuxiliarEmail="El email debe tener un formato válido"):N.AuxiliarEmail="El email es requerido",(s=y.password)!=null&&s.trim()?y.password.length<6&&(N.password="La contraseña debe tener al menos 6 caracteres"):N.password="La contraseña es requerida",y.observaciones&&y.observaciones.length>500&&(N.observaciones="Máximo 500 caracteres"),{isValid:Object.keys(N).length===0,errors:N}},m=async y=>{if(!(y!=null&&y.trim())||y.length<3||y.length>20)return!0;a.value=!0,i.value="";try{return await Pe.checkCodeExists(y.trim())?(i.value="Este código ya está en uso",!1):!0}catch{return i.value="Error al verificar el código",!1}finally{a.value=!1}},f=async y=>{if(!(y!=null&&y.trim())||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y))return!0;e.value=!0,t.value="";try{return await Pe.checkEmailExists(y.trim())?(t.value="Este email ya está en uso",!1):!0}catch{return t.value="Error al verificar el email",!1}finally{e.value=!1}},g=async y=>{var $,n,l;r.error="",r.isSuccess=!1,r.successMessage="";const N=c(y);if(!N.isValid){const s=Object.values(N.errors).filter(Boolean);return r.error=s.join(", "),{success:!1}}r.isLoading=!0;try{const s={auxiliarName:y.auxiliarName.trim(),auxiliarCode:y.auxiliarCode.trim().toUpperCase(),AuxiliarEmail:y.AuxiliarEmail.trim(),password:y.password.trim(),observaciones:y.observaciones.trim(),isActive:y.isActive},p=await Pe.createAuxiliary(s);return r.isSuccess=!0,r.successMessage=`Auxiliar "${p.auxiliarName}" creado exitosamente`,{success:!0,data:p}}catch(s){let p="Error al crear el auxiliar";if(s.message)p=s.message;else if((n=($=s.response)==null?void 0:$.data)!=null&&n.detail)p=s.response.data.detail;else if((l=s.response)!=null&&l.status)switch(s.response.status){case 409:p="Ya existe un auxiliar con los datos proporcionados";break;case 422:p="Los datos proporcionados no son válidos";break;case 400:p="Datos incorrectos o incompletos";break;case 500:p="Error interno del servidor. Inténtelo más tarde";break;default:p=`Error del servidor (${s.response.status})`}return r.error=p,r.isSuccess=!1,{success:!1}}finally{r.isLoading=!1}},u=()=>{r.isLoading=!1,r.isSuccess=!1,r.error="",r.successMessage="",a.value=!1,e.value=!1,i.value="",t.value=""},w=()=>{r.error="",r.successMessage="",r.isSuccess=!1,i.value="",t.value=""};return{state:r,isCheckingCode:Ae(a),isCheckingEmail:Ae(e),codeValidationError:Ae(i),emailValidationError:Ae(t),canSubmit:d,validateForm:c,checkCodeAvailability:m,checkEmailAvailability:f,createAuxiliary:g,clearState:u,clearMessages:w}}function Ae(r){return H(()=>r.value)}const gs={class:"col-span-full md:col-span-6 flex items-center pt-3"},vs={class:"col-span-full flex flex-col sm:flex-row gap-2 sm:gap-3 sm:justify-end pt-4 border-t border-gray-200"},bs={class:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm"},fs={class:"space-y-4"},Es={class:"mb-4 pb-3 border-b border-gray-100"},hs={class:"text-xl font-bold text-gray-900 mb-2"},ys={class:"text-gray-600"},xs={class:"font-mono font-bold text-gray-800 ml-1"},Cs={class:"space-y-4 text-sm"},ws={class:"text-gray-800 font-semibold"},As={class:"text-gray-800 font-semibold"},_s={key:0},Vs={class:"text-gray-800 bg-gray-50 p-3 rounded-lg"},Ns=ae({__name:"FormAuxiliar",props:{modelValue:{required:!0},modelModifiers:{}},emits:xe(["usuario-creado"],["update:modelValue"]),setup(r,{emit:a}){const e=Ce(r,"modelValue"),i=a,t=M(null),d=M(null),c=Y({visible:!1,type:"success",title:"",message:""}),m=Y({showValidationError:!1,hasAttemptedSubmit:!1}),{state:f,codeValidationError:g,emailValidationError:u,validateForm:w,checkCodeAvailability:y,checkEmailAvailability:N,createAuxiliary:$,clearState:n,clearMessages:l}=ps(),s=M(!1),p=Y({...e.value}),j=Y({auxiliarName:"",auxiliarCode:"",AuxiliarEmail:"",password:"",observaciones:""}),A=H(()=>{if(!m.hasAttemptedSubmit)return[];const L=w(p);return L.isValid?[]:Object.values(L.errors)}),b=H(()=>!0);X(()=>e.value,L=>{Object.assign(p,L)},{deep:!0}),X(()=>p,()=>{m.hasAttemptedSubmit&&!c.visible&&(l(),R())},{deep:!0});const V=async()=>{var L;if(j.auxiliarCode="",!((L=p.auxiliarCode)!=null&&L.trim())){j.auxiliarCode="El código es requerido";return}if(p.auxiliarCode.length<3){j.auxiliarCode="Mínimo 3 caracteres";return}if(p.auxiliarCode.length>20){j.auxiliarCode="Máximo 20 caracteres";return}await y(p.auxiliarCode),g.value&&(j.auxiliarCode=g.value)},v=async()=>{var L;if(j.AuxiliarEmail="",!((L=p.AuxiliarEmail)!=null&&L.trim())){j.AuxiliarEmail="El email es requerido";return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p.AuxiliarEmail)){j.AuxiliarEmail="Formato de email inválido";return}await N(p.AuxiliarEmail),u.value&&(j.AuxiliarEmail=u.value)},R=()=>{Object.keys(j).forEach(L=>{j[L]=""})},Q=(L,I,k)=>{c.type=L,c.title=I,c.message=k,c.visible=!0},U=()=>{c.visible=!1,c.title="",c.message="",d.value=null},T=()=>{O()},B=L=>{try{return new Date(L).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha no disponible"}},J=async()=>{await de(),t.value&&t.value.scrollIntoView({behavior:"smooth",block:"center"})},W=async()=>{if(m.hasAttemptedSubmit=!0,R(),U(),!w(p).isValid){m.showValidationError=!0;return}m.showValidationError=!1,s.value=!0;try{const I=await $(p);if(I.success&&I.data)await D(I.data);else{const k=f.error||"Error desconocido al crear el auxiliar";throw new Error(k)}}catch(I){await C(I)}finally{s.value=!1}},D=async L=>{d.value=L,Q("success","¡Auxiliar Registrado Exitosamente!",""),i("usuario-creado",{...p}),await J()},C=async L=>{var E,x,z;console.error("Error al guardar auxiliar:",L);let I="No se pudo guardar el auxiliar. Por favor, inténtelo nuevamente.",k="Error al Guardar Auxiliar";if(L.message)I=L.message,L.message.includes("email")||L.message.includes("código")?k="Datos Duplicados":L.message.includes("válido")||L.message.includes("requerido")?k="Datos Inválidos":L.message.includes("servidor")&&(k="Error del Servidor");else if((x=(E=L.response)==null?void 0:E.data)!=null&&x.detail)I=L.response.data.detail;else if((z=L.response)!=null&&z.status)switch(L.response.status){case 409:k="Datos Duplicados",I="Ya existe un auxiliar con los datos proporcionados";break;case 422:k="Datos Inválidos",I="Los datos proporcionados no son válidos";break;case 400:k="Datos Incorrectos",I="Datos incorrectos o incompletos";break;case 500:k="Error del Servidor",I="Error interno del servidor. Inténtelo más tarde";break;default:k=`Error del Servidor (${L.response.status})`,I="Ha ocurrido un error inesperado"}Q("error",k,I),await J()},S=()=>{m.hasAttemptedSubmit=!1,m.showValidationError=!1,R(),n(),Object.assign(p,{auxiliarName:"",auxiliarCode:"",AuxiliarEmail:"",password:"",observaciones:"",isActive:!0})},O=()=>{S(),U()};return X(()=>c.visible,L=>{L&&J()}),(L,I)=>(q(),F("form",{onSubmit:ne(W,["prevent"]),class:"grid grid-cols-1 md:grid-cols-12 gap-3 md:gap-4"},[I[11]||(I[11]=o("div",{class:"col-span-full"},[o("h4",{class:"text-base font-semibold text-gray-800"},"Formulario de Auxiliar")],-1)),_(h(G),{class:"col-span-full md:col-span-6",label:"Nombre completo",placeholder:"Ejemplo: Ana María González",modelValue:p.auxiliarName,"onUpdate:modelValue":I[0]||(I[0]=k=>p.auxiliarName=k),error:j.auxiliarName,autocomplete:"name"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Código del auxiliar",placeholder:"Ejemplo: 123456",modelValue:p.auxiliarCode,"onUpdate:modelValue":I[1]||(I[1]=k=>p.auxiliarCode=k),error:j.auxiliarCode,onBlur:V,autocomplete:"off",maxlength:"20"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Email",type:"email",placeholder:"ana.gonzalez@udea.edu.co",modelValue:p.AuxiliarEmail,"onUpdate:modelValue":I[2]||(I[2]=k=>p.AuxiliarEmail=k),error:j.AuxiliarEmail,onBlur:v,autocomplete:"email"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Contraseña",type:"password",placeholder:"••••••••",modelValue:p.password,"onUpdate:modelValue":I[3]||(I[3]=k=>p.password=k),error:j.password,autocomplete:"new-password"},null,8,["modelValue","error"]),_(h(ue),{class:"col-span-full",label:"Observaciones",placeholder:"Notas adicionales sobre el auxiliar (opcional)",modelValue:p.observaciones,"onUpdate:modelValue":I[4]||(I[4]=k=>p.observaciones=k),rows:3,error:j.observaciones},null,8,["modelValue","error"]),o("div",gs,[_(h(ce),{label:"Activo",modelValue:p.isActive,"onUpdate:modelValue":I[5]||(I[5]=k=>p.isActive=k)},null,8,["modelValue"])]),o("div",vs,[_(h(re),{type:"button",onClick:O,disabled:s.value},null,8,["disabled"]),_(h(pe),{text:"Guardar Auxiliar",type:"submit",disabled:!b.value||s.value,loading:s.value},null,8,["disabled","loading"])]),o("div",{ref_key:"notificationContainer",ref:t,class:"col-span-full"},[_(h(me),{visible:c.visible,type:c.type,title:c.title,message:c.message,inline:!0,"auto-close":!1,onClose:T},le({_:2},[c.type==="success"&&d.value?{name:"content",fn:ee(()=>[o("div",bs,[o("div",fs,[o("div",Es,[o("h3",hs,P(d.value.auxiliarName),1),o("p",ys,[I[6]||(I[6]=o("span",{class:"font-medium"},"Código:",-1)),o("span",xs,P(d.value.auxiliarCode),1)])]),o("div",Cs,[o("div",null,[I[7]||(I[7]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Email:",-1)),o("p",ws,P(d.value.AuxiliarEmail),1)]),o("div",null,[I[8]||(I[8]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Estado:",-1)),o("span",{class:se(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",d.value.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},P(d.value.isActive?"Activo":"Inactivo"),3)]),o("div",null,[I[9]||(I[9]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Fecha de creación:",-1)),o("p",As,P(B(d.value.fecha_creacion)),1)])]),d.value.observaciones?(q(),F("div",_s,[I[10]||(I[10]=o("span",{class:"text-gray-500 font-medium block mb-2"},"Observaciones:",-1)),o("p",Vs,P(d.value.observaciones),1)])):K("",!0)])])]),key:"0"}:void 0]),1032,["visible","type","title","message"])],512),_(h(ge),{visible:m.showValidationError&&m.hasAttemptedSubmit,errors:A.value},null,8,["visible","errors"])],32))}});class ks{constructor(){ie(this,"pathologistEndpoint",te.ENDPOINTS.PATHOLOGISTS);ie(this,"authEndpoint",te.ENDPOINTS.AUTH)}async createPathologist(a){var e,i,t,d,c,m,f,g,u;try{return await Z.post(`${this.pathologistEndpoint}/`,a)}catch(w){if(((e=w.response)==null?void 0:e.status)===409){const y=((i=w.response.data)==null?void 0:i.detail)||w.message||"Datos duplicados",N=new Error(y);throw N.response=w.response,N}else{if(((t=w.response)==null?void 0:t.status)===400)throw(d=w.message)!=null&&d.includes("email")?new Error("Ya existe un patólogo con este email"):(c=w.message)!=null&&c.includes("código")||(m=w.message)!=null&&m.includes("code")?new Error("Ya existe un patólogo con este código"):(f=w.message)!=null&&f.includes("registro")?new Error("Ya existe un patólogo con este registro médico"):new Error(w.message||"Datos duplicados");if(((g=w.response)==null?void 0:g.status)===422){const y=(u=w.response.data)==null?void 0:u.detail;if(Array.isArray(y)){const N=y.map($=>{var p,j,A;const n=((p=$.loc)==null?void 0:p[$.loc.length-1])||"campo";let l=n;switch(n){case"patologoCode":l="Código del patólogo";break;case"patologoName":l="Nombre del patólogo";break;case"PatologoEmail":l="Email";break;case"registro_medico":l="Registro médico";break;case"InicialesPatologo":l="Iniciales";break}let s=$.msg;return s.includes("String should have at most")?s=`debe tener máximo ${(j=s.match(/\d+/))==null?void 0:j[0]} caracteres`:s.includes("String should have at least")?s=`debe tener mínimo ${(A=s.match(/\d+/))==null?void 0:A[0]} caracteres`:s.includes("field required")?s="es requerido":s.includes("value is not a valid email")&&(s="debe tener un formato de email válido"),`${l} ${s}`}).join(", ");throw new Error(N)}throw new Error("Datos inválidos en el formulario")}else throw new Error(w.message||"Error al crear el patólogo")}}}async checkCodeExists(a){var e;try{return await Z.get(`${this.pathologistEndpoint}/${a}`),!0}catch(i){return((e=i.response)==null?void 0:e.status)!==404}}async checkEmailExists(a){var e;try{const i=await Z.get(`${this.pathologistEndpoint}/search?q=${a}`);return i.patologos&&i.patologos.length>0}catch(i){return((e=i.response)==null?void 0:e.status)===404,!1}}async checkMedicalLicenseExists(a){var e;try{const i=await Z.get(`${this.pathologistEndpoint}/search?q=${a}`);return i.patologos&&i.patologos.length>0}catch(i){return((e=i.response)==null?void 0:e.status)===404,!1}}validatePathologistData(a){var i,t,d,c,m;const e=[];return(i=a.patologoName)!=null&&i.trim()?a.patologoName.length<2?e.push("El nombre debe tener al menos 2 caracteres"):a.patologoName.length>200&&e.push("El nombre no puede tener más de 200 caracteres"):e.push("El nombre del patólogo es requerido"),(t=a.InicialesPatologo)!=null&&t.trim()?a.InicialesPatologo.length<2?e.push("Las iniciales deben tener al menos 2 caracteres"):a.InicialesPatologo.length>10&&e.push("Las iniciales no pueden tener más de 10 caracteres"):e.push("Las iniciales son requeridas"),(d=a.patologoCode)!=null&&d.trim()?a.patologoCode.length<6?e.push("El código debe tener al menos 6 caracteres"):a.patologoCode.length>10&&e.push("El código no puede tener más de 10 caracteres"):e.push("El código del patólogo es requerido"),(c=a.PatologoEmail)!=null&&c.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.PatologoEmail)||e.push("El email debe tener un formato válido"):e.push("El email es requerido"),(m=a.registro_medico)!=null&&m.trim()?a.registro_medico.length<5?e.push("El registro médico debe tener al menos 5 caracteres"):a.registro_medico.length>50&&e.push("El registro médico no puede tener más de 50 caracteres"):e.push("El registro médico es requerido"),a.observaciones&&a.observaciones.length>500&&e.push("Las observaciones no pueden tener más de 500 caracteres"),{isValid:e.length===0,errors:e}}}const _e=new ks;function $s(){const r=Y({isLoading:!1,isSuccess:!1,error:"",successMessage:""}),a=M(!1),e=M(!1),i=M(!1),t=M(""),d=M(""),c=M(""),m=H(()=>!0),f=n=>{var s,p,j,A,b,V;const l={};return(s=n.patologoName)!=null&&s.trim()?n.patologoName.length<2?l.patologoName="El nombre debe tener al menos 2 caracteres":n.patologoName.length>200&&(l.patologoName="El nombre no puede tener más de 200 caracteres"):l.patologoName="El nombre es requerido",(p=n.InicialesPatologo)!=null&&p.trim()?n.InicialesPatologo.length<2?l.InicialesPatologo="Las iniciales deben tener al menos 2 caracteres":n.InicialesPatologo.length>10&&(l.InicialesPatologo="Las iniciales no pueden tener más de 10 caracteres"):l.InicialesPatologo="Las iniciales son requeridas",(j=n.patologoCode)!=null&&j.trim()?n.patologoCode.length<6?l.patologoCode="El código debe tener al menos 6 caracteres":n.patologoCode.length>10&&(l.patologoCode="El código no puede tener más de 10 caracteres"):l.patologoCode="El código es requerido",(A=n.PatologoEmail)!=null&&A.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.PatologoEmail)||(l.PatologoEmail="El email debe tener un formato válido"):l.PatologoEmail="El email es requerido",(b=n.registro_medico)!=null&&b.trim()?n.registro_medico.length<5?l.registro_medico="El registro médico debe tener al menos 5 caracteres":n.registro_medico.length>50&&(l.registro_medico="El registro médico no puede tener más de 50 caracteres"):l.registro_medico="El registro médico es requerido",(V=n.password)!=null&&V.trim()?n.password.length<6&&(l.password="La contraseña debe tener al menos 6 caracteres"):l.password="La contraseña es requerida",n.observaciones&&n.observaciones.length>500&&(l.observaciones="Máximo 500 caracteres"),{isValid:Object.keys(l).length===0,errors:l}},g=async n=>{if(!(n!=null&&n.trim())||n.length<6||n.length>10)return!0;a.value=!0,t.value="";try{return await _e.checkCodeExists(n.trim())?(t.value="Este código ya está en uso",!1):!0}catch{return t.value="Error al verificar el código",!1}finally{a.value=!1}},u=async n=>{if(!(n!=null&&n.trim())||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n))return!0;e.value=!0,d.value="";try{return await _e.checkEmailExists(n.trim())?(d.value="Este email ya está en uso",!1):!0}catch{return d.value="Error al verificar el email",!1}finally{e.value=!1}},w=async n=>{if(!(n!=null&&n.trim())||n.length<5)return!0;i.value=!0,c.value="";try{return await _e.checkMedicalLicenseExists(n.trim())?(c.value="Este registro médico ya está en uso",!1):!0}catch{return c.value="Error al verificar el registro médico",!1}finally{i.value=!1}},y=async n=>{var A,b,V;r.error="",r.isSuccess=!1,r.successMessage="";const l=f(n);if(!l.isValid){const v=Object.values(l.errors).filter(Boolean);return r.error=v.join(", "),{success:!1}}const s=await g(n.patologoCode),p=await u(n.PatologoEmail),j=await w(n.registro_medico);if(!s||!p||!j){const v=[];return t.value&&v.push(t.value),d.value&&v.push(d.value),c.value&&v.push(c.value),r.error=v.join(", "),{success:!1}}r.isLoading=!0;try{const v={patologoName:n.patologoName.trim(),InicialesPatologo:n.InicialesPatologo.trim().toUpperCase(),patologoCode:n.patologoCode.trim(),PatologoEmail:n.PatologoEmail.trim(),registro_medico:n.registro_medico.trim(),password:n.password.trim(),firma:n.firma||"",observaciones:n.observaciones.trim(),isActive:n.isActive},R=await _e.createPathologist(v);return r.isSuccess=!0,r.successMessage=`Patólogo "${R.patologoName}" creado exitosamente`,{success:!0,data:R}}catch(v){let R="Error al crear el patólogo";if(v.message)R=v.message;else if((b=(A=v.response)==null?void 0:A.data)!=null&&b.detail)R=v.response.data.detail;else if((V=v.response)!=null&&V.status)switch(v.response.status){case 409:R="Ya existe un patólogo con los datos proporcionados";break;case 422:R="Los datos proporcionados no son válidos";break;case 400:R="Datos incorrectos o incompletos";break;case 500:R="Error interno del servidor. Inténtelo más tarde";break;default:R=`Error del servidor (${v.response.status})`}return r.error=R,r.isSuccess=!1,{success:!1}}finally{r.isLoading=!1}},N=()=>{r.isLoading=!1,r.isSuccess=!1,r.error="",r.successMessage="",a.value=!1,e.value=!1,i.value=!1,t.value="",d.value="",c.value=""},$=()=>{r.error="",r.successMessage="",r.isSuccess=!1,t.value="",d.value="",c.value=""};return{state:r,isCheckingCode:be(a),isCheckingEmail:be(e),isCheckingLicense:be(i),codeValidationError:be(t),emailValidationError:be(d),licenseValidationError:be(c),canSubmit:m,validateForm:f,checkCodeAvailability:g,checkEmailAvailability:u,checkMedicalLicenseAvailability:w,createPathologist:y,clearState:N,clearMessages:$}}function be(r){return H(()=>r.value)}const Ss={class:"col-span-full md:col-span-6 flex items-center pt-3"},Is={class:"col-span-full flex flex-col sm:flex-row gap-2 sm:gap-3 sm:justify-end pt-4 border-t border-gray-200"},Rs={class:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm"},Ps={class:"space-y-4"},Ms={class:"mb-4 pb-3 border-b border-gray-100"},Ls={class:"text-xl font-bold text-gray-900 mb-2"},js={class:"text-gray-600"},qs={class:"font-mono font-bold text-gray-800 ml-1"},zs={class:"space-y-4 text-sm"},Ts={class:"text-gray-800 font-semibold"},Us={class:"text-gray-800 font-semibold"},Os={class:"text-gray-800 font-semibold"},Fs={class:"text-gray-800 font-semibold"},Bs={key:0},Ds={class:"text-gray-800 bg-gray-50 p-3 rounded-lg"},Ys=ae({__name:"FormPatologo",props:{modelValue:{required:!0},modelModifiers:{}},emits:xe(["usuario-creado"],["update:modelValue"]),setup(r,{emit:a}){const e=Ce(r,"modelValue"),i=a,t=M(null),d=M(null),c=Y({visible:!1,type:"success",title:"",message:""}),m=Y({showValidationError:!1,hasAttemptedSubmit:!1}),{state:f,codeValidationError:g,emailValidationError:u,licenseValidationError:w,validateForm:y,checkCodeAvailability:N,checkEmailAvailability:$,checkMedicalLicenseAvailability:n,createPathologist:l,clearState:s,clearMessages:p}=$s(),j=M(!1),A=Y({...e.value}),b=Y({patologoName:"",InicialesPatologo:"",patologoCode:"",PatologoEmail:"",registro_medico:"",password:"",observaciones:""}),V=H(()=>{if(!m.hasAttemptedSubmit)return[];const E=y(A);return E.isValid?[]:Object.values(E.errors)}),v=H(()=>!0);X(()=>e.value,E=>{Object.assign(A,E)},{deep:!0}),X(()=>A,()=>{m.hasAttemptedSubmit&&!c.visible&&(p(),T())},{deep:!0});const R=async()=>{var E;if(b.patologoCode="",!((E=A.patologoCode)!=null&&E.trim())){b.patologoCode="El código es requerido";return}if(A.patologoCode.length<6){b.patologoCode="Mínimo 6 caracteres";return}if(A.patologoCode.length>10){b.patologoCode="Máximo 10 caracteres";return}await N(A.patologoCode),g.value&&(b.patologoCode=g.value)},Q=async()=>{var E;if(b.PatologoEmail="",!((E=A.PatologoEmail)!=null&&E.trim())){b.PatologoEmail="El email es requerido";return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(A.PatologoEmail)){b.PatologoEmail="Formato de email inválido";return}await $(A.PatologoEmail),u.value&&(b.PatologoEmail=u.value)},U=async()=>{var E;if(b.registro_medico="",!((E=A.registro_medico)!=null&&E.trim())){b.registro_medico="El registro médico es requerido";return}if(A.registro_medico.length<5){b.registro_medico="Mínimo 5 caracteres";return}if(A.registro_medico.length>50){b.registro_medico="Máximo 50 caracteres";return}await n(A.registro_medico),w.value&&(b.registro_medico=w.value)},T=()=>{Object.keys(b).forEach(E=>{b[E]=""})},B=(E,x,z)=>{c.type=E,c.title=x,c.message=z,c.visible=!0},J=()=>{c.visible=!1,c.title="",c.message="",d.value=null},W=()=>{k()},D=E=>{try{return new Date(E).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha no disponible"}},C=async()=>{await de(),t.value&&t.value.scrollIntoView({behavior:"smooth",block:"center"})},S=async()=>{if(m.hasAttemptedSubmit=!0,T(),J(),!y(A).isValid){m.showValidationError=!0;return}m.showValidationError=!1,j.value=!0;try{const x=await l(A);if(x.success&&x.data)await O(x.data);else{const z=f.error||"Error desconocido al crear el patólogo";throw new Error(z)}}catch(x){await L(x)}finally{j.value=!1}},O=async E=>{d.value=E,B("success","¡Patólogo Registrado Exitosamente!",""),i("usuario-creado",{...A}),await C()},L=async E=>{var ve,Ee,he;console.error("Error al guardar patólogo:",E);let x="No se pudo guardar el patólogo. Por favor, inténtelo nuevamente.",z="Error al Guardar Patólogo";if(E.message)x=E.message,E.message.includes("email")||E.message.includes("código")||E.message.includes("registro")?z="Datos Duplicados":E.message.includes("válido")||E.message.includes("requerido")?z="Datos Inválidos":E.message.includes("servidor")&&(z="Error del Servidor");else if((Ee=(ve=E.response)==null?void 0:ve.data)!=null&&Ee.detail)x=E.response.data.detail;else if((he=E.response)!=null&&he.status)switch(E.response.status){case 409:z="Datos Duplicados",x="Ya existe un patólogo con los datos proporcionados";break;case 422:z="Datos Inválidos",x="Los datos proporcionados no son válidos";break;case 400:z="Datos Incorrectos",x="Datos incorrectos o incompletos";break;case 500:z="Error del Servidor",x="Error interno del servidor. Inténtelo más tarde";break;default:z=`Error del Servidor (${E.response.status})`,x="Ha ocurrido un error inesperado"}B("error",z,x),await C()},I=()=>{m.hasAttemptedSubmit=!1,m.showValidationError=!1,T(),s(),Object.assign(A,{patologoName:"",InicialesPatologo:"",patologoCode:"",PatologoEmail:"",registro_medico:"",password:"",observaciones:"",isActive:!0,firma:""})},k=()=>{I(),J()};return X(()=>c.visible,E=>{E&&C()}),(E,x)=>(q(),F("form",{onSubmit:ne(S,["prevent"]),class:"grid grid-cols-1 md:grid-cols-12 gap-3 md:gap-4"},[x[15]||(x[15]=o("div",{class:"col-span-full"},[o("h4",{class:"text-base font-semibold text-gray-800"},"Formulario de Patólogo")],-1)),_(h(G),{class:"col-span-full md:col-span-6",label:"Nombre completo",placeholder:"Ejemplo: Juan Carlos Pérez González",modelValue:A.patologoName,"onUpdate:modelValue":x[0]||(x[0]=z=>A.patologoName=z),error:b.patologoName,autocomplete:"name"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Iniciales",placeholder:"Ejemplo: JCPG",modelValue:A.InicialesPatologo,"onUpdate:modelValue":x[1]||(x[1]=z=>A.InicialesPatologo=z),error:b.InicialesPatologo,autocomplete:"off"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Código del patólogo",placeholder:"Ejemplo: 123456",modelValue:A.patologoCode,"onUpdate:modelValue":x[2]||(x[2]=z=>A.patologoCode=z),error:b.patologoCode,onBlur:R,autocomplete:"off",maxlength:"10"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Email",type:"email",placeholder:"juan.perez@udea.edu.co",modelValue:A.PatologoEmail,"onUpdate:modelValue":x[3]||(x[3]=z=>A.PatologoEmail=z),error:b.PatologoEmail,onBlur:Q,autocomplete:"email"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Registro médico",placeholder:"Ejemplo: RM-12345",modelValue:A.registro_medico,"onUpdate:modelValue":x[4]||(x[4]=z=>A.registro_medico=z),error:b.registro_medico,onBlur:U},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Contraseña",type:"password",placeholder:"••••••••",modelValue:A.password,"onUpdate:modelValue":x[5]||(x[5]=z=>A.password=z),error:b.password,autocomplete:"new-password"},null,8,["modelValue","error"]),_(h(ue),{class:"col-span-full md:col-span-12 w-full",label:"Observaciones",placeholder:"Notas adicionales sobre el patólogo (opcional)",modelValue:A.observaciones,"onUpdate:modelValue":x[6]||(x[6]=z=>A.observaciones=z),rows:3,error:b.observaciones},null,8,["modelValue","error"]),o("div",Ss,[_(h(ce),{label:"Activo",modelValue:A.isActive,"onUpdate:modelValue":x[7]||(x[7]=z=>A.isActive=z)},null,8,["modelValue"])]),o("div",Is,[_(h(re),{type:"button",onClick:k,disabled:j.value},null,8,["disabled"]),_(h(pe),{text:"Guardar Patólogo",type:"submit",disabled:!v.value||j.value,loading:j.value},null,8,["disabled","loading"])]),o("div",{ref_key:"notificationContainer",ref:t,class:"col-span-full"},[_(h(me),{visible:c.visible,type:c.type,title:c.title,message:c.message,inline:!0,"auto-close":!1,onClose:W},le({_:2},[c.type==="success"&&d.value?{name:"content",fn:ee(()=>[o("div",Rs,[o("div",Ps,[o("div",Ms,[o("h3",Ls,P(d.value.patologoName),1),o("p",js,[x[8]||(x[8]=o("span",{class:"font-medium"},"Código:",-1)),o("span",qs,P(d.value.patologoCode),1)])]),o("div",zs,[o("div",null,[x[9]||(x[9]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Iniciales:",-1)),o("p",Ts,P(d.value.InicialesPatologo),1)]),o("div",null,[x[10]||(x[10]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Email:",-1)),o("p",Us,P(d.value.PatologoEmail),1)]),o("div",null,[x[11]||(x[11]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Registro médico:",-1)),o("p",Os,P(d.value.registro_medico),1)]),o("div",null,[x[12]||(x[12]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Estado:",-1)),o("span",{class:se(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",d.value.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},P(d.value.isActive?"Activo":"Inactivo"),3)]),o("div",null,[x[13]||(x[13]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Fecha de creación:",-1)),o("p",Fs,P(D(d.value.fecha_creacion)),1)])]),d.value.observaciones?(q(),F("div",Bs,[x[14]||(x[14]=o("span",{class:"text-gray-500 font-medium block mb-2"},"Observaciones:",-1)),o("p",Ds,P(d.value.observaciones),1)])):K("",!0)])])]),key:"0"}:void 0]),1032,["visible","type","title","message"])],512),_(h(ge),{visible:m.showValidationError&&m.hasAttemptedSubmit,errors:V.value},null,8,["visible","errors"])],32))}});class Hs{constructor(){ie(this,"residentEndpoint",te.ENDPOINTS.RESIDENTS)}async createResident(a){var e,i,t,d,c,m,f,g,u;try{return await Z.post(`${this.residentEndpoint}/`,a)}catch(w){if(((e=w.response)==null?void 0:e.status)===409){const y=((i=w.response.data)==null?void 0:i.detail)||w.message||"Datos duplicados",N=new Error(y);throw N.response=w.response,N}else{if(((t=w.response)==null?void 0:t.status)===400)throw(d=w.message)!=null&&d.includes("email")?new Error("Ya existe un residente con este email"):(c=w.message)!=null&&c.includes("código")||(m=w.message)!=null&&m.includes("code")?new Error("Ya existe un residente con este código"):(f=w.message)!=null&&f.includes("registro")?new Error("Ya existe un residente con este registro médico"):new Error(w.message||"Datos duplicados");if(((g=w.response)==null?void 0:g.status)===422){const y=(u=w.response.data)==null?void 0:u.detail;if(Array.isArray(y)){const N=y.map($=>{var p,j,A;const n=((p=$.loc)==null?void 0:p[$.loc.length-1])||"campo";let l=n;switch(n){case"residenteCode":l="Código del residente";break;case"residenteName":l="Nombre del residente";break;case"ResidenteEmail":l="Email";break;case"registro_medico":l="Registro médico";break;case"password":l="Contraseña";break;case"observaciones":l="Observaciones";break}let s=$.msg;return s.includes("String should have at most")?s=`debe tener máximo ${(j=s.match(/\d+/))==null?void 0:j[0]} caracteres`:s.includes("String should have at least")?s=`debe tener mínimo ${(A=s.match(/\d+/))==null?void 0:A[0]} caracteres`:s.includes("field required")?s="es requerido":s.includes("value is not a valid email")&&(s="debe tener un formato de email válido"),`${l} ${s}`}).join(", ");throw new Error(N)}throw new Error("Datos inválidos en el formulario")}else throw new Error(w.message||"Error al crear el residente")}}}async checkCodeExists(a){var e;try{return await Z.get(`${this.residentEndpoint}/${a}`),!0}catch(i){return((e=i.response)==null?void 0:e.status)!==404}}async checkEmailExists(a){var e;try{const i=await Z.get(`${this.residentEndpoint}/search?ResidenteEmail=${a}`);return i.residentes&&i.residentes.length>0}catch(i){return((e=i.response)==null?void 0:e.status)===404,!1}}async checkMedicalLicenseExists(a){var e;try{const i=await Z.get(`${this.residentEndpoint}/search?registro_medico=${a}`);return i.residentes&&i.residentes.length>0}catch(i){return((e=i.response)==null?void 0:e.status)===404,!1}}validateResidentData(a){var i,t,d,c,m;const e=[];return(i=a.residenteName)!=null&&i.trim()?a.residenteName.length<2?e.push("El nombre debe tener al menos 2 caracteres"):a.residenteName.length>100&&e.push("El nombre no puede tener más de 100 caracteres"):e.push("El nombre del residente es requerido"),(t=a.residenteCode)!=null&&t.trim()?a.residenteCode.length<3?e.push("El código debe tener al menos 3 caracteres"):a.residenteCode.length>20&&e.push("El código no puede tener más de 20 caracteres"):e.push("El código del residente es requerido"),(d=a.ResidenteEmail)!=null&&d.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.ResidenteEmail)||e.push("El email debe tener un formato válido"):e.push("El email es requerido"),(c=a.registro_medico)!=null&&c.trim()?a.registro_medico.length<3?e.push("El registro médico debe tener al menos 3 caracteres"):a.registro_medico.length>50&&e.push("El registro médico no puede tener más de 50 caracteres"):e.push("El registro médico es requerido"),(m=a.password)!=null&&m.trim()?a.password.length<6&&e.push("La contraseña debe tener al menos 6 caracteres"):e.push("La contraseña es requerida"),a.observaciones&&a.observaciones.length>500&&e.push("Las observaciones no pueden tener más de 500 caracteres"),{isValid:e.length===0,errors:e}}}const Ve=new Hs;function Gs(){const r=Y({isLoading:!1,isSuccess:!1,error:"",successMessage:""}),a=M(!1),e=M(!1),i=M(!1),t=M(""),d=M(""),c=M(""),m=H(()=>!0),f=n=>{var s,p,j,A,b,V;const l={};return(s=n.residenteName)!=null&&s.trim()?n.residenteName.length<2?l.residenteName="El nombre debe tener al menos 2 caracteres":n.residenteName.length>100&&(l.residenteName="El nombre no puede tener más de 100 caracteres"):l.residenteName="El nombre es requerido",(p=n.InicialesResidente)!=null&&p.trim()?n.InicialesResidente.length<2?l.InicialesResidente="Las iniciales deben tener al menos 2 caracteres":n.InicialesResidente.length>10&&(l.InicialesResidente="Las iniciales no pueden tener más de 10 caracteres"):l.InicialesResidente="Las iniciales son requeridas",(j=n.residenteCode)!=null&&j.trim()?n.residenteCode.length<3?l.residenteCode="El código debe tener al menos 3 caracteres":n.residenteCode.length>20&&(l.residenteCode="El código no puede tener más de 20 caracteres"):l.residenteCode="El código es requerido",(A=n.ResidenteEmail)!=null&&A.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.ResidenteEmail)||(l.ResidenteEmail="El email debe tener un formato válido"):l.ResidenteEmail="El email es requerido",(b=n.registro_medico)!=null&&b.trim()?n.registro_medico.length<3?l.registro_medico="El registro médico debe tener al menos 3 caracteres":n.registro_medico.length>50&&(l.registro_medico="El registro médico no puede tener más de 50 caracteres"):l.registro_medico="El registro médico es requerido",(V=n.password)!=null&&V.trim()?n.password.length<6&&(l.password="La contraseña debe tener al menos 6 caracteres"):l.password="La contraseña es requerida",n.observaciones&&n.observaciones.length>500&&(l.observaciones="Máximo 500 caracteres"),{isValid:Object.keys(l).length===0,errors:l}},g=async n=>{if(!(n!=null&&n.trim())||n.length<3||n.length>20)return!0;a.value=!0,t.value="";try{return await Ve.checkCodeExists(n.trim())?(t.value="Este código ya está en uso",!1):!0}catch{return t.value="Error al verificar el código",!1}finally{a.value=!1}},u=async n=>{if(!(n!=null&&n.trim())||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n))return!0;e.value=!0,d.value="";try{return await Ve.checkEmailExists(n.trim())?(d.value="Este email ya está en uso",!1):!0}catch{return d.value="Error al verificar el email",!1}finally{e.value=!1}},w=async n=>{if(!(n!=null&&n.trim())||n.length<3)return!0;i.value=!0,c.value="";try{return await Ve.checkMedicalLicenseExists(n.trim())?(c.value="Este registro médico ya está en uso",!1):!0}catch{return c.value="Error al verificar el registro médico",!1}finally{i.value=!1}},y=async n=>{var A,b,V;r.error="",r.isSuccess=!1,r.successMessage="";const l=f(n);if(!l.isValid){const v=Object.values(l.errors).filter(Boolean);return r.error=v.join(", "),{success:!1}}const s=await g(n.residenteCode),p=await u(n.ResidenteEmail),j=await w(n.registro_medico);if(!s||!p||!j){const v=[];return t.value&&v.push(t.value),d.value&&v.push(d.value),c.value&&v.push(c.value),r.error=v.join(", "),{success:!1}}r.isLoading=!0;try{const v={residenteName:n.residenteName.trim(),InicialesResidente:n.InicialesResidente.trim().toUpperCase(),residenteCode:n.residenteCode.trim().toUpperCase(),ResidenteEmail:n.ResidenteEmail.trim(),registro_medico:n.registro_medico.trim(),password:n.password.trim(),observaciones:n.observaciones.trim(),isActive:n.isActive},R=await Ve.createResident(v);return r.isSuccess=!0,r.successMessage=`Residente "${R.residenteName}" creado exitosamente`,{success:!0,data:R}}catch(v){let R="Error al crear el residente";if(v.message)R=v.message;else if((b=(A=v.response)==null?void 0:A.data)!=null&&b.detail)R=v.response.data.detail;else if((V=v.response)!=null&&V.status)switch(v.response.status){case 409:R="Ya existe un residente con los datos proporcionados";break;case 422:R="Los datos proporcionados no son válidos";break;case 400:R="Datos incorrectos o incompletos";break;case 500:R="Error interno del servidor. Inténtelo más tarde";break;default:R=`Error del servidor (${v.response.status})`}return r.error=R,r.isSuccess=!1,{success:!1}}finally{r.isLoading=!1}},N=()=>{r.isLoading=!1,r.isSuccess=!1,r.error="",r.successMessage="",a.value=!1,e.value=!1,i.value=!1,t.value="",d.value="",c.value=""},$=()=>{r.error="",r.successMessage="",r.isSuccess=!1,t.value="",d.value="",c.value=""};return{state:r,isCheckingCode:fe(a),isCheckingEmail:fe(e),isCheckingLicense:fe(i),codeValidationError:fe(t),emailValidationError:fe(d),licenseValidationError:fe(c),canSubmit:m,validateForm:f,checkCodeAvailability:g,checkEmailAvailability:u,checkMedicalLicenseAvailability:w,createResident:y,clearState:N,clearMessages:$}}function fe(r){return H(()=>r.value)}const Zs={class:"col-span-full md:col-span-6 flex items-center pt-3"},Js={class:"col-span-full flex flex-col sm:flex-row gap-2 sm:gap-3 sm:justify-end pt-4 border-t border-gray-200"},Ks={class:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm"},Xs={class:"space-y-4"},Qs={class:"mb-4 pb-3 border-b border-gray-100"},Ws={class:"text-xl font-bold text-gray-900 mb-2"},ea={class:"text-gray-600"},sa={class:"font-mono font-bold text-gray-800 ml-1"},aa={class:"space-y-4 text-sm"},oa={class:"text-gray-800 font-semibold"},ia={class:"text-gray-800 font-semibold"},ta={class:"text-gray-800 font-semibold"},ra={key:0},la={class:"text-gray-800 bg-gray-50 p-3 rounded-lg"},na=ae({__name:"FormResident",props:{modelValue:{required:!0},modelModifiers:{}},emits:xe(["usuario-creado"],["update:modelValue"]),setup(r,{emit:a}){const e=Ce(r,"modelValue"),i=a,t=M(null),d=M(null),c=Y({visible:!1,type:"success",title:"",message:""}),m=Y({showValidationError:!1,hasAttemptedSubmit:!1}),{state:f,codeValidationError:g,emailValidationError:u,licenseValidationError:w,validateForm:y,checkCodeAvailability:N,checkEmailAvailability:$,checkMedicalLicenseAvailability:n,createResident:l,clearState:s,clearMessages:p}=Gs(),j=M(!1),A=Y({...e.value}),b=Y({residenteName:"",InicialesResidente:"",residenteCode:"",ResidenteEmail:"",registro_medico:"",password:"",observaciones:""}),V=H(()=>{if(!m.hasAttemptedSubmit)return[];const E=y(A);return E.isValid?[]:Object.values(E.errors)}),v=H(()=>!0);X(()=>e.value,E=>{Object.assign(A,E)},{deep:!0}),X(()=>A,()=>{m.hasAttemptedSubmit&&!c.visible&&(p(),T())},{deep:!0});const R=async()=>{var E;if(b.residenteCode="",!((E=A.residenteCode)!=null&&E.trim())){b.residenteCode="El código es requerido";return}if(A.residenteCode.length<3){b.residenteCode="Mínimo 3 caracteres";return}if(A.residenteCode.length>20){b.residenteCode="Máximo 20 caracteres";return}await N(A.residenteCode),g.value&&(b.residenteCode=g.value)},Q=async()=>{var E;if(b.ResidenteEmail="",!((E=A.ResidenteEmail)!=null&&E.trim())){b.ResidenteEmail="El email es requerido";return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(A.ResidenteEmail)){b.ResidenteEmail="Formato de email inválido";return}await $(A.ResidenteEmail),u.value&&(b.ResidenteEmail=u.value)},U=async()=>{var E;if(b.registro_medico="",!((E=A.registro_medico)!=null&&E.trim())){b.registro_medico="El registro médico es requerido";return}if(A.registro_medico.length<3){b.registro_medico="Mínimo 3 caracteres";return}if(A.registro_medico.length>50){b.registro_medico="Máximo 50 caracteres";return}await n(A.registro_medico),w.value&&(b.registro_medico=w.value)},T=()=>{Object.keys(b).forEach(E=>{b[E]=""})},B=(E,x,z)=>{c.type=E,c.title=x,c.message=z,c.visible=!0},J=()=>{c.visible=!1,c.title="",c.message="",d.value=null},W=()=>{k()},D=E=>{try{return new Date(E).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha no disponible"}},C=async()=>{await de(),t.value&&t.value.scrollIntoView({behavior:"smooth",block:"center"})},S=async()=>{if(m.hasAttemptedSubmit=!0,T(),J(),!y(A).isValid){m.showValidationError=!0;return}m.showValidationError=!1,j.value=!0;try{const x=await l(A);if(x.success&&x.data)await O(x.data);else{const z=f.error||"Error desconocido al crear el residente";throw new Error(z)}}catch(x){await L(x)}finally{j.value=!1}},O=async E=>{d.value=E,B("success","¡Residente Registrado Exitosamente!",""),i("usuario-creado",{...A}),await C()},L=async E=>{var ve,Ee,he;console.error("Error al guardar residente:",E);let x="No se pudo guardar el residente. Por favor, inténtelo nuevamente.",z="Error al Guardar Residente";if(E.message)x=E.message,E.message.includes("email")||E.message.includes("código")||E.message.includes("registro")?z="Datos Duplicados":E.message.includes("válido")||E.message.includes("requerido")?z="Datos Inválidos":E.message.includes("servidor")&&(z="Error del Servidor");else if((Ee=(ve=E.response)==null?void 0:ve.data)!=null&&Ee.detail)x=E.response.data.detail;else if((he=E.response)!=null&&he.status)switch(E.response.status){case 409:z="Datos Duplicados",x="Ya existe un residente con los datos proporcionados";break;case 422:z="Datos Inválidos",x="Los datos proporcionados no son válidos";break;case 400:z="Datos Incorrectos",x="Datos incorrectos o incompletos";break;case 500:z="Error del Servidor",x="Error interno del servidor. Inténtelo más tarde";break;default:z=`Error del Servidor (${E.response.status})`,x="Ha ocurrido un error inesperado"}B("error",z,x),await C()},I=()=>{m.hasAttemptedSubmit=!1,m.showValidationError=!1,T(),s(),Object.assign(A,{residenteName:"",InicialesResidente:"",residenteCode:"",ResidenteEmail:"",registro_medico:"",password:"",observaciones:"",isActive:!0})},k=()=>{I(),J()};return X(()=>c.visible,E=>{E&&C()}),(E,x)=>(q(),F("form",{onSubmit:ne(S,["prevent"]),class:"grid grid-cols-1 md:grid-cols-12 gap-3 md:gap-4"},[x[14]||(x[14]=o("div",{class:"col-span-full"},[o("h4",{class:"text-base font-semibold text-gray-800"},"Formulario de Residente")],-1)),_(h(G),{class:"col-span-full md:col-span-6",label:"Nombre completo",placeholder:"Ejemplo: María Elena Rodríguez",modelValue:A.residenteName,"onUpdate:modelValue":x[0]||(x[0]=z=>A.residenteName=z),error:b.residenteName,autocomplete:"name"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Iniciales del residente",placeholder:"Ejemplo: MER",modelValue:A.InicialesResidente,"onUpdate:modelValue":x[1]||(x[1]=z=>A.InicialesResidente=z),error:b.InicialesResidente,autocomplete:"off",maxlength:"10"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Código del residente",placeholder:"Ejemplo 12345678",modelValue:A.residenteCode,"onUpdate:modelValue":x[2]||(x[2]=z=>A.residenteCode=z),error:b.residenteCode,onBlur:R,autocomplete:"off",maxlength:"20"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Email",type:"email",placeholder:"maria.rodriguez@udea.edu.co",modelValue:A.ResidenteEmail,"onUpdate:modelValue":x[3]||(x[3]=z=>A.ResidenteEmail=z),error:b.ResidenteEmail,onBlur:Q,autocomplete:"email"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Contraseña",type:"password",placeholder:"••••••••",modelValue:A.password,"onUpdate:modelValue":x[4]||(x[4]=z=>A.password=z),error:b.password,autocomplete:"new-password"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Registro médico",placeholder:"Ejemplo: RM-2024-001",modelValue:A.registro_medico,"onUpdate:modelValue":x[5]||(x[5]=z=>A.registro_medico=z),error:b.registro_medico,onBlur:U},null,8,["modelValue","error"]),_(h(ue),{class:"col-span-full",label:"Observaciones",placeholder:"Notas adicionales sobre el residente (opcional)",modelValue:A.observaciones,"onUpdate:modelValue":x[6]||(x[6]=z=>A.observaciones=z),rows:3,error:b.observaciones},null,8,["modelValue","error"]),o("div",Zs,[_(h(ce),{label:"Activo",modelValue:A.isActive,"onUpdate:modelValue":x[7]||(x[7]=z=>A.isActive=z)},null,8,["modelValue"])]),o("div",Js,[_(h(re),{type:"button",onClick:k,disabled:j.value},null,8,["disabled"]),_(h(pe),{text:"Guardar Residente",type:"submit",disabled:!v.value||j.value,loading:j.value},null,8,["disabled","loading"])]),o("div",{ref_key:"notificationContainer",ref:t,class:"col-span-full"},[_(h(me),{visible:c.visible,type:c.type,title:c.title,message:c.message,inline:!0,"auto-close":!1,onClose:W},le({_:2},[c.type==="success"&&d.value?{name:"content",fn:ee(()=>[o("div",Ks,[o("div",Xs,[o("div",Qs,[o("h3",Ws,P(d.value.residenteName),1),o("p",ea,[x[8]||(x[8]=o("span",{class:"font-medium"},"Código:",-1)),o("span",sa,P(d.value.residenteCode),1)])]),o("div",aa,[o("div",null,[x[9]||(x[9]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Email:",-1)),o("p",oa,P(d.value.ResidenteEmail),1)]),o("div",null,[x[10]||(x[10]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Registro médico:",-1)),o("p",ia,P(d.value.registro_medico),1)]),o("div",null,[x[11]||(x[11]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Estado:",-1)),o("span",{class:se(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",d.value.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},P(d.value.isActive?"Activo":"Inactivo"),3)]),o("div",null,[x[12]||(x[12]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Fecha de creación:",-1)),o("p",ta,P(D(d.value.fecha_creacion)),1)])]),d.value.observaciones?(q(),F("div",ra,[x[13]||(x[13]=o("span",{class:"text-gray-500 font-medium block mb-2"},"Observaciones:",-1)),o("p",la,P(d.value.observaciones),1)])):K("",!0)])])]),key:"0"}:void 0]),1032,["visible","type","title","message"])],512),_(h(ge),{visible:m.showValidationError&&m.hasAttemptedSubmit,errors:V.value},null,8,["visible","errors"])],32))}});class da{constructor(){ie(this,"endpoint",te.ENDPOINTS.ENTITIES)}async createEntity(a){var e,i,t,d,c;try{return await Z.post(`${this.endpoint}/`,a)}catch(m){if(((e=m.response)==null?void 0:e.status)===409){const f=((i=m.response.data)==null?void 0:i.detail)||m.message||"Datos duplicados",g=new Error(f);throw g.response=m.response,g}else{if(((t=m.response)==null?void 0:t.status)===400)throw new Error(m.message||"Ya existe una entidad con este código");if(((d=m.response)==null?void 0:d.status)===422){const f=(c=m.response.data)==null?void 0:c.detail;if(Array.isArray(f)){const g=f.map(u=>{var y;return`${((y=u.loc)==null?void 0:y[u.loc.length-1])||"campo"}: ${u.msg}`}).join(", ");throw new Error(`Errores de validación: ${g}`)}throw new Error("Datos inválidos en el formulario")}else throw new Error(m.message||"Error al crear la entidad")}}}async checkCodeExists(a){var e;try{return await Z.get(`${this.endpoint}/code/${a}`),!0}catch(i){return((e=i.response)==null?void 0:e.status)!==404}}validateEntityData(a){var i,t;const e=[];return(i=a.EntidadName)!=null&&i.trim()?a.EntidadName.length<2?e.push("El nombre debe tener al menos 2 caracteres"):a.EntidadName.length>200&&e.push("El nombre no puede tener más de 200 caracteres"):e.push("El nombre de la entidad es requerido"),(t=a.EntidadCode)!=null&&t.trim()?a.EntidadCode.length<2?e.push("El código debe tener al menos 2 caracteres"):a.EntidadCode.length>20?e.push("El código no puede tener más de 20 caracteres"):/^[A-Z0-9_-]+$/i.test(a.EntidadCode)||e.push("El código solo puede contener letras, números, guiones y guiones bajos"):e.push("El código de la entidad es requerido"),a.observaciones&&a.observaciones.length>500&&e.push("Las observaciones no pueden tener más de 500 caracteres"),{isValid:e.length===0,errors:e}}}const qe=new da;function ca(){const r=Y({isLoading:!1,isSuccess:!1,error:"",successMessage:""}),a=M(!1),e=M(""),i=H(()=>!0),t=g=>{var w,y;const u={};return(w=g.EntidadName)!=null&&w.trim()?g.EntidadName.length<2?u.EntidadName="El nombre debe tener al menos 2 caracteres":g.EntidadName.length>200&&(u.EntidadName="El nombre no puede tener más de 200 caracteres"):u.EntidadName="El nombre es requerido",(y=g.EntidadCode)!=null&&y.trim()?g.EntidadCode.length<2?u.EntidadCode="El código debe tener al menos 2 caracteres":g.EntidadCode.length>20?u.EntidadCode="El código no puede tener más de 20 caracteres":/^[A-Z0-9_-]+$/i.test(g.EntidadCode)||(u.EntidadCode="Solo letras, números, guiones y guiones bajos"):u.EntidadCode="El código es requerido",g.observaciones&&g.observaciones.length>500&&(u.observaciones="Máximo 500 caracteres"),{isValid:Object.keys(u).length===0,errors:u}},d=async g=>{if(!(g!=null&&g.trim())||g.length<2)return!0;a.value=!0,e.value="";try{return await qe.checkCodeExists(g.trim())?(e.value="Este código ya está en uso",!1):!0}catch{return e.value="Error al verificar el código",!1}finally{a.value=!1}},c=async g=>{var w,y,N;r.error="",r.isSuccess=!1,r.successMessage="";const u=t(g);if(!u.isValid){const $=Object.values(u.errors).filter(Boolean);return r.error=$.join(", "),{success:!1}}r.isLoading=!0;try{const $={EntidadName:g.EntidadName.trim(),EntidadCode:g.EntidadCode.trim().toUpperCase(),observaciones:g.observaciones.trim(),isActive:g.isActive},n=await qe.createEntity($);return r.isSuccess=!0,r.successMessage=`Entidad "${n.EntidadName}" creada exitosamente`,{success:!0,data:n}}catch($){let n="Error al crear la entidad";if($.message)n=$.message;else if((y=(w=$.response)==null?void 0:w.data)!=null&&y.detail)n=$.response.data.detail;else if((N=$.response)!=null&&N.status)switch($.response.status){case 409:n="Ya existe una entidad con los datos proporcionados";break;case 422:n="Los datos proporcionados no son válidos";break;case 400:n="Datos incorrectos o incompletos";break;case 500:n="Error interno del servidor. Inténtelo más tarde";break;default:n=`Error del servidor (${$.response.status})`}return r.error=n,r.isSuccess=!1,{success:!1}}finally{r.isLoading=!1}},m=()=>{r.isLoading=!1,r.isSuccess=!1,r.error="",r.successMessage="",a.value=!1,e.value=""},f=()=>{r.error="",r.successMessage="",r.isSuccess=!1,e.value=""};return{state:r,isCheckingCode:ze(a),codeValidationError:ze(e),canSubmit:i,validateForm:t,checkCodeAvailability:d,createEntity:c,clearState:m,clearMessages:f}}function ze(r){return H(()=>r.value)}const ua={class:"col-span-full md:col-span-6 flex items-center pt-3"},ma={class:"col-span-full flex flex-col sm:flex-row gap-2 sm:gap-3 sm:justify-end pt-4 border-t border-gray-200"},pa={class:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm"},ga={class:"space-y-4"},va={class:"mb-4 pb-3 border-b border-gray-100"},ba={class:"text-xl font-bold text-gray-900 mb-2"},fa={class:"text-gray-600"},Ea={class:"font-mono font-bold text-gray-800 ml-1"},ha={class:"space-y-4 text-sm"},ya={class:"text-gray-800 font-semibold"},xa={key:0},Ca={class:"text-gray-800 bg-gray-50 p-3 rounded-lg"},wa=ae({__name:"FormEntidad",props:{modelValue:{required:!0},modelModifiers:{}},emits:xe(["usuario-creado"],["update:modelValue"]),setup(r,{emit:a}){const e=Ce(r,"modelValue"),i=a,t=M(null),d=M(null),c=Y({visible:!1,type:"success",title:"",message:""}),m=Y({showValidationError:!1,hasAttemptedSubmit:!1}),{state:f,codeValidationError:g,validateForm:u,checkCodeAvailability:w,createEntity:y,clearState:N,clearMessages:$}=ca(),n=M(!1),l=Y({...e.value}),s=Y({EntidadName:"",EntidadCode:"",observaciones:""}),p=H(()=>{if(!m.hasAttemptedSubmit)return[];const C=u(l);return C.isValid?[]:Object.values(C.errors)}),j=H(()=>!0);X(()=>e.value,C=>{Object.assign(l,C)},{deep:!0}),X(()=>l,()=>{m.hasAttemptedSubmit&&!c.visible&&($(),b())},{deep:!0});const A=async()=>{var C;if(s.EntidadCode="",!((C=l.EntidadCode)!=null&&C.trim())){s.EntidadCode="El código es requerido";return}if(l.EntidadCode.length<2){s.EntidadCode="Mínimo 2 caracteres";return}if(l.EntidadCode.length>20){s.EntidadCode="Máximo 20 caracteres";return}if(!/^[A-Z0-9_-]+$/i.test(l.EntidadCode)){s.EntidadCode="Solo letras, números, guiones y guiones bajos";return}await w(l.EntidadCode),g.value&&(s.EntidadCode=g.value)},b=()=>{Object.keys(s).forEach(C=>{s[C]=""})},V=(C,S,O)=>{c.type=C,c.title=S,c.message=O,c.visible=!0},v=()=>{c.visible=!1,c.title="",c.message="",d.value=null},R=()=>{D()},Q=C=>{try{return new Date(C).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha no disponible"}},U=async()=>{await de(),t.value&&t.value.scrollIntoView({behavior:"smooth",block:"center"})},T=async()=>{if(m.hasAttemptedSubmit=!0,b(),v(),!u(l).isValid){m.showValidationError=!0;return}m.showValidationError=!1,n.value=!0;try{const S=await y(l);if(S.success&&S.data)await B(S.data);else{const O=f.error||"Error desconocido al crear la entidad";throw new Error(O)}}catch(S){await J(S)}finally{n.value=!1}},B=async C=>{d.value=C,V("success","¡Entidad Registrada Exitosamente!",""),i("usuario-creado",{...l}),await U()},J=async C=>{var L,I,k;console.error("Error al guardar entidad:",C);let S="No se pudo guardar la entidad. Por favor, inténtelo nuevamente.",O="Error al Guardar Entidad";if(C.message)S=C.message,C.message.includes("código")?O="Datos Duplicados":C.message.includes("válido")||C.message.includes("requerido")?O="Datos Inválidos":C.message.includes("servidor")&&(O="Error del Servidor");else if((I=(L=C.response)==null?void 0:L.data)!=null&&I.detail)S=C.response.data.detail;else if((k=C.response)!=null&&k.status)switch(C.response.status){case 409:O="Datos Duplicados",S="Ya existe una entidad con los datos proporcionados";break;case 422:O="Datos Inválidos",S="Los datos proporcionados no son válidos";break;case 400:O="Datos Incorrectos",S="Datos incorrectos o incompletos";break;case 500:O="Error del Servidor",S="Error interno del servidor. Inténtelo más tarde";break;default:O=`Error del Servidor (${C.response.status})`,S="Ha ocurrido un error inesperado"}V("error",O,S),await U()},W=()=>{m.hasAttemptedSubmit=!1,m.showValidationError=!1,b(),N(),Object.assign(l,{EntidadName:"",EntidadCode:"",observaciones:"",isActive:!0})},D=()=>{W(),v()};return X(()=>c.visible,C=>{C&&U()}),(C,S)=>(q(),F("form",{onSubmit:ne(T,["prevent"]),class:"grid grid-cols-1 md:grid-cols-12 gap-3 md:gap-4"},[S[8]||(S[8]=o("div",{class:"col-span-full"},[o("h4",{class:"text-base font-semibold text-gray-800"},"Formulario de Entidad")],-1)),_(h(G),{class:"col-span-full md:col-span-6",label:"Nombre de entidad",placeholder:"Ejemplo: Clínica Norte",modelValue:l.EntidadName,"onUpdate:modelValue":S[0]||(S[0]=O=>l.EntidadName=O),error:s.EntidadName},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Código de entidad",placeholder:"Ejemplo: CLINICA001",modelValue:l.EntidadCode,"onUpdate:modelValue":S[1]||(S[1]=O=>l.EntidadCode=O),error:s.EntidadCode,onBlur:A},null,8,["modelValue","error"]),_(h(ue),{class:"col-span-full",label:"Observaciones",placeholder:"Notas u observaciones relevantes (opcional)",modelValue:l.observaciones,"onUpdate:modelValue":S[2]||(S[2]=O=>l.observaciones=O),rows:3,error:s.observaciones},null,8,["modelValue","error"]),o("div",ua,[_(h(ce),{label:"Activo",modelValue:l.isActive,"onUpdate:modelValue":S[3]||(S[3]=O=>l.isActive=O)},null,8,["modelValue"])]),o("div",ma,[_(h(re),{type:"button",onClick:D,disabled:n.value},null,8,["disabled"]),_(h(pe),{text:"Guardar Entidad",type:"submit",disabled:!j.value||n.value,loading:n.value},null,8,["disabled","loading"])]),o("div",{ref_key:"notificationContainer",ref:t,class:"col-span-full"},[_(h(me),{visible:c.visible,type:c.type,title:c.title,message:c.message,inline:!0,"auto-close":!1,onClose:R},le({_:2},[c.type==="success"&&d.value?{name:"content",fn:ee(()=>[o("div",pa,[o("div",ga,[o("div",va,[o("h3",ba,P(d.value.EntidadName),1),o("p",fa,[S[4]||(S[4]=o("span",{class:"font-medium"},"Código:",-1)),o("span",Ea,P(d.value.EntidadCode),1)])]),o("div",ha,[o("div",null,[S[5]||(S[5]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Estado:",-1)),o("span",{class:se(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",d.value.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},P(d.value.isActive?"Activo":"Inactivo"),3)]),o("div",null,[S[6]||(S[6]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Fecha de creación:",-1)),o("p",ya,P(Q(d.value.fecha_creacion)),1)])]),d.value.observaciones?(q(),F("div",xa,[S[7]||(S[7]=o("span",{class:"text-gray-500 font-medium block mb-2"},"Observaciones:",-1)),o("p",Ca,P(d.value.observaciones),1)])):K("",!0)])])]),key:"0"}:void 0]),1032,["visible","type","title","message"])],512),_(h(ge),{visible:m.showValidationError&&m.hasAttemptedSubmit,errors:p.value},null,8,["visible","errors"])],32))}});class Aa{constructor(){ie(this,"endpoint",te.ENDPOINTS.TESTS)}async createTest(a){var e,i,t,d,c;try{return await Z.post(`${this.endpoint}/`,a)}catch(m){if(((e=m.response)==null?void 0:e.status)===409){const f=((i=m.response.data)==null?void 0:i.detail)||m.message||"Datos duplicados",g=new Error(f);throw g.response=m.response,g}else{if(((t=m.response)==null?void 0:t.status)===400)throw new Error(m.message||"Ya existe una prueba con este código");if(((d=m.response)==null?void 0:d.status)===422){const f=(c=m.response.data)==null?void 0:c.detail;if(Array.isArray(f)){const g=f.map(u=>{var y;return`${((y=u.loc)==null?void 0:y[u.loc.length-1])||"campo"}: ${u.msg}`}).join(", ");throw new Error(`Errores de validación: ${g}`)}throw new Error("Datos inválidos en el formulario")}else throw new Error(m.message||"Error al crear la prueba")}}}async checkCodeExists(a){var e;try{return await Z.get(`${this.endpoint}/code/${a}`),!0}catch(i){return((e=i.response)==null?void 0:e.status)!==404}}validateTestData(a){var i,t,d;const e=[];return(i=a.pruebaCode)!=null&&i.trim()?a.pruebaCode.length<3?e.push("El código debe tener al menos 3 caracteres"):/^[A-Z0-9_-]+$/i.test(a.pruebaCode)||e.push("El código solo puede contener letras, números, guiones y guiones bajos"):e.push("El código de prueba es requerido"),(t=a.pruebasName)!=null&&t.trim()?a.pruebasName.length<3&&e.push("El nombre debe tener al menos 3 caracteres"):e.push("El nombre de la prueba es requerido"),(d=a.pruebasDescription)!=null&&d.trim()?a.pruebasDescription.length<10&&e.push("La descripción debe tener al menos 10 caracteres"):e.push("La descripción es requerida"),!a.tiempo||a.tiempo<=0?e.push("El tiempo estimado debe ser mayor a 0 días"):a.tiempo>365&&e.push("El tiempo estimado no puede ser mayor a 365 días"),{isValid:e.length===0,errors:e}}}const Te=new Aa;function _a(){const r=Y({isLoading:!1,isSuccess:!1,error:"",successMessage:""}),a=M(!1),e=M(""),i=H(()=>!0),t=g=>{var w,y,N;const u={};return(w=g.pruebaCode)!=null&&w.trim()?g.pruebaCode.length<3?u.pruebaCode="El código debe tener al menos 3 caracteres":/^[A-Z0-9_-]+$/i.test(g.pruebaCode)||(u.pruebaCode="Solo letras, números, guiones y guiones bajos"):u.pruebaCode="El código es requerido",(y=g.pruebasName)!=null&&y.trim()?g.pruebasName.length<3&&(u.pruebasName="El nombre debe tener al menos 3 caracteres"):u.pruebasName="El nombre es requerido",(N=g.pruebasDescription)!=null&&N.trim()?g.pruebasDescription.length<10&&(u.pruebasDescription="Mínimo 10 caracteres"):u.pruebasDescription="La descripción es requerida",!g.tiempo||g.tiempo<=0?u.tiempo="Ingresa un tiempo válido en días":g.tiempo>365&&(u.tiempo="Máximo 365 días"),{isValid:Object.keys(u).length===0,errors:u}},d=async g=>{if(!(g!=null&&g.trim())||g.length<3)return!0;a.value=!0,e.value="";try{return await Te.checkCodeExists(g.trim())?(e.value="Este código ya está en uso",!1):!0}catch{return e.value="Error al verificar el código",!1}finally{a.value=!1}},c=async g=>{var w,y,N;r.error="",r.isSuccess=!1,r.successMessage="";const u=t(g);if(!u.isValid){const $=Object.values(u.errors).filter(Boolean);return r.error=$.join(", "),{success:!1}}r.isLoading=!0;try{const $={pruebaCode:g.pruebaCode.trim(),pruebasName:g.pruebasName.trim(),pruebasDescription:g.pruebasDescription.trim(),tiempo:g.tiempo||1,isActive:g.isActive},n=await Te.createTest($);return r.isSuccess=!0,r.successMessage=`Prueba "${n.pruebasName}" creada exitosamente`,{success:!0,data:n}}catch($){let n="Error al crear la prueba";if($.message)n=$.message;else if((y=(w=$.response)==null?void 0:w.data)!=null&&y.detail)n=$.response.data.detail;else if((N=$.response)!=null&&N.status)switch($.response.status){case 409:n="Ya existe una prueba con los datos proporcionados";break;case 422:n="Los datos proporcionados no son válidos";break;case 400:n="Datos incorrectos o incompletos";break;case 500:n="Error interno del servidor. Inténtelo más tarde";break;default:n=`Error del servidor (${$.response.status})`}return r.error=n,r.isSuccess=!1,{success:!1}}finally{r.isLoading=!1}},m=()=>{r.isLoading=!1,r.isSuccess=!1,r.error="",r.successMessage="",a.value=!1,e.value=""},f=()=>{r.error="",r.successMessage="",r.isSuccess=!1,e.value=""};return{state:r,isCheckingCode:Ue(a),codeValidationError:Ue(e),canSubmit:i,validateForm:t,checkCodeAvailability:d,createTest:c,clearState:m,clearMessages:f}}function Ue(r){return H(()=>r.value)}const Va={class:"col-span-full md:col-span-6 flex items-center justify-center pt-6"},Na={class:"col-span-full flex flex-col sm:flex-row gap-2 sm:gap-3 sm:justify-end pt-4 border-t border-gray-200"},ka={class:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm"},$a={class:"space-y-4"},Sa={class:"mb-4 pb-3 border-b border-gray-100"},Ia={class:"text-xl font-bold text-gray-900 mb-2"},Ra={class:"text-gray-600"},Pa={class:"font-mono font-bold text-gray-800 ml-1"},Ma={class:"space-y-4 text-sm"},La={class:"text-gray-800 font-semibold"},ja={class:"text-gray-800 font-semibold"},qa={key:0},za={class:"text-gray-800 bg-gray-50 p-3 rounded-lg"},Ta=ae({__name:"FormPruebas",props:{modelValue:{required:!0},modelModifiers:{}},emits:xe(["usuario-creado"],["update:modelValue"]),setup(r,{emit:a}){const e=Ce(r,"modelValue"),i=a,t=M(null),d=M(null),c=Y({visible:!1,type:"success",title:"",message:""}),m=Y({showValidationError:!1,hasAttemptedSubmit:!1}),{state:f,codeValidationError:g,validateForm:u,checkCodeAvailability:w,createTest:y,clearState:N,clearMessages:$}=_a(),n=M(!1),l=Y({...e.value,tiempo:e.value.tiempo||1}),s=Y({pruebaCode:"",pruebasName:"",pruebasDescription:"",tiempo:""}),p=H(()=>{if(!m.hasAttemptedSubmit)return[];const C=u(l);return C.isValid?[]:Object.values(C.errors)}),j=H(()=>!0);X(()=>e.value,C=>{Object.assign(l,{...C,tiempo:C.tiempo||1})},{deep:!0}),X(()=>l,()=>{m.hasAttemptedSubmit&&!c.visible&&($(),b())},{deep:!0});const A=async()=>{var C;if(s.pruebaCode="",!((C=l.pruebaCode)!=null&&C.trim())){s.pruebaCode="El código es requerido";return}if(l.pruebaCode.length<3){s.pruebaCode="Mínimo 3 caracteres";return}if(!/^[A-Z0-9_-]+$/i.test(l.pruebaCode)){s.pruebaCode="Solo letras, números, guiones y guiones bajos";return}await w(l.pruebaCode),g.value&&(s.pruebaCode=g.value)},b=()=>{Object.keys(s).forEach(C=>{s[C]=""})},V=(C,S,O)=>{c.type=C,c.title=S,c.message=O,c.visible=!0},v=()=>{c.visible=!1,c.title="",c.message="",d.value=null},R=()=>{D()},Q=C=>{try{return new Date(C).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha no disponible"}},U=async()=>{await de(),t.value&&t.value.scrollIntoView({behavior:"smooth",block:"center"})},T=async()=>{if(m.hasAttemptedSubmit=!0,b(),v(),!u(l).isValid){m.showValidationError=!0;return}m.showValidationError=!1,n.value=!0;try{const S=await y(l);if(S.success&&S.data)await B(S.data);else{const O=f.error||"Error desconocido al crear la prueba";throw new Error(O)}}catch(S){await J(S)}finally{n.value=!1}},B=async C=>{d.value=C,V("success","¡Prueba Registrada Exitosamente!",""),i("usuario-creado",{...l}),await U()},J=async C=>{var L,I,k;console.error("Error al guardar prueba:",C);let S="No se pudo guardar la prueba. Por favor, inténtelo nuevamente.",O="Error al Guardar Prueba";if(C.message)S=C.message,C.message.includes("código")?O="Datos Duplicados":C.message.includes("válido")||C.message.includes("requerido")?O="Datos Inválidos":C.message.includes("servidor")&&(O="Error del Servidor");else if((I=(L=C.response)==null?void 0:L.data)!=null&&I.detail)S=C.response.data.detail;else if((k=C.response)!=null&&k.status)switch(C.response.status){case 409:O="Datos Duplicados",S="Ya existe una prueba con los datos proporcionados";break;case 422:O="Datos Inválidos",S="Los datos proporcionados no son válidos";break;case 400:O="Datos Incorrectos",S="Datos incorrectos o incompletos";break;case 500:O="Error del Servidor",S="Error interno del servidor. Inténtelo más tarde";break;default:O=`Error del Servidor (${C.response.status})`,S="Ha ocurrido un error inesperado"}V("error",O,S),await U()},W=()=>{m.hasAttemptedSubmit=!1,m.showValidationError=!1,b(),N(),Object.assign(l,{pruebaCode:"",pruebasName:"",pruebasDescription:"",tiempo:1,isActive:!0})},D=()=>{W(),v()};return X(()=>c.visible,C=>{C&&U()}),(C,S)=>(q(),F("form",{onSubmit:ne(T,["prevent"]),class:"grid grid-cols-1 md:grid-cols-12 gap-3 md:gap-4"},[S[10]||(S[10]=o("div",{class:"col-span-full"},[o("h4",{class:"text-base font-semibold text-gray-800"},"Formulario de Pruebas")],-1)),_(h(G),{class:"col-span-full md:col-span-6",label:"Código de prueba",placeholder:"Ejemplo: BIO-01",modelValue:l.pruebaCode,"onUpdate:modelValue":S[0]||(S[0]=O=>l.pruebaCode=O),error:s.pruebaCode,onBlur:A},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Nombre de la prueba",placeholder:"Ejemplo: Biopsia",modelValue:l.pruebasName,"onUpdate:modelValue":S[1]||(S[1]=O=>l.pruebasName=O),error:s.pruebasName},null,8,["modelValue","error"]),_(h(ue),{class:"col-span-full",label:"Descripción",placeholder:"Descripción detallada de la prueba",modelValue:l.pruebasDescription,"onUpdate:modelValue":S[2]||(S[2]=O=>l.pruebasDescription=O),rows:3,error:s.pruebasDescription},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Tiempo estimado (días)",type:"number",placeholder:"Ej. 7",modelValue:l.tiempo,"onUpdate:modelValue":S[3]||(S[3]=O=>l.tiempo=O),modelModifiers:{number:!0},error:s.tiempo,min:"1",max:"365"},null,8,["modelValue","error"]),o("div",Va,[_(h(ce),{label:"Activo",modelValue:l.isActive,"onUpdate:modelValue":S[4]||(S[4]=O=>l.isActive=O)},null,8,["modelValue"])]),o("div",Na,[_(h(re),{type:"button",onClick:D,disabled:n.value},null,8,["disabled"]),_(h(pe),{text:"Guardar Prueba",type:"submit",disabled:!j.value||n.value,loading:n.value},null,8,["disabled","loading"])]),o("div",{ref_key:"notificationContainer",ref:t,class:"col-span-full"},[_(h(me),{visible:c.visible,type:c.type,title:c.title,message:c.message,inline:!0,"auto-close":!1,onClose:R},le({_:2},[c.type==="success"&&d.value?{name:"content",fn:ee(()=>[o("div",ka,[o("div",$a,[o("div",Sa,[o("h3",Ia,P(d.value.pruebasName),1),o("p",Ra,[S[5]||(S[5]=o("span",{class:"font-medium"},"Código:",-1)),o("span",Pa,P(d.value.pruebaCode),1)])]),o("div",Ma,[o("div",null,[S[6]||(S[6]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Tiempo estimado:",-1)),o("p",La,P(d.value.tiempo)+" día"+P(d.value.tiempo!==1?"s":""),1)]),o("div",null,[S[7]||(S[7]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Estado:",-1)),o("span",{class:se(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",d.value.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},P(d.value.isActive?"Activo":"Inactivo"),3)]),o("div",null,[S[8]||(S[8]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Fecha de creación:",-1)),o("p",ja,P(Q(d.value.fecha_creacion)),1)])]),d.value.pruebasDescription?(q(),F("div",qa,[S[9]||(S[9]=o("span",{class:"text-gray-500 font-medium block mb-2"},"Descripción:",-1)),o("p",za,P(d.value.pruebasDescription),1)])):K("",!0)])])]),key:"0"}:void 0]),1032,["visible","type","title","message"])],512),_(h(ge),{visible:m.showValidationError&&m.hasAttemptedSubmit,errors:p.value},null,8,["visible","errors"])],32))}}),Ua={class:"border-b border-gray-200 mb-1"},Oa={class:"-mb-px flex flex-wrap gap-1 md:gap-4","aria-label":"Tabs"},Fa=["onClick"],Ba=ae({__name:"UserCreationTabs",emits:["usuario-creado","foto-seleccionada"],setup(r,{emit:a}){const e=a,i=[{value:"auxiliar",label:"Auxiliar administrativo"},{value:"patologo",label:"Patólogo"},{value:"residente",label:"Residente"},{value:"entidad",label:"Entidad"},{value:"pruebas",label:"Pruebas"}],t=M("auxiliar"),d=M({auxiliarName:"",auxiliarCode:"",AuxiliarEmail:"",password:"",observaciones:"",isActive:!0}),c=M({patologoName:"",InicialesPatologo:"",patologoCode:"",PatologoEmail:"",registro_medico:"",password:"",observaciones:"",isActive:!0,firma:""}),m=M({residenteName:"",InicialesResidente:"",residenteCode:"",ResidenteEmail:"",registro_medico:"",password:"",observaciones:"",isActive:!0}),f=M({EntidadName:"",EntidadCode:"",observaciones:"",isActive:!0}),g=M({pruebaCode:"",pruebasName:"",pruebasDescription:"",tiempo:1,isActive:!0}),u=y=>{t.value=y},w=(y,N)=>{e("usuario-creado",{tipo:y,data:N}),y==="auxiliar"&&(d.value={auxiliarName:"",auxiliarCode:"",AuxiliarEmail:"",password:"",observaciones:"",isActive:!0}),y==="patologo"&&(c.value={patologoName:"",InicialesPatologo:"",patologoCode:"",PatologoEmail:"",registro_medico:"",password:"",observaciones:"",isActive:!0,firma:""}),y==="residente"&&(m.value={residenteName:"",InicialesResidente:"",residenteCode:"",ResidenteEmail:"",registro_medico:"",password:"",observaciones:"",isActive:!0}),y==="entidad"&&(f.value={EntidadName:"",EntidadCode:"",observaciones:"",isActive:!0}),y==="pruebas"&&(g.value={pruebaCode:"",pruebasName:"",pruebasDescription:"",tiempo:1,isActive:!0})};return(y,N)=>(q(),oe(h(De),{title:"Creación de usuarios",description:"Seleciona una pestaña para crear un usuario.",dense:!0},{icon:ee(()=>[...N[10]||(N[10]=[o("svg",{class:"w-5 h-5 mr-2 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h8m4-7v3m0 0h3m-3 0h-3"})],-1)])]),default:ee(()=>[o("div",Ua,[o("nav",Oa,[(q(),F(Re,null,Me(i,$=>o("button",{key:$.value,type:"button",class:se(["whitespace-nowrap py-1 px-1 md:px-1 border-b-2 font-medium text-xs md:text-sm",t.value===$.value?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"]),onClick:n=>u($.value)},P($.label),11,Fa)),64))])]),t.value==="auxiliar"?(q(),oe(Ns,{key:0,modelValue:d.value,"onUpdate:modelValue":N[0]||(N[0]=$=>d.value=$),onUsuarioCreado:N[1]||(N[1]=$=>w("auxiliar",$))},null,8,["modelValue"])):t.value==="patologo"?(q(),oe(Ys,{key:1,modelValue:c.value,"onUpdate:modelValue":N[2]||(N[2]=$=>c.value=$),onUsuarioCreado:N[3]||(N[3]=$=>w("patologo",$))},null,8,["modelValue"])):t.value==="residente"?(q(),oe(na,{key:2,modelValue:m.value,"onUpdate:modelValue":N[4]||(N[4]=$=>m.value=$),onUsuarioCreado:N[5]||(N[5]=$=>w("residente",$))},null,8,["modelValue"])):t.value==="entidad"?(q(),oe(wa,{key:3,modelValue:f.value,"onUpdate:modelValue":N[6]||(N[6]=$=>f.value=$),onUsuarioCreado:N[7]||(N[7]=$=>w("entidad",$))},null,8,["modelValue"])):t.value==="pruebas"?(q(),oe(Ta,{key:4,modelValue:g.value,"onUpdate:modelValue":N[8]||(N[8]=$=>g.value=$),onUsuarioCreado:N[9]||(N[9]=$=>w("pruebas",$))},null,8,["modelValue"])):K("",!0)]),_:1}))}}),Da={class:"space-y-4"},Ya={class:"text-base font-semibold text-gray-800 mb-1"},Ha={key:0,class:"text-sm text-red-600"},Ga={class:"flex justify-end space-x-3 pt-2 border-t border-gray-200"},Za=ae({__name:"BuscadorUsuarios",props:{busqueda:{},tipoBusqueda:{},estaBuscando:{type:Boolean},error:{}},emits:["buscar","limpiar"],setup(r,{emit:a}){const e=r,i=a,t=M(e.busqueda),d=M(e.tipoBusqueda),c=H(()=>({auxiliar:"Buscar Auxiliar Administrativo",patologo:"Buscar Patólogo",residente:"Buscar Residente",entidad:"Buscar Entidad",pruebas:"Buscar Prueba Médica"})[d.value]||"Buscar registros"),m=H(()=>({auxiliar:"Nombre del auxiliar, código o email...",patologo:"Nombre del patólogo, código, registro médico o email...",residente:"Nombre del residente, código, registro médico o email...",entidad:"Nombre de la entidad, código o NIT...",pruebas:"Nombre de la prueba o código (ej: 80901-1, Biopsia)..."})[d.value]||"Buscar..."),f=()=>{t.value.trim()&&!e.estaBuscando&&i("buscar",{query:t.value.trim(),tipo:d.value,includeInactive:!0})};return X(()=>e.busqueda,g=>t.value=g),X(()=>e.tipoBusqueda,g=>d.value=g),(g,u)=>(q(),F("div",Da,[o("h4",Ya,P(c.value),1),_(h(us),{modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=w=>t.value=w),placeholder:m.value,disabled:g.estaBuscando,onKeyup:Ze(f,["enter"])},null,8,["modelValue","placeholder","disabled"]),g.error?(q(),F("div",Ha,P(g.error),1)):K("",!0),o("div",Ga,[_(h(re),{onClick:u[1]||(u[1]=w=>g.$emit("limpiar")),disabled:g.estaBuscando},null,8,["disabled"]),_(h(Xe),{onClick:f,disabled:g.estaBuscando||!t.value.trim(),loading:g.estaBuscando,text:"Buscar"},null,8,["disabled","loading"])])]))}}),Ja={key:0},Ka={key:0,class:"text-sm text-gray-500 text-center py-4"},Xa={key:1,class:"text-sm text-gray-500 text-center py-4"},Qa={key:2,class:"overflow-x-auto shadow ring-1 ring-black ring-opacity-5 rounded-lg"},Wa={class:"min-w-full divide-y divide-gray-300"},eo={class:"bg-white divide-y divide-gray-200"},so=["onClick"],ao={class:"px-3 md:px-4 py-3 whitespace-nowrap"},oo={class:"flex items-center"},io={class:"text-sm font-medium text-gray-900"},to={class:"sm:hidden text-xs text-gray-500"},ro={class:"px-3 md:px-4 py-3 whitespace-nowrap"},lo={class:"md:hidden"},no={class:"hidden md:inline"},co={class:"hidden sm:table-cell px-3 md:px-4 py-3 whitespace-nowrap text-sm text-gray-500"},uo={class:"px-3 md:px-4 py-3 whitespace-nowrap"},mo={class:"md:hidden"},po={class:"hidden md:inline"},go=ae({__name:"ResultadosBusqueda",props:{resultados:{},busquedaRealizada:{type:Boolean},estaBuscando:{type:Boolean},selectedId:{}},emits:["usuario-seleccionado"],setup(r){return(a,e)=>a.estaBuscando||a.busquedaRealizada?(q(),F("div",Ja,[e[3]||(e[3]=o("h4",{class:"text-base font-semibold text-gray-800 mb-1"},"Resultados",-1)),a.estaBuscando?(q(),F("div",Ka,[...e[0]||(e[0]=[o("div",{class:"inline-flex items-center"},[o("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),Be(" Buscando... ")],-1)])])):a.resultados.length===0&&a.busquedaRealizada?(q(),F("div",Xa," Sin resultados para tu búsqueda ")):a.resultados.length>0?(q(),F("div",Qa,[o("table",Wa,[e[2]||(e[2]=o("thead",{class:"bg-gray-50"},[o("tr",null,[o("th",{scope:"col",class:"px-3 md:px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre "),o("th",{scope:"col",class:"px-3 md:px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tipo "),o("th",{scope:"col",class:"hidden sm:table-cell px-3 md:px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Documento/Código "),o("th",{scope:"col",class:"px-3 md:px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),o("th",{scope:"col",class:"relative px-3 md:px-4 py-2"},[o("span",{class:"sr-only"},"Seleccionar")])])],-1)),o("tbody",eo,[(q(!0),F(Re,null,Me(a.resultados,i=>(q(),F("tr",{key:i.id,class:se(["cursor-pointer transition-colors",i.id===a.selectedId?"bg-blue-50 ring-2 ring-blue-400":"hover:bg-gray-50"]),onClick:t=>a.$emit("usuario-seleccionado",i)},[o("td",ao,[o("div",oo,[o("div",null,[o("div",io,P(i.nombre),1),o("div",to,P(i.documento||i.nit||i.codigo||"-"),1)])])]),o("td",ro,[o("span",{class:se(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",{"bg-blue-100 text-blue-800":i.tipo==="auxiliar","bg-green-100 text-green-800":i.tipo==="patologo","bg-yellow-100 text-yellow-800":i.tipo==="residente","bg-purple-100 text-purple-800":i.tipo==="entidad","bg-orange-100 text-orange-800":i.tipo==="pruebas"}])},[o("span",lo,P(i.tipo==="auxiliar"?"Aux":i.tipo==="patologo"?"Pat":i.tipo==="residente"?"Res":i.tipo==="entidad"?"Ent":"Pru"),1),o("span",no,P(i.tipo==="auxiliar"?"Auxiliar":i.tipo==="patologo"?"Patólogo":i.tipo==="residente"?"Residente":i.tipo==="entidad"?"Entidad":"Pruebas"),1)],2)]),o("td",co,P(i.documento||i.nit||i.codigo||"-"),1),o("td",uo,[o("span",{class:se(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",i.activo?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},[o("span",mo,P(i.activo?"✓":"✗"),1),o("span",po,P(i.activo?"Activo":"Inactivo"),1)],2)]),e[1]||(e[1]=o("td",{class:"px-3 md:px-4 py-3 whitespace-nowrap text-right text-sm font-medium"},[o("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])],-1))],10,so))),128))])])])):K("",!0)])):K("",!0)}});class vo{constructor(){ie(this,"endpoint",te.ENDPOINTS.AUXILIARIES)}async getByCode(a){var e,i;try{return{success:!0,data:await Z.get(`${this.endpoint}/${a}`)}}catch(t){return{success:!1,error:((i=(e=t.response)==null?void 0:e.data)==null?void 0:i.detail)||"Error al obtener auxiliar"}}}async updateByCode(a,e){var i,t;try{return{success:!0,data:await Z.put(`${this.endpoint}/${a}`,e)}}catch(d){const c=((t=(i=d.response)==null?void 0:i.data)==null?void 0:t.detail)||d.message||"Error al actualizar auxiliar";return{success:!1,error:Array.isArray(c)?c.join(", "):c}}}prepareUpdateData(a){return{auxiliarName:a.auxiliarName.trim(),AuxiliarEmail:a.AuxiliarEmail.trim(),observaciones:(a.observaciones||"").trim(),isActive:a.isActive,...a.password&&a.password.trim().length>=6?{password:a.password}:{}}}}const Oe=new vo,bo=()=>{const r=M(!1),a=M(""),e=M(null),i=H(()=>!a.value);return{isLoading:r,emailValidationError:a,canSubmit:i,validateForm:u=>{var y,N,$;const w={};return(y=u.auxiliarName)!=null&&y.trim()?u.auxiliarName.trim().length<2?w.auxiliarName="El nombre debe tener al menos 2 caracteres":u.auxiliarName.trim().length>100&&(w.auxiliarName="El nombre no puede exceder 100 caracteres"):w.auxiliarName="El nombre es requerido",(N=u.auxiliarCode)!=null&&N.trim()?u.auxiliarCode.trim().length<3?w.auxiliarCode="El código debe tener al menos 3 caracteres":u.auxiliarCode.trim().length>20&&(w.auxiliarCode="El código no puede exceder 20 caracteres"):w.auxiliarCode="El código es requerido",($=u.AuxiliarEmail)!=null&&$.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u.AuxiliarEmail.trim())||(w.AuxiliarEmail="Formato de email inválido"):w.AuxiliarEmail="El email es requerido",u.observaciones&&u.observaciones.trim().length>500&&(w.observaciones="Las observaciones no pueden exceder 500 caracteres"),{isValid:Object.keys(w).length===0,errors:w}},update:async u=>{r.value=!0;try{const w=Oe.prepareUpdateData(u),y=await Oe.updateByCode(u.auxiliarCode,w);return y.success&&y.data&&(e.value={id:y.data.id,auxiliarName:y.data.auxiliarName,auxiliarCode:y.data.auxiliarCode,AuxiliarEmail:y.data.AuxiliarEmail,observaciones:y.data.observaciones,isActive:y.data.isActive}),y}finally{r.value=!1}},setInitialData:u=>{e.value={...u}},resetToOriginal:()=>e.value?{...e.value}:null,clearMessages:()=>{a.value=""},createHasChanges:u=>{if(!e.value)return!1;const w=!!u.password&&u.password.trim().length>=6;return e.value.auxiliarName!==u.auxiliarName||e.value.auxiliarCode!==u.auxiliarCode||e.value.AuxiliarEmail!==u.AuxiliarEmail||e.value.observaciones!==u.observaciones||e.value.isActive!==u.isActive||w}}},fo={key:0,class:"space-y-6"},Eo={class:"md:col-span-6 flex items-center pt-3"},ho={class:"col-span-full flex flex-col sm:flex-row gap-2 sm:gap-3 sm:justify-end pt-4 border-t border-gray-200"},yo={class:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm"},xo={class:"space-y-4"},Co={class:"mb-4 pb-3 border-b border-gray-100"},wo={class:"text-xl font-bold text-gray-900 mb-2"},Ao={class:"text-gray-600"},_o={class:"font-mono font-bold text-gray-800 ml-1"},Vo={class:"space-y-3 text-sm"},No={class:"text-gray-800 font-semibold"},ko={class:"text-gray-800 font-semibold"},$o={key:0},So={class:"text-gray-800 bg-gray-50 p-3 rounded-lg"},Io={key:1,class:"text-center py-8"},Ro=ae({__name:"FormEdicionAuxiliar",props:{usuario:{}},emits:["usuario-actualizado"],setup(r,{emit:a}){const e=r,i=a,t=M(null),d=M(null),c=Y({visible:!1,type:"success",title:"",message:""}),m=(U,T,B)=>{c.type=U,c.title=T,c.message=B,c.visible=!0},f=async()=>{await de(),t.value&&t.value.scrollIntoView({behavior:"smooth",block:"center"})},{isLoading:g,canSubmit:u,validateForm:w,update:y,setInitialData:N,resetToOriginal:$,clearMessages:n,createHasChanges:l}=bo(),s=Y({id:"",auxiliarName:"",auxiliarCode:"",AuxiliarEmail:"",observaciones:"",isActive:!0}),p=Y({auxiliarName:"",auxiliarCode:"",AuxiliarEmail:"",observaciones:""}),j=H(()=>l(s)),A=H(()=>{var B,J,W;const U=!!s.password&&s.password.trim().length>=6;return u.value&&((B=s.auxiliarName)==null?void 0:B.trim().length)>=2&&((J=s.auxiliarCode)==null?void 0:J.trim().length)>=3&&!!((W=s.AuxiliarEmail)!=null&&W.trim())||U}),b=Y({showValidationError:!1,hasAttemptedSubmit:!1}),V=H(()=>{var T,B,J;if(!b.hasAttemptedSubmit)return[];const U=[];return(!((T=s.auxiliarName)!=null&&T.trim())||p.auxiliarName)&&U.push("Nombre completo válido requerido"),(!((B=s.auxiliarCode)!=null&&B.trim())||p.auxiliarCode)&&U.push("Código de auxiliar válido requerido"),(!((J=s.AuxiliarEmail)!=null&&J.trim())||p.AuxiliarEmail)&&U.push("Email válido requerido"),p.observaciones&&U.push("Observaciones válidas requeridas"),U});X(()=>e.usuario,U=>{if(!U)return;const T={id:U.id,auxiliarName:U.auxiliarName||U.nombre||"",auxiliarCode:U.auxiliarCode||U.codigo||"",AuxiliarEmail:U.AuxiliarEmail||U.email||"",observaciones:U.observaciones||"",isActive:U.isActive!==void 0?U.isActive:U.activo??!0};Object.assign(s,T),N(T)},{immediate:!0,deep:!0}),X(()=>s,()=>{b.hasAttemptedSubmit&&n()},{deep:!0});const v=()=>{const U=$();U&&(Object.assign(s,U),b.hasAttemptedSubmit=!1,b.showValidationError=!1,Object.assign(p,{auxiliarName:"",auxiliarCode:"",AuxiliarEmail:"",observaciones:""}))},R=async()=>{b.hasAttemptedSubmit=!0,Object.assign(p,{auxiliarName:"",auxiliarCode:"",AuxiliarEmail:"",observaciones:""});const U=w(s);if(!U.isValid){Object.assign(p,U.errors),b.showValidationError=!0;return}b.showValidationError=!1;const T=await y(s);if(T.success&&T.data){const B=T.data;d.value=B,m("success","¡Auxiliar Actualizado Exitosamente!",""),await f(),i("usuario-actualizado",{...B,nombre:B.auxiliarName,codigo:B.auxiliarCode,tipo:"auxiliar"})}else m("error","Error al Actualizar Auxiliar",T.error||"No se pudo actualizar el auxiliar"),await f()},Q=U=>{try{return new Date(U).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha no disponible"}};return(U,T)=>s.auxiliarCode?(q(),F("div",fo,[o("form",{onSubmit:ne(R,["prevent"]),class:"grid grid-cols-1 md:grid-cols-12 gap-3 md:gap-4"},[T[11]||(T[11]=o("div",{class:"col-span-full"},[o("h4",{class:"text-base font-semibold text-gray-800"},"Editar Auxiliar administrativo"),o("p",{class:"text-sm text-gray-500 mt-1"},"Modifica los datos del auxiliar")],-1)),_(h(G),{class:"md:col-span-6",label:"Código del auxiliar",disabled:!0,modelValue:s.auxiliarCode,"onUpdate:modelValue":T[0]||(T[0]=B=>s.auxiliarCode=B)},null,8,["modelValue"]),_(h(G),{class:"md:col-span-6",label:"Nombre completo",modelValue:s.auxiliarName,"onUpdate:modelValue":T[1]||(T[1]=B=>s.auxiliarName=B),error:p.auxiliarName},null,8,["modelValue","error"]),_(h(G),{class:"md:col-span-6",label:"Email",type:"email",modelValue:s.AuxiliarEmail,"onUpdate:modelValue":T[2]||(T[2]=B=>s.AuxiliarEmail=B),error:p.AuxiliarEmail,autocomplete:"email"},null,8,["modelValue","error"]),_(h(G),{class:"md:col-span-6",label:"Nueva contraseña (opcional)",type:"password",placeholder:"••••••••","model-value":s.password||"","onUpdate:modelValue":T[3]||(T[3]=B=>s.password=B),autocomplete:"new-password"},null,8,["model-value"]),_(h(ue),{class:"col-span-full",label:"Observaciones",modelValue:s.observaciones,"onUpdate:modelValue":T[4]||(T[4]=B=>s.observaciones=B),rows:3,error:p.observaciones},null,8,["modelValue","error"]),o("div",Eo,[_(h(ce),{label:"Activo",modelValue:s.isActive,"onUpdate:modelValue":T[5]||(T[5]=B=>s.isActive=B)},null,8,["modelValue"])]),o("div",ho,[_(h(re),{type:"button",onClick:v,disabled:h(g)||!j.value,variant:"secondary",text:"Reiniciar",icon:"reset"},{icon:ee(()=>[_(h(we),{class:"w-4 h-4 mr-2"})]),_:1},8,["disabled"]),_(h(pe),{text:"Actualizar Auxiliar",type:"submit",disabled:!A.value||h(g)||!j.value,loading:h(g)},null,8,["disabled","loading"])]),c.visible?(q(),F("div",{key:0,ref_key:"notificationContainer",ref:t,class:"col-span-full"},[_(h(me),{visible:!0,type:c.type,title:c.title,message:c.message,inline:!0,"auto-close":!1,onClose:()=>{}},le({_:2},[c.type==="success"&&d.value?{name:"content",fn:ee(()=>[o("div",yo,[o("div",xo,[o("div",Co,[o("h3",wo,P(d.value.auxiliarName),1),o("p",Ao,[T[6]||(T[6]=o("span",{class:"font-medium"},"Código:",-1)),o("span",_o,P(d.value.auxiliarCode),1)])]),o("div",Vo,[o("div",null,[T[7]||(T[7]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Email:",-1)),o("p",No,P(d.value.AuxiliarEmail),1)]),o("div",null,[T[8]||(T[8]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Estado:",-1)),o("span",{class:se(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",d.value.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},P(d.value.isActive?"Activo":"Inactivo"),3)]),o("div",null,[T[9]||(T[9]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Fecha de actualización:",-1)),o("p",ko,P(Q(d.value.fecha_actualizacion)),1)])]),d.value.observaciones?(q(),F("div",$o,[T[10]||(T[10]=o("span",{class:"text-gray-500 font-medium block mb-2"},"Observaciones:",-1)),o("p",So,P(d.value.observaciones),1)])):K("",!0)])])]),key:"0"}:void 0]),1032,["type","title","message"])],512)):K("",!0),_(h(ge),{visible:b.showValidationError&&b.hasAttemptedSubmit,errors:V.value},null,8,["visible","errors"])],32)])):(q(),F("div",Io,[...T[12]||(T[12]=[o("p",{class:"text-gray-500"},"No se pudieron cargar los datos del auxiliar para edición.",-1)])]))}}),Fe={async getByCode(r){var a,e;try{return{success:!0,data:await Z.get(`/patologos/${r}`)}}catch(i){return{success:!1,error:((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.detail)||i.message}}},async update(r,a){var e,i;try{return{success:!0,data:await Z.put(`/patologos/${r}`,a)}}catch(t){return{success:!1,error:((i=(e=t.response)==null?void 0:e.data)==null?void 0:i.detail)||t.message}}},prepareUpdateData(r){var a;return{patologoName:r.patologoName.trim(),InicialesPatologo:r.InicialesPatologo.trim(),PatologoEmail:r.PatologoEmail.trim(),registro_medico:r.registro_medico.trim(),observaciones:((a=r.observaciones)==null?void 0:a.trim())||"",isActive:r.isActive,...r.password&&r.password.trim().length>=6?{password:r.password}:{}}}},Po=()=>{const r=M(!1),a=M(null),e=H(()=>!0);return{isLoading:r,canSubmit:e,validateForm:f=>{var u,w,y,N;const g={};return(u=f.patologoName)!=null&&u.trim()||(g.patologoName="El nombre es requerido"),(!((w=f.InicialesPatologo)!=null&&w.trim())||f.InicialesPatologo.trim().length<2)&&(g.InicialesPatologo="Iniciales válidas requeridas"),(y=f.PatologoEmail)!=null&&y.trim()||(g.PatologoEmail="Email requerido"),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f.PatologoEmail)||(g.PatologoEmail="Email inválido"),(N=f.registro_medico)!=null&&N.trim()||(g.registro_medico="Registro médico requerido"),{isValid:Object.keys(g).length===0,errors:g}},update:async f=>{r.value=!0;try{const g=Fe.prepareUpdateData(f),u=await Fe.update(f.patologoCode,g);return u.success&&u.data&&(a.value={id:u.data.id,patologoName:u.data.patologoName,InicialesPatologo:u.data.InicialesPatologo||"",patologoCode:u.data.patologoCode,PatologoEmail:u.data.PatologoEmail,registro_medico:u.data.registro_medico,firma:u.data.firma||"",observaciones:u.data.observaciones||"",isActive:u.data.isActive}),u}finally{r.value=!1}},setInitialData:f=>{a.value={...f}},resetToOriginal:()=>a.value?{...a.value}:null,createHasChanges:f=>{if(!a.value)return!1;const g=!!f.password&&f.password.trim().length>=6;return a.value.patologoName!==f.patologoName||a.value.InicialesPatologo!==f.InicialesPatologo||a.value.PatologoEmail!==f.PatologoEmail||a.value.registro_medico!==f.registro_medico||a.value.observaciones!==f.observaciones||a.value.isActive!==f.isActive||g}}},Mo={key:0,class:"space-y-6"},Lo={class:"md:col-span-6 flex items-center pt-3"},jo={class:"col-span-full flex flex-col sm:flex-row gap-2 sm:gap-3 sm:justify-end pt-4 border-t border-gray-200"},qo={class:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm"},zo={class:"space-y-4"},To={class:"mb-4 pb-3 border-b border-gray-100"},Uo={class:"text-xl font-bold text-gray-900 mb-2"},Oo={class:"text-gray-600"},Fo={class:"font-mono font-bold text-gray-800 ml-1"},Bo={class:"space-y-3 text-sm"},Do={class:"text-gray-800 font-semibold"},Yo={class:"text-gray-800 font-semibold"},Ho={class:"text-gray-800 font-semibold"},Go={class:"text-gray-800 font-semibold"},Zo={key:0},Jo={class:"text-gray-800 bg-gray-50 p-3 rounded-lg"},Ko={key:1,class:"text-center py-8"},Xo=ae({__name:"FormEdicionPatologo",props:{usuario:{}},setup(r){const a=r,e=M(null),i=M(null),t=Y({visible:!1,type:"success",title:"",message:""}),d=Y({showValidationError:!1,hasAttemptedSubmit:!1}),c=(V,v,R)=>{t.type=V,t.title=v,t.message=R,t.visible=!0},m=async()=>{await de(),e.value&&e.value.scrollIntoView({behavior:"smooth",block:"center"})},f=V=>{try{return new Date(V).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha no disponible"}},{isLoading:g,canSubmit:u,validateForm:w,update:y,setInitialData:N,resetToOriginal:$,createHasChanges:n}=Po(),l=H(()=>{var R,Q,U,T,B;const V=!!s.password&&s.password.trim().length>=6;return u.value&&((R=s.patologoName)==null?void 0:R.trim().length)>=2&&((Q=s.InicialesPatologo)==null?void 0:Q.trim().length)>=2&&((U=s.patologoCode)==null?void 0:U.trim().length)>=6&&((T=s.PatologoEmail)==null?void 0:T.trim().length)>0&&((B=s.registro_medico)==null?void 0:B.trim().length)>=5||V}),s=Y({id:"",patologoName:"",InicialesPatologo:"",patologoCode:"",PatologoEmail:"",registro_medico:"",observaciones:"",isActive:!0}),p=H(()=>n(s)),j=H(()=>{var v,R,Q,U;if(!d.hasAttemptedSubmit)return[];const V=[];return(v=s.patologoName)!=null&&v.trim()||V.push("Nombre completo válido requerido"),(!((R=s.InicialesPatologo)!=null&&R.trim())||s.InicialesPatologo.trim().length<2)&&V.push("Iniciales válidas requeridas"),(Q=s.PatologoEmail)!=null&&Q.trim()||V.push("Email válido requerido"),(U=s.registro_medico)!=null&&U.trim()||V.push("Registro médico válido requerido"),V});X(()=>a.usuario,V=>{if(!V)return;const v={id:V.id,patologoName:V.patologoName||V.nombre||"",InicialesPatologo:V.InicialesPatologo||"",patologoCode:V.patologoCode||V.codigo||"",PatologoEmail:V.PatologoEmail||V.email||"",registro_medico:V.registro_medico||"",observaciones:V.observaciones||"",isActive:V.isActive??V.activo??!0};Object.assign(s,v),N(v)},{immediate:!0,deep:!0});const A=()=>{const V=$();V&&Object.assign(s,V)},b=async()=>{if(d.hasAttemptedSubmit=!0,!w(s).isValid){d.showValidationError=!0;return}d.showValidationError=!1;const v=await y(s);v.success&&v.data?(i.value=v.data,c("success","¡Patólogo Actualizado Exitosamente!",""),await m()):(c("error","Error al Actualizar Patólogo",v.error||"No se pudo actualizar el patólogo"),await m())};return(V,v)=>s.patologoCode?(q(),F("div",Mo,[o("form",{onSubmit:ne(b,["prevent"]),class:"grid grid-cols-1 md:grid-cols-12 gap-3 md:gap-4"},[v[15]||(v[15]=o("div",{class:"col-span-full"},[o("h4",{class:"text-base font-semibold text-gray-800"},"Editar Patólogo"),o("p",{class:"text-sm text-gray-500 mt-1"},"Modifica los datos del patólogo")],-1)),_(h(G),{class:"md:col-span-6",label:"Código del patólogo",disabled:!0,modelValue:s.patologoCode,"onUpdate:modelValue":v[0]||(v[0]=R=>s.patologoCode=R)},null,8,["modelValue"]),_(h(G),{class:"md:col-span-6",label:"Nombre completo",modelValue:s.patologoName,"onUpdate:modelValue":v[1]||(v[1]=R=>s.patologoName=R)},null,8,["modelValue"]),_(h(G),{class:"md:col-span-6",label:"Iniciales",modelValue:s.InicialesPatologo,"onUpdate:modelValue":v[2]||(v[2]=R=>s.InicialesPatologo=R),maxlength:"10"},null,8,["modelValue"]),_(h(G),{class:"md:col-span-6",label:"Email",type:"email",modelValue:s.PatologoEmail,"onUpdate:modelValue":v[3]||(v[3]=R=>s.PatologoEmail=R)},null,8,["modelValue"]),_(h(G),{class:"md:col-span-6",label:"Registro médico",modelValue:s.registro_medico,"onUpdate:modelValue":v[4]||(v[4]=R=>s.registro_medico=R)},null,8,["modelValue"]),_(h(G),{class:"md:col-span-6",label:"Nueva contraseña (opcional)",placeholder:"••••••••",type:"password","model-value":s.password||"","onUpdate:modelValue":v[5]||(v[5]=R=>s.password=R)},null,8,["model-value"]),_(h(ue),{class:"col-span-full",label:"Observaciones",modelValue:s.observaciones,"onUpdate:modelValue":v[6]||(v[6]=R=>s.observaciones=R),rows:3},null,8,["modelValue"]),o("div",Lo,[_(h(ce),{label:"Activo",modelValue:s.isActive,"onUpdate:modelValue":v[7]||(v[7]=R=>s.isActive=R)},null,8,["modelValue"])]),o("div",jo,[_(h(re),{type:"button",onClick:A,disabled:h(g)||!p.value,variant:"secondary",text:"Reiniciar",icon:"reset"},{icon:ee(()=>[_(h(we),{class:"w-4 h-4 mr-2"})]),_:1},8,["disabled"]),_(h(pe),{text:"Actualizar Patólogo",type:"submit",disabled:!l.value||h(g)||!p.value,loading:h(g)},null,8,["disabled","loading"])]),t.visible?(q(),F("div",{key:0,ref_key:"notificationContainer",ref:e,class:"col-span-full"},[_(h(me),{visible:!0,type:t.type,title:t.title,message:t.message,inline:!0,"auto-close":!1,onClose:()=>{}},le({_:2},[t.type==="success"&&i.value?{name:"content",fn:ee(()=>[o("div",qo,[o("div",zo,[o("div",To,[o("h3",Uo,P(i.value.patologoName),1),o("p",Oo,[v[8]||(v[8]=o("span",{class:"font-medium"},"Código:",-1)),o("span",Fo,P(i.value.patologoCode),1)])]),o("div",Bo,[o("div",null,[v[9]||(v[9]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Iniciales:",-1)),o("p",Do,P(i.value.InicialesPatologo||"—"),1)]),o("div",null,[v[10]||(v[10]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Email:",-1)),o("p",Yo,P(i.value.PatologoEmail),1)]),o("div",null,[v[11]||(v[11]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Registro médico:",-1)),o("p",Ho,P(i.value.registro_medico),1)]),o("div",null,[v[12]||(v[12]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Estado:",-1)),o("span",{class:se(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",i.value.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},P(i.value.isActive?"Activo":"Inactivo"),3)]),o("div",null,[v[13]||(v[13]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Fecha de actualización:",-1)),o("p",Go,P(f(i.value.fecha_actualizacion)),1)])]),i.value.observaciones?(q(),F("div",Zo,[v[14]||(v[14]=o("span",{class:"text-gray-500 font-medium block mb-2"},"Observaciones:",-1)),o("p",Jo,P(i.value.observaciones),1)])):K("",!0)])])]),key:"0"}:void 0]),1032,["type","title","message"])],512)):K("",!0),_(h(ge),{visible:d.showValidationError&&d.hasAttemptedSubmit,errors:j.value},null,8,["visible","errors"])],32)])):(q(),F("div",Ko,[...v[16]||(v[16]=[o("p",{class:"text-gray-500"},"No se pudieron cargar los datos del patólogo para edición.",-1)])]))}}),ye={async getResidentByCode(r){var a,e;try{return{success:!0,data:(await Z.get(`/residentes/${r}`)).data}}catch(i){return{success:!1,error:((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.detail)||"Error al obtener residente"}}},async updateResident(r,a){var e,i;try{const t=await Z.put(`/residentes/${r}`,a);return{success:!0,data:t.data||t}}catch(t){const d=((i=(e=t.response)==null?void 0:e.data)==null?void 0:i.detail)||t.message||"Error al actualizar residente";return{success:!1,error:Array.isArray(d)?d.join(", "):d}}},async checkCodeExists(r,a){var e;if(r===a)return{available:!0};try{const i=await Z.get(`/residentes/${r}`);return{available:!1,error:"Este código ya está en uso"}}catch(i){return((e=i.response)==null?void 0:e.status)===404?{available:!0}:{available:!1,error:"Error al verificar disponibilidad del código"}}},async checkEmailExists(r,a){if(r===a)return{available:!0};try{const e=await Z.get("/residentes/search",{params:{ResidenteEmail:r,limit:1}});return e.data&&e.data.residentes&&e.data.residentes.length>0?{available:!1,error:"Este email ya está en uso"}:{available:!0}}catch{return{available:!1,error:"Error al verificar disponibilidad del email"}}},async checkLicenseExists(r,a){if(r===a)return{available:!0};try{const e=await Z.get("/residentes/search",{params:{registro_medico:r,limit:1}});return e.data&&e.data.residentes&&e.data.residentes.length>0?{available:!1,error:"Este registro médico ya está en uso"}:{available:!0}}catch{return{available:!1,error:"Error al verificar disponibilidad del registro médico"}}},prepareUpdateData(r){return{residenteName:r.residenteName.trim(),InicialesResidente:r.InicialesResidente.trim(),ResidenteEmail:r.ResidenteEmail.trim(),registro_medico:r.registro_medico.trim(),observaciones:r.observaciones.trim(),isActive:r.isActive,...r.password&&r.password.trim().length>=6?{password:r.password}:{}}}},Qo=()=>{const r=M(!1),a=M(""),e=M(""),i=M(""),t=M(null),d=H(()=>!a.value&&!e.value&&!i.value),c=l=>{var p,j,A,b,V;const s={};return(p=l.residenteName)!=null&&p.trim()?l.residenteName.trim().length<2?s.residenteName="El nombre debe tener al menos 2 caracteres":l.residenteName.trim().length>100&&(s.residenteName="El nombre no puede exceder 100 caracteres"):s.residenteName="El nombre es requerido",(j=l.InicialesResidente)!=null&&j.trim()?l.InicialesResidente.trim().length<2?s.InicialesResidente="Las iniciales deben tener al menos 2 caracteres":l.InicialesResidente.trim().length>10&&(s.InicialesResidente="Las iniciales no pueden exceder 10 caracteres"):s.InicialesResidente="Las iniciales son requeridas",(A=l.residenteCode)!=null&&A.trim()?l.residenteCode.trim().length<3?s.residenteCode="El código debe tener al menos 3 caracteres":l.residenteCode.trim().length>20&&(s.residenteCode="El código no puede exceder 20 caracteres"):s.residenteCode="El código es requerido",(b=l.ResidenteEmail)!=null&&b.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.ResidenteEmail.trim())||(s.ResidenteEmail="Formato de email inválido"):s.ResidenteEmail="El email es requerido",(V=l.registro_medico)!=null&&V.trim()?l.registro_medico.trim().length<3?s.registro_medico="El registro médico debe tener al menos 3 caracteres":l.registro_medico.trim().length>50&&(s.registro_medico="El registro médico no puede exceder 50 caracteres"):s.registro_medico="El registro médico es requerido",l.observaciones&&l.observaciones.trim().length>500&&(s.observaciones="Las observaciones no pueden exceder 500 caracteres"),{isValid:Object.keys(s).length===0,errors:s}},m=async l=>{if(t.value){if(a.value="",!(l!=null&&l.trim())){a.value="El código es requerido";return}if(l.trim().length<3){a.value="Mínimo 3 caracteres";return}if(l.trim().length>20){a.value="Máximo 20 caracteres";return}try{const s=await ye.checkCodeExists(l.trim(),t.value.residenteCode);s.available||(a.value=s.error||"Código no disponible")}catch{a.value="Error al verificar código"}}},f=async l=>{if(t.value){if(e.value="",!(l!=null&&l.trim())){e.value="El email es requerido";return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.trim())){e.value="Formato de email inválido";return}try{const s=await ye.checkEmailExists(l.trim(),t.value.ResidenteEmail);s.available||(e.value=s.error||"Email no disponible")}catch{e.value="Error al verificar email"}}},g=async l=>{if(t.value){if(i.value="",!(l!=null&&l.trim())){i.value="El registro médico es requerido";return}if(l.trim().length<3){i.value="Mínimo 3 caracteres";return}if(l.trim().length>50){i.value="Máximo 50 caracteres";return}try{const s=await ye.checkLicenseExists(l.trim(),t.value.registro_medico);s.available||(i.value=s.error||"Registro médico no disponible")}catch{i.value="Error al verificar registro médico"}}},u=async l=>{r.value=!0;try{const s=ye.prepareUpdateData(l),p=await ye.updateResident(l.residenteCode,s);return p.success&&p.data&&(t.value={id:p.data.id,residenteName:p.data.residenteName,InicialesResidente:p.data.InicialesResidente,residenteCode:p.data.residenteCode,ResidenteEmail:p.data.ResidenteEmail,registro_medico:p.data.registro_medico,observaciones:p.data.observaciones,isActive:p.data.isActive}),p}catch(s){return{success:!1,error:s.message||"Error al actualizar residente"}}finally{r.value=!1}},w=l=>{t.value={...l}},y=()=>t.value?{...t.value}:null,N=()=>{r.value=!1,t.value=null,$()},$=()=>{a.value="",e.value="",i.value=""};return{isLoading:r,codeValidationError:a,emailValidationError:e,licenseValidationError:i,canSubmit:d,validateForm:c,checkCodeAvailability:m,checkEmailAvailability:f,checkLicenseAvailability:g,updateResident:u,setInitialData:w,resetToOriginal:y,clearState:N,clearMessages:$,createHasChanges:l=>{if(!t.value)return!1;const s=!!l.password&&l.password.trim().length>=6;return t.value.residenteName!==l.residenteName||t.value.InicialesResidente!==l.InicialesResidente||t.value.residenteCode!==l.residenteCode||t.value.ResidenteEmail!==l.ResidenteEmail||t.value.registro_medico!==l.registro_medico||t.value.observaciones!==l.observaciones||t.value.isActive!==l.isActive||s}}},Wo={key:0,class:"space-y-6"},ei={class:"col-span-full md:col-span-6 flex items-center pt-3"},si={class:"col-span-full flex flex-col sm:flex-row gap-2 sm:gap-3 sm:justify-end pt-4 border-t border-gray-200"},ai={class:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm"},oi={class:"space-y-4"},ii={class:"mb-4 pb-3 border-b border-gray-100"},ti={class:"text-xl font-bold text-gray-900 mb-2"},ri={class:"text-gray-600"},li={class:"font-mono font-bold text-gray-800 ml-1"},ni={class:"space-y-4 text-sm"},di={class:"text-gray-800 font-semibold"},ci={class:"text-gray-800 font-semibold"},ui={class:"text-gray-800 font-semibold"},mi={class:"text-gray-800 font-semibold"},pi={key:0},gi={class:"text-gray-800 bg-gray-50 p-3 rounded-lg"},vi={key:1,class:"text-center py-8"},bi=ae({__name:"FormEdicionResident",props:{usuario:{}},emits:["usuario-actualizado"],setup(r,{emit:a}){const e=r,i=a,t=M(null),d=M(null),c=Y({visible:!1,type:"success",title:"",message:""}),m=Y({showValidationError:!1,hasAttemptedSubmit:!1}),{isLoading:f,codeValidationError:g,emailValidationError:u,licenseValidationError:w,canSubmit:y,validateForm:N,checkEmailAvailability:$,checkLicenseAvailability:n,updateResident:l,setInitialData:s,resetToOriginal:p,clearMessages:j,createHasChanges:A}=Qo(),b=Y({id:"",residenteName:"",InicialesResidente:"",residenteCode:"",ResidenteEmail:"",registro_medico:"",observaciones:"",isActive:!0}),V=Y({residenteName:"",InicialesResidente:"",residenteCode:"",ResidenteEmail:"",registro_medico:"",observaciones:""}),v=H(()=>A(b)),R=H(()=>{var k,E,x,z,ve;const L=!!b.password&&b.password.trim().length>=6;return y.value&&((k=b.residenteName)==null?void 0:k.trim().length)>=2&&((E=b.InicialesResidente)==null?void 0:E.trim().length)>=2&&((x=b.residenteCode)==null?void 0:x.trim().length)>=3&&((z=b.ResidenteEmail)==null?void 0:z.trim().length)>0&&((ve=b.registro_medico)==null?void 0:ve.trim().length)>=3||L}),Q=H(()=>{if(!m.hasAttemptedSubmit)return[];const L=[];return(!b.residenteName||V.residenteName)&&L.push("Nombre completo válido requerido"),(!b.InicialesResidente||V.InicialesResidente)&&L.push("Iniciales válidas requeridas"),(!b.residenteCode||V.residenteCode)&&L.push("Código de residente válido requerido"),(!b.ResidenteEmail||V.ResidenteEmail)&&L.push("Email válido requerido"),(!b.registro_medico||V.registro_medico)&&L.push("Registro médico válido requerido"),V.observaciones&&L.push("Observaciones válidas requeridas"),L}),U=()=>{if(!e.usuario)return;const L={id:e.usuario.id,residenteName:e.usuario.residenteName||e.usuario.nombre||"",InicialesResidente:e.usuario.InicialesResidente||"",residenteCode:e.usuario.residenteCode||e.usuario.codigo||"",ResidenteEmail:e.usuario.ResidenteEmail||e.usuario.email||"",registro_medico:e.usuario.registro_medico||"",observaciones:e.usuario.observaciones||"",isActive:e.usuario.isActive!==void 0?e.usuario.isActive:e.usuario.activo||!1};Object.assign(b,L),s(L)};X(()=>e.usuario,()=>{e.usuario&&U()},{immediate:!0,deep:!0}),X(()=>b,()=>{m.hasAttemptedSubmit&&!c.visible&&(j(),J())},{deep:!0});const T=async()=>{var L;if(V.ResidenteEmail="",!((L=b.ResidenteEmail)!=null&&L.trim())){V.ResidenteEmail="El email es requerido";return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b.ResidenteEmail)){V.ResidenteEmail="Formato de email inválido";return}await $(b.ResidenteEmail),u.value&&(V.ResidenteEmail=u.value)},B=async()=>{var L;if(V.registro_medico="",!((L=b.registro_medico)!=null&&L.trim())){V.registro_medico="El registro médico es requerido";return}if(b.registro_medico.length<3){V.registro_medico="Mínimo 3 caracteres";return}if(b.registro_medico.length>50){V.registro_medico="Máximo 50 caracteres";return}await n(b.registro_medico),w.value&&(V.registro_medico=w.value)},J=()=>{Object.keys(V).forEach(L=>{V[L]=""})},W=(L,I,k)=>{c.type=L,c.title=I,c.message=k,c.visible=!0},D=async()=>{await de(),t.value&&t.value.scrollIntoView({behavior:"smooth",block:"center"})},C=L=>{try{return new Date(L).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha no disponible"}},S=async()=>{m.hasAttemptedSubmit=!0,J();const L=N(b);if(!L.isValid){Object.assign(V,L.errors),m.showValidationError=!0;return}m.showValidationError=!1;try{const I=await l(b);if(I.success&&I.data){const k=I.data;d.value=k,W("success","¡Residente Actualizado Exitosamente!",""),await D(),i("usuario-actualizado",{...k,nombre:k.residenteName,codigo:k.residenteCode,tipo:"residente"})}else W("error","Error al Actualizar Residente","No se pudo actualizar el residente")}catch(I){W("error","Error al Actualizar Residente",I.message||"Error inesperado")}},O=()=>{const L=p();L&&(Object.assign(b,L),J(),m.hasAttemptedSubmit=!1,m.showValidationError=!1)};return(L,I)=>b.residenteCode?(q(),F("div",Wo,[o("form",{onSubmit:ne(S,["prevent"]),class:"grid grid-cols-1 md:grid-cols-12 gap-3 md:gap-4"},[I[15]||(I[15]=o("div",{class:"col-span-full"},[o("h4",{class:"text-base font-semibold text-gray-800"},"Editar Residente"),o("p",{class:"text-sm text-gray-500 mt-1"},"Modifica los datos del residente médico")],-1)),_(h(G),{class:"col-span-full md:col-span-6",label:"Código del residente",placeholder:"Ejemplo: 12345678",modelValue:b.residenteCode,"onUpdate:modelValue":I[0]||(I[0]=k=>b.residenteCode=k),error:V.residenteCode||h(g),disabled:!0,autocomplete:"off"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Nombre completo",placeholder:"Ejemplo: María Elena Rodríguez",modelValue:b.residenteName,"onUpdate:modelValue":I[1]||(I[1]=k=>b.residenteName=k),error:V.residenteName,autocomplete:"name"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Iniciales del residente",placeholder:"Ejemplo: MER",modelValue:b.InicialesResidente,"onUpdate:modelValue":I[2]||(I[2]=k=>b.InicialesResidente=k),error:V.InicialesResidente,autocomplete:"off",maxlength:"10"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Email",type:"email",placeholder:"maria.rodriguez@udea.edu.co",modelValue:b.ResidenteEmail,"onUpdate:modelValue":I[3]||(I[3]=k=>b.ResidenteEmail=k),error:V.ResidenteEmail||h(u),onBlur:T,autocomplete:"email"},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Registro médico",placeholder:"Ejemplo: RM-2024-001",modelValue:b.registro_medico,"onUpdate:modelValue":I[4]||(I[4]=k=>b.registro_medico=k),error:V.registro_medico||h(w),onBlur:B},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Nueva contraseña (opcional)",type:"password",placeholder:"••••••••",modelValue:b.password,"onUpdate:modelValue":I[5]||(I[5]=k=>b.password=k),autocomplete:"new-password"},null,8,["modelValue"]),_(h(ue),{class:"col-span-full",label:"Observaciones",placeholder:"Notas adicionales sobre el residente (opcional)",modelValue:b.observaciones,"onUpdate:modelValue":I[6]||(I[6]=k=>b.observaciones=k),rows:3,error:V.observaciones},null,8,["modelValue","error"]),o("div",ei,[_(h(ce),{label:"Activo",modelValue:b.isActive,"onUpdate:modelValue":I[7]||(I[7]=k=>b.isActive=k)},null,8,["modelValue"])]),o("div",si,[_(h(re),{type:"button",onClick:O,disabled:h(f)||!v.value,variant:"secondary",text:"Reiniciar",icon:"reset"},{icon:ee(()=>[_(h(we),{class:"w-4 h-4 mr-2"})]),_:1},8,["disabled"]),_(h(pe),{text:"Actualizar Residente",type:"submit",disabled:!R.value||h(f)||!v.value,loading:h(f)},null,8,["disabled","loading"])]),c.visible?(q(),F("div",{key:0,ref_key:"notificationContainer",ref:t,class:"col-span-full"},[_(h(me),{visible:!0,type:c.type,title:c.title,message:c.message,inline:!0,"auto-close":!1,onClose:()=>{}},le({_:2},[c.type==="success"&&d.value?{name:"content",fn:ee(()=>[o("div",ai,[o("div",oi,[o("div",ii,[o("h3",ti,P(d.value.residenteName),1),o("p",ri,[I[8]||(I[8]=o("span",{class:"font-medium"},"Código:",-1)),o("span",li,P(d.value.residenteCode),1)])]),o("div",ni,[o("div",null,[I[9]||(I[9]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Iniciales:",-1)),o("p",di,P(d.value.InicialesResidente),1)]),o("div",null,[I[10]||(I[10]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Email:",-1)),o("p",ci,P(d.value.ResidenteEmail),1)]),o("div",null,[I[11]||(I[11]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Registro médico:",-1)),o("p",ui,P(d.value.registro_medico),1)]),o("div",null,[I[12]||(I[12]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Estado:",-1)),o("span",{class:se(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",d.value.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},P(d.value.isActive?"Activo":"Inactivo"),3)]),o("div",null,[I[13]||(I[13]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Fecha de actualización:",-1)),o("p",mi,P(C(d.value.fecha_actualizacion)),1)])]),d.value.observaciones?(q(),F("div",pi,[I[14]||(I[14]=o("span",{class:"text-gray-500 font-medium block mb-2"},"Observaciones:",-1)),o("p",gi,P(d.value.observaciones),1)])):K("",!0)])])]),key:"0"}:void 0]),1032,["type","title","message"])],512)):K("",!0),_(h(ge),{visible:m.showValidationError&&m.hasAttemptedSubmit,errors:Q.value},null,8,["visible","errors"])],32)])):(q(),F("div",vi,[...I[16]||(I[16]=[o("p",{class:"text-gray-500"},"No se pudieron cargar los datos del residente para edición.",-1),o("p",{class:"text-sm text-gray-400 mt-2"},"Faltan datos críticos: ID o código del residente.",-1)])]))}});class fi{constructor(){ie(this,"endpoint",te.ENDPOINTS.ENTITIES)}async getByCode(a){const e=await Z.get(`${this.endpoint}/code/${a}`);return{id:e.id,EntidadName:e.EntidadName,EntidadCode:e.EntidadCode,observaciones:e.observaciones,isActive:e.isActive}}async updateByCode(a,e){return await Z.put(`${this.endpoint}/code/${a}`,e)}async checkCodeExists(a,e){var i;if(e&&a===e)return!1;try{return await Z.get(`${this.endpoint}/code/${a}`),!0}catch(t){return((i=t.response)==null?void 0:i.status)!==404}}prepareUpdateData(a,e){const i={};return a.EntidadName!==e.EntidadName&&(i.EntidadName=e.EntidadName),a.EntidadCode!==e.EntidadCode&&(i.EntidadCode=e.EntidadCode),a.observaciones!==e.observaciones&&(i.observaciones=e.observaciones),a.isActive!==e.isActive&&(i.isActive=e.isActive),i}}const Ne=new fi;function Ei(){const r=Y({isLoading:!1,isSuccess:!1,error:"",successMessage:""}),a=M(!1),e=M(!1),i=M(""),t=M(null),d=H(()=>!r.isLoading&&!a.value&&!e.value),c=n=>{var s,p;const l={};return(!((s=n.EntidadName)!=null&&s.trim())||n.EntidadName.length<2)&&(l.EntidadName="Nombre inválido"),(!((p=n.EntidadCode)!=null&&p.trim())||n.EntidadCode.length<2)&&(l.EntidadCode="Código inválido"),n.observaciones&&n.observaciones.length>500&&(l.observaciones="Máximo 500 caracteres"),{isValid:Object.keys(l).length===0,errors:l}},m=async n=>{e.value=!0,r.error="";try{const l=await Ne.getByCode(n);return t.value={...l},{success:!0,data:l}}catch(l){return r.error=l.message||"Error al cargar la entidad",{success:!1}}finally{e.value=!1}},f=async(n,l)=>{if(!(n!=null&&n.trim())||n.length<2)return!0;a.value=!0,i.value="";try{return await Ne.checkCodeExists(n.trim(),l)?(i.value="Este código ya está en uso",!1):!0}catch{return i.value="Error al verificar el código",!1}finally{a.value=!1}},g=n=>t.value?t.value.EntidadName!==n.EntidadName||t.value.EntidadCode!==n.EntidadCode||t.value.observaciones!==n.observaciones||t.value.isActive!==n.isActive:!1,u=async n=>{if(!t.value)return r.error="No se han cargado los datos originales",{success:!1};r.error="",r.isSuccess=!1,r.successMessage="";const l=c(n);if(!l.isValid)return r.error=Object.values(l.errors).filter(Boolean).join(", "),{success:!1};if(n.EntidadCode!==t.value.EntidadCode&&!await f(n.EntidadCode,t.value.EntidadCode))return r.error=i.value||"Código no disponible",{success:!1};r.isLoading=!0;try{const s=Ne.prepareUpdateData(t.value,n);if(Object.keys(s).length===0)return r.successMessage="No hay cambios para actualizar",{success:!0,data:n};const p=await Ne.updateByCode(t.value.EntidadCode,s);return t.value={id:p.id,EntidadName:p.EntidadName,EntidadCode:p.EntidadCode,observaciones:p.observaciones,isActive:p.isActive},r.isSuccess=!0,r.successMessage=`Entidad "${p.EntidadName}" actualizada exitosamente`,{success:!0,data:p}}catch(s){return r.error=s.message||"Error al actualizar la entidad",{success:!1}}finally{r.isLoading=!1}},w=n=>{t.value={...n}},y=()=>t.value?{...t.value}:null,N=()=>{r.isLoading=!1,r.isSuccess=!1,r.error="",r.successMessage="",a.value=!1,e.value=!1,i.value="",t.value=null},$=()=>{r.error="",r.successMessage="",r.isSuccess=!1,i.value=""};return{state:r,isCheckingCode:ke(a),isLoadingEntity:ke(e),codeValidationError:ke(i),originalEntityData:ke(t),canSubmit:d,validateForm:c,loadEntityForEdition:m,checkCodeAvailability:f,updateEntity:u,setInitialData:w,resetToOriginal:y,clearState:N,clearMessages:$,hasChangesFactory:g}}function ke(r){return H(()=>r.value)}const hi={class:"col-span-full md:col-span-6 flex items-center pt-3"},yi={class:"col-span-full flex flex-col sm:flex-row gap-2 sm:gap-3 sm:justify-end pt-4 border-t border-gray-200"},xi={class:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm"},Ci={class:"space-y-4"},wi={class:"mb-4 pb-3 border-b border-gray-100"},Ai={class:"text-xl font-bold text-gray-900 mb-2"},_i={class:"text-gray-600"},Vi={class:"font-mono font-bold text-gray-800 ml-1"},Ni={class:"space-y-4 text-sm"},ki={class:"text-gray-800 font-semibold"},$i={key:0},Si={class:"text-gray-800 bg-gray-50 p-3 rounded-lg"},Ii=ae({__name:"FormEdicionEntidad",props:{usuario:{},usuarioActualizado:{type:Boolean},mensajeExito:{}},emits:["usuario-actualizado","cancelar"],setup(r,{emit:a}){const e=r,i=a,{state:t,codeValidationError:d,originalEntityData:c,canSubmit:m,validateForm:f,checkCodeAvailability:g,updateEntity:u,setInitialData:w,resetToOriginal:y,clearState:N,hasChangesFactory:$}=Ei(),n=H(()=>t.isLoading),l=M(null),s=Y({visible:!1,type:"success",title:"",message:""}),p=M(null),j=(D,C,S)=>{s.type=D,s.title=C,s.message=S,s.visible=!0},A=async()=>{await de(),l.value&&l.value.scrollIntoView({behavior:"smooth",block:"center"})},b=D=>{try{return new Date(D).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha no disponible"}},V=Y({id:"",EntidadName:"",EntidadCode:"",observaciones:"",isActive:!0}),v=Y({EntidadName:"",EntidadCode:"",observaciones:""}),R=Y({showValidationError:!1,hasAttemptedSubmit:!1}),Q=H(()=>{if(!R.hasAttemptedSubmit)return[];const D=[];return(!V.EntidadName||v.EntidadName)&&D.push("Nombre válido requerido"),(!V.EntidadCode||v.EntidadCode)&&D.push("Código válido requerido"),v.observaciones&&D.push("Observaciones válidas requeridas"),D}),U=H(()=>$(V)),T=async()=>{var C,S;if(v.EntidadCode="",!((C=V.EntidadCode)!=null&&C.trim())){v.EntidadCode="El código es requerido";return}if(V.EntidadCode.length<2){v.EntidadCode="Mínimo 2 caracteres";return}if(V.EntidadCode.length>20){v.EntidadCode="Máximo 20 caracteres";return}if(!/^[A-Z0-9_-]+$/i.test(V.EntidadCode)){v.EntidadCode="Solo letras, números, guiones y guiones bajos";return}const D=(S=c.value)==null?void 0:S.EntidadCode;await g(V.EntidadCode,D),d.value&&(v.EntidadCode=d.value)},B=()=>{Object.keys(v).forEach(D=>{v[D]=""})},J=async()=>{R.hasAttemptedSubmit=!0,B();const D=f(V);if(!D.isValid){Object.assign(v,D.errors),R.showValidationError=!0;return}R.showValidationError=!1;try{const C=await u(V);C.success&&C.data?(p.value=C.data,j("success","¡Entidad Actualizada Exitosamente!",""),await A(),i("usuario-actualizado",{...C.data,nombre:C.data.EntidadName,codigo:C.data.EntidadCode,tipo:"entidad"})):j("error","Error al Actualizar Entidad","No se pudo actualizar la entidad")}catch(C){j("error","Error al Actualizar Entidad",C.message||"Error inesperado")}},W=()=>{const D=y();D&&(Object.assign(V,D),B(),R.hasAttemptedSubmit=!1,R.showValidationError=!1)};return X(()=>e.usuario,D=>{if(D){const C={id:D.id||D.codigo||D.EntidadCode,EntidadName:D.EntidadName||D.nombre||"",EntidadCode:D.EntidadCode||D.codigo||"",observaciones:D.observaciones||"",isActive:D.isActive??D.activo??!0};Object.assign(V,C),w(C)}else N()},{immediate:!0,deep:!0}),(D,C)=>(q(),F("form",{onSubmit:ne(J,["prevent"]),class:"grid grid-cols-1 md:grid-cols-12 gap-3 md:gap-4"},[C[8]||(C[8]=o("div",{class:"col-span-full"},[o("h4",{class:"text-base font-semibold text-gray-800"},"Editar Entidad"),o("p",{class:"text-sm text-gray-600 mt-1"},"Modifica los datos de la entidad")],-1)),_(h(G),{class:"col-span-full md:col-span-6",label:"Código de entidad",modelValue:V.EntidadCode,"onUpdate:modelValue":C[0]||(C[0]=S=>V.EntidadCode=S),error:v.EntidadCode,onBlur:T,disabled:!0},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Nombre de entidad",modelValue:V.EntidadName,"onUpdate:modelValue":C[1]||(C[1]=S=>V.EntidadName=S),error:v.EntidadName},null,8,["modelValue","error"]),_(h(ue),{class:"col-span-full",label:"Observaciones",modelValue:V.observaciones,"onUpdate:modelValue":C[2]||(C[2]=S=>V.observaciones=S),rows:"3",error:v.observaciones},null,8,["modelValue","error"]),o("div",hi,[_(h(ce),{label:"Activo",modelValue:V.isActive,"onUpdate:modelValue":C[3]||(C[3]=S=>V.isActive=S)},null,8,["modelValue"])]),o("div",yi,[_(h(re),{type:"button",onClick:W,disabled:n.value||!U.value,variant:"secondary",text:"Reiniciar",icon:"reset"},{icon:ee(()=>[_(h(we),{class:"w-4 h-4 mr-2"})]),_:1},8,["disabled"]),_(h(pe),{text:"Actualizar Entidad",type:"submit",disabled:!h(m)||n.value||!U.value,loading:n.value},null,8,["disabled","loading"])]),s.visible?(q(),F("div",{key:0,ref_key:"notificationContainer",ref:l,class:"col-span-full"},[_(h(me),{visible:!0,type:s.type,title:s.title,message:s.message,inline:!0,"auto-close":!1,onClose:()=>{}},le({_:2},[s.type==="success"&&p.value?{name:"content",fn:ee(()=>[o("div",xi,[o("div",Ci,[o("div",wi,[o("h3",Ai,P(p.value.EntidadName),1),o("p",_i,[C[4]||(C[4]=o("span",{class:"font-medium"},"Código:",-1)),o("span",Vi,P(p.value.EntidadCode),1)])]),o("div",Ni,[o("div",null,[C[5]||(C[5]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Estado:",-1)),o("span",{class:se(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",p.value.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},P(p.value.isActive?"Activo":"Inactivo"),3)]),o("div",null,[C[6]||(C[6]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Última actualización:",-1)),o("p",ki,P(b(p.value.fecha_actualizacion)),1)])]),p.value.observaciones?(q(),F("div",$i,[C[7]||(C[7]=o("span",{class:"text-gray-500 font-medium block mb-2"},"Observaciones:",-1)),o("p",Si,P(p.value.observaciones),1)])):K("",!0)])])]),key:"0"}:void 0]),1032,["type","title","message"])],512)):K("",!0),_(h(ge),{visible:R.showValidationError&&R.hasAttemptedSubmit,errors:Q.value},null,8,["visible","errors"])],32))}});class Ri{constructor(){ie(this,"endpoint",te.ENDPOINTS.TESTS)}async getTestByCode(a){var e;try{const i=await Z.get(`${this.endpoint}/code/${a}`);return{id:i.id,pruebaCode:i.pruebaCode,pruebasName:i.pruebasName,pruebasDescription:i.pruebasDescription,tiempo:i.tiempo,isActive:i.isActive}}catch(i){throw((e=i.response)==null?void 0:e.status)===404?new Error("Prueba no encontrada"):new Error(i.message||"Error al obtener los datos de la prueba")}}async updateTest(a,e){var i,t,d,c;try{return await Z.put(`${this.endpoint}/code/${a}`,e)}catch(m){if(((i=m.response)==null?void 0:i.status)===400)throw new Error(m.message||"Ya existe una prueba con este código");if(((t=m.response)==null?void 0:t.status)===404)throw new Error("Prueba no encontrada");if(((d=m.response)==null?void 0:d.status)===422){const f=(c=m.response.data)==null?void 0:c.detail;if(Array.isArray(f)){const g=f.map(u=>{var y;return`${((y=u.loc)==null?void 0:y[u.loc.length-1])||"campo"}: ${u.msg}`}).join(", ");throw new Error(`Errores de validación: ${g}`)}throw new Error("Datos inválidos en el formulario")}else throw new Error(m.message||"Error al actualizar la prueba")}}async checkCodeExists(a,e){var i;try{return e&&a===e?!1:(await Z.get(`${this.endpoint}/code/${a}`),!0)}catch(t){return((i=t.response)==null?void 0:i.status)!==404}}validateTestData(a){var i,t,d;const e=[];return(i=a.pruebaCode)!=null&&i.trim()?a.pruebaCode.length<3?e.push("El código debe tener al menos 3 caracteres"):/^[A-Z0-9_-]+$/i.test(a.pruebaCode)||e.push("El código solo puede contener letras, números, guiones y guiones bajos"):e.push("El código de prueba es requerido"),(t=a.pruebasName)!=null&&t.trim()?a.pruebasName.length<3&&e.push("El nombre debe tener al menos 3 caracteres"):e.push("El nombre de la prueba es requerido"),(d=a.pruebasDescription)!=null&&d.trim()?a.pruebasDescription.length<10&&e.push("La descripción debe tener al menos 10 caracteres"):e.push("La descripción es requerida"),!a.tiempo||a.tiempo<=0?e.push("El tiempo estimado debe ser mayor a 0 días"):a.tiempo>365&&e.push("El tiempo estimado no puede ser mayor a 365 días"),{isValid:e.length===0,errors:e}}prepareUpdateData(a,e){const i={};return a.pruebaCode!==e.pruebaCode&&(i.pruebaCode=e.pruebaCode),a.pruebasName!==e.pruebasName&&(i.pruebasName=e.pruebasName),a.pruebasDescription!==e.pruebasDescription&&(i.pruebasDescription=e.pruebasDescription),a.tiempo!==e.tiempo&&(i.tiempo=e.tiempo),a.isActive!==e.isActive&&(i.isActive=e.isActive),i}}const $e=new Ri;function Pi(){const r=Y({isLoading:!1,isSuccess:!1,error:"",successMessage:""}),a=M(!1),e=M(!1),i=M(""),t=M(null),d=H(()=>!r.isLoading&&!a.value&&!e.value),c=n=>{var s,p,j;const l={};return(s=n.pruebaCode)!=null&&s.trim()?n.pruebaCode.length<3?l.pruebaCode="El código debe tener al menos 3 caracteres":/^[A-Z0-9_-]+$/i.test(n.pruebaCode)||(l.pruebaCode="Solo letras, números, guiones y guiones bajos"):l.pruebaCode="El código es requerido",(p=n.pruebasName)!=null&&p.trim()?n.pruebasName.length<3&&(l.pruebasName="El nombre debe tener al menos 3 caracteres"):l.pruebasName="El nombre es requerido",(j=n.pruebasDescription)!=null&&j.trim()?n.pruebasDescription.length<10&&(l.pruebasDescription="Mínimo 10 caracteres"):l.pruebasDescription="La descripción es requerida",!n.tiempo||n.tiempo<=0?l.tiempo="Ingresa un tiempo válido en días":n.tiempo>365&&(l.tiempo="Máximo 365 días"),{isValid:Object.keys(l).length===0,errors:l}},m=async n=>{e.value=!0,r.error="";try{const l=await $e.getTestByCode(n);return t.value={...l},{success:!0,data:l}}catch(l){return r.error=l.message||"Error al cargar los datos de la prueba",{success:!1}}finally{e.value=!1}},f=async(n,l)=>{if(!(n!=null&&n.trim())||n.length<3||l&&n.trim()===l)return!0;a.value=!0,i.value="";try{return await $e.checkCodeExists(n.trim(),l)?(i.value="Este código ya está en uso",!1):!0}catch{return i.value="Error al verificar el código",!1}finally{a.value=!1}},g=n=>t.value?t.value.pruebaCode!==n.pruebaCode||t.value.pruebasName!==n.pruebasName||t.value.pruebasDescription!==n.pruebasDescription||t.value.tiempo!==n.tiempo||t.value.isActive!==n.isActive:!1,u=async n=>{if(!t.value)return r.error="No se han cargado los datos originales de la prueba",{success:!1};r.error="",r.isSuccess=!1,r.successMessage="";const l=c(n);if(!l.isValid){const s=Object.values(l.errors).filter(Boolean);return r.error=s.join(", "),{success:!1}}if(n.pruebaCode!==t.value.pruebaCode&&!await f(n.pruebaCode,t.value.pruebaCode))return r.error=i.value||"Código no disponible",{success:!1};r.isLoading=!0;try{const s=$e.prepareUpdateData(t.value,n);if(Object.keys(s).length===0)return r.successMessage="No hay cambios para actualizar",{success:!0,data:n};const p=await $e.updateTest(t.value.pruebaCode,s);return t.value={id:p.id,pruebaCode:p.pruebaCode,pruebasName:p.pruebasName,pruebasDescription:p.pruebasDescription,tiempo:p.tiempo,isActive:p.isActive},r.isSuccess=!0,r.successMessage=`Prueba "${p.pruebasName}" actualizada exitosamente`,{success:!0,data:p}}catch(s){return r.error=s.message||"Error al actualizar la prueba",{success:!1}}finally{r.isLoading=!1}},w=n=>{t.value={...n}},y=()=>t.value?{...t.value}:null,N=()=>{r.isLoading=!1,r.isSuccess=!1,r.error="",r.successMessage="",a.value=!1,e.value=!1,i.value="",t.value=null},$=()=>{r.error="",r.successMessage="",r.isSuccess=!1,i.value=""};return{state:r,isCheckingCode:Se(a),isLoadingTest:Se(e),codeValidationError:Se(i),originalTestData:Se(t),canSubmit:d,validateForm:c,loadTestForEdition:m,checkCodeAvailability:f,updateTest:u,setInitialData:w,resetToOriginal:y,clearState:N,clearMessages:$,createHasChanges:g}}function Se(r){return H(()=>r.value)}const Mi={key:0,class:"col-span-full flex justify-center items-center py-8"},Li={class:"col-span-full md:col-span-6 flex items-center justify-center pt-6"},ji={class:"col-span-full flex flex-col sm:flex-row gap-2 sm:gap-3 sm:justify-end pt-4 border-t border-gray-200"},qi={class:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm"},zi={class:"space-y-4"},Ti={class:"mb-4 pb-3 border-b border-gray-100"},Ui={class:"text-xl font-bold text-gray-900 mb-2"},Oi={class:"text-gray-600"},Fi={class:"font-mono font-bold text-gray-800 ml-1"},Bi={class:"space-y-4 text-sm"},Di={class:"text-gray-800 font-semibold"},Yi={class:"text-gray-800 font-semibold"},Hi={key:0},Gi={class:"text-gray-800 bg-gray-50 p-3 rounded-lg"},Zi={key:2,class:"col-span-full"},Ji={key:3,class:"col-span-full"},Ki=ae({__name:"FormEdicionPruebas",props:{usuario:{},usuarioActualizado:{type:Boolean},mensajeExito:{}},emits:["usuario-actualizado","cancelar"],setup(r,{emit:a}){const e=r,i=a,t=M(null),d=M(null),c=Y({visible:!1,type:"success",title:"",message:""}),m=Y({showValidationError:!1,hasAttemptedSubmit:!1}),{state:f,isLoadingTest:g,codeValidationError:u,originalTestData:w,canSubmit:y,validateForm:N,checkCodeAvailability:$,updateTest:n,setInitialData:l,resetToOriginal:s,clearState:p,clearMessages:j,createHasChanges:A}=Pi(),b=H(()=>f.isLoading),V=H(()=>A(v)),v=Y({id:"",pruebaCode:"",pruebasName:"",pruebasDescription:"",tiempo:1,isActive:!0}),R=Y({pruebaCode:"",pruebasName:"",pruebasDescription:"",tiempo:""}),Q=H(()=>{if(!m.hasAttemptedSubmit)return[];const k=[];return(!v.pruebaCode||R.pruebaCode)&&k.push("Código de prueba válido requerido"),(!v.pruebasName||R.pruebasName)&&k.push("Nombre de la prueba requerido"),(!v.pruebasDescription||R.pruebasDescription)&&k.push("Descripción requerida"),(!v.tiempo||v.tiempo<=0)&&k.push("Tiempo estimado válido requerido"),k});Je(()=>{e.usuario&&U()});const U=()=>{try{if(e.usuario){if(!e.usuario.id&&!e.usuario.codigo&&!e.usuario.pruebaCode)throw new Error("ID o código de la prueba es requerido");const k={id:e.usuario.id||e.usuario.codigo||e.usuario.pruebaCode,pruebaCode:e.usuario.pruebaCode||e.usuario.codigo||"",pruebasName:e.usuario.pruebasName||e.usuario.nombre||"",pruebasDescription:e.usuario.pruebasDescription||e.usuario.descripcion||"",tiempo:e.usuario.tiempo||1,isActive:e.usuario.isActive??e.usuario.activo??!0};if(!k.pruebaCode||!k.pruebasName)throw new Error("Código y nombre de la prueba son requeridos");Object.assign(v,k),l(k)}else throw new Error("No se recibieron datos de la prueba")}catch(k){J("error","Error al cargar datos",k.message||"No se pudieron cargar los datos de la prueba")}};X(()=>v,()=>{m.hasAttemptedSubmit&&!c.visible&&(j(),B())},{deep:!0});const T=async()=>{var E,x;if(R.pruebaCode="",!((E=v.pruebaCode)!=null&&E.trim())){R.pruebaCode="El código es requerido";return}if(v.pruebaCode.length<3){R.pruebaCode="Mínimo 3 caracteres";return}if(!/^[A-Z0-9_-]+$/i.test(v.pruebaCode)){R.pruebaCode="Solo letras, números, guiones y guiones bajos";return}const k=(x=w.value)==null?void 0:x.pruebaCode;await $(v.pruebaCode,k),u.value&&(R.pruebaCode=u.value)},B=()=>{Object.keys(R).forEach(k=>{R[k]=""})},J=(k,E,x)=>{c.type=k,c.title=E,c.message=x,c.visible=!0},W=()=>{c.visible=!1,c.title="",c.message="",d.value=null},D=k=>{try{return new Date(k).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha no disponible"}},C=async()=>{await de(),t.value&&t.value.scrollIntoView({behavior:"smooth",block:"center"})},S=async()=>{m.hasAttemptedSubmit=!0,B(),W();const k=N(v);if(!k.isValid){Object.assign(R,k.errors),m.showValidationError=!0;return}m.showValidationError=!1;try{const E=await n(v);if(E.success&&E.data)await O(E.data);else throw new Error("Error desconocido al actualizar la prueba")}catch(E){await L(E)}},O=async k=>{d.value=k,J("success","¡Prueba Actualizada Exitosamente!",""),i("usuario-actualizado",{...k,nombre:k.pruebasName,codigo:k.pruebaCode,tipo:"pruebas"}),await C()},L=async k=>{console.error("Error al actualizar prueba:",k);const E=k.message||"No se pudo actualizar la prueba. Por favor, inténtelo nuevamente.";J("error","Error al Actualizar Prueba",E),await C()},I=()=>{const k=s();k&&(Object.assign(v,k),B(),W(),m.hasAttemptedSubmit=!1,m.showValidationError=!1)};return X(()=>c.visible,k=>{k&&C()}),X(()=>e.usuario,k=>{k&&k.id!==v.id&&(p(),U())},{deep:!0}),X(()=>e.usuarioActualizado,k=>{k&&e.mensajeExito&&J("success","¡Actualización Exitosa!",e.mensajeExito)}),(k,E)=>(q(),F("form",{onSubmit:ne(S,["prevent"]),class:"grid grid-cols-1 md:grid-cols-12 gap-3 md:gap-4"},[E[13]||(E[13]=o("div",{class:"col-span-full"},[o("h4",{class:"text-base font-semibold text-gray-800"},"Editar Prueba"),o("p",{class:"text-sm text-gray-600 mt-1"},"Modifica los datos de la prueba médica")],-1)),h(g)?(q(),F("div",Mi,[...E[5]||(E[5]=[o("div",{class:"flex items-center space-x-2"},[o("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),o("span",{class:"text-gray-600"},"Cargando datos de la prueba...")],-1)])])):v.pruebaCode?(q(),F(Re,{key:1},[_(h(G),{class:"col-span-full md:col-span-6",label:"Código de prueba",placeholder:"Ejemplo: BIO-01",modelValue:v.pruebaCode,"onUpdate:modelValue":E[0]||(E[0]=x=>v.pruebaCode=x),error:R.pruebaCode,onBlur:T,disabled:!0},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Nombre de la prueba",placeholder:"Ejemplo: Biopsia",modelValue:v.pruebasName,"onUpdate:modelValue":E[1]||(E[1]=x=>v.pruebasName=x),error:R.pruebasName},null,8,["modelValue","error"]),_(h(ue),{class:"col-span-full",label:"Descripción",placeholder:"Descripción detallada de la prueba",modelValue:v.pruebasDescription,"onUpdate:modelValue":E[2]||(E[2]=x=>v.pruebasDescription=x),rows:3,error:R.pruebasDescription},null,8,["modelValue","error"]),_(h(G),{class:"col-span-full md:col-span-6",label:"Tiempo estimado (días)",type:"number",placeholder:"Ej. 7",modelValue:v.tiempo,"onUpdate:modelValue":E[3]||(E[3]=x=>v.tiempo=x),modelModifiers:{number:!0},error:R.tiempo,min:"1",max:"365"},null,8,["modelValue","error"]),o("div",Li,[_(h(ce),{label:"Activo",modelValue:v.isActive,"onUpdate:modelValue":E[4]||(E[4]=x=>v.isActive=x)},null,8,["modelValue"])]),o("div",ji,[_(h(re),{type:"button",onClick:I,disabled:b.value||!V.value,variant:"secondary",text:"Reiniciar",icon:"reset"},{icon:ee(()=>[_(h(we),{class:"w-4 h-4 mr-2"})]),_:1},8,["disabled"]),_(h(pe),{text:"Actualizar Prueba",type:"submit",disabled:!h(y)||b.value||!V.value,loading:b.value},null,8,["disabled","loading"])]),o("div",{ref_key:"notificationContainer",ref:t,class:"col-span-full"},[_(h(me),{visible:c.visible,type:c.type,title:c.title,message:c.message,inline:!0,"auto-close":!1,onClose:()=>{}},le({_:2},[c.type==="success"&&d.value?{name:"content",fn:ee(()=>[o("div",qi,[o("div",zi,[o("div",Ti,[o("h3",Ui,P(d.value.pruebasName),1),o("p",Oi,[E[6]||(E[6]=o("span",{class:"font-medium"},"Código:",-1)),o("span",Fi,P(d.value.pruebaCode),1)])]),o("div",Bi,[o("div",null,[E[7]||(E[7]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Tiempo estimado:",-1)),o("p",Di,P(d.value.tiempo)+" día"+P(d.value.tiempo!==1?"s":""),1)]),o("div",null,[E[8]||(E[8]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Estado:",-1)),o("span",{class:se(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",d.value.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},P(d.value.isActive?"Activo":"Inactivo"),3)]),o("div",null,[E[9]||(E[9]=o("span",{class:"text-gray-500 font-medium block mb-1"},"Última actualización:",-1)),o("p",Yi,P(D(d.value.fecha_actualizacion)),1)])]),d.value.pruebasDescription?(q(),F("div",Hi,[E[10]||(E[10]=o("span",{class:"text-gray-500 font-medium block mb-2"},"Descripción:",-1)),o("p",Gi,P(d.value.pruebasDescription),1)])):K("",!0)])])]),key:"0"}:void 0]),1032,["visible","type","title","message"])],512),_(h(ge),{visible:m.showValidationError&&m.hasAttemptedSubmit,errors:Q.value},null,8,["visible","errors"])],64)):!h(g)&&e.usuario&&!v.pruebaCode?(q(),F("div",Zi,[...E[11]||(E[11]=[je('<div class="text-center py-8"><div class="text-red-600 mb-2"><svg class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.694-.833-2.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg></div><h3 class="text-lg font-medium text-gray-900 mb-1">Error al cargar la prueba</h3><p class="text-gray-600">No se pudieron cargar los datos de la prueba para edición.</p><p class="text-sm text-gray-500 mt-2">Falta el código de la prueba.</p></div>',1)])])):e.usuario?K("",!0):(q(),F("div",Ji,[...E[12]||(E[12]=[je('<div class="text-center py-8"><div class="text-gray-400 mb-2"><svg class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><h3 class="text-lg font-medium text-gray-900 mb-1">Selecciona una prueba</h3><p class="text-gray-600">Busca y selecciona una prueba de la lista para editarla.</p></div>',1)])]))],32))}});class Xi{constructor(){ie(this,"endpoint",te.ENDPOINTS.TESTS)}async searchTests(a,e=!1){var i;try{if(!(a!=null&&a.trim()))return[];const t=await Z.get(`${this.endpoint}/`,{params:{query:a.trim(),activo:e?void 0:!0,limit:50}});return t.pruebas&&Array.isArray(t.pruebas)?t.pruebas.map(d=>({id:d.id||d._id,nombre:d.pruebasName,codigo:d.pruebaCode,descripcion:d.pruebasDescription,tiempo:d.tiempo,activo:d.isActive,tipo:"pruebas",fecha_creacion:d.fecha_creacion,fecha_actualizacion:d.fecha_actualizacion})):[]}catch(t){if(console.error("Error al buscar pruebas:",t),((i=t.response)==null?void 0:i.status)===404)return[];throw new Error(t.message||"Error al buscar pruebas")}}async getTestByCode(a){var e;try{const i=await Z.get(`${this.endpoint}/code/${a}`);return i?{id:i.id,nombre:i.pruebasName,codigo:i.pruebaCode,descripcion:i.pruebasDescription,tiempo:i.tiempo,activo:i.isActive,tipo:"pruebas",fecha_creacion:i.fecha_creacion,fecha_actualizacion:i.fecha_actualizacion}:null}catch(i){if(console.error("Error al obtener prueba por código:",i),((e=i.response)==null?void 0:e.status)===404)return null;throw new Error(i.message||"Error al obtener la prueba")}}}const Qi=new Xi;class Wi{constructor(){ie(this,"endpoint",te.ENDPOINTS.ENTITIES)}async searchEntities(a,e=!1){if(!(a!=null&&a.trim()))return[];const i=await Z.get(`${this.endpoint}/`,{params:{query:a.trim(),activo:e?void 0:!0,limit:50}});return i.entidades&&Array.isArray(i.entidades)?i.entidades.map(t=>({id:t.id||t._id,nombre:t.EntidadName,codigo:t.EntidadCode,tipo:"entidad",activo:t.isActive,observaciones:t.observaciones,fecha_creacion:t.fecha_creacion,fecha_actualizacion:t.fecha_actualizacion,EntidadName:t.EntidadName,EntidadCode:t.EntidadCode,isActive:t.isActive})):[]}async searchResidents(a,e=!1){if(!(a!=null&&a.trim()))return[];const i=await Z.get("/residentes/search",{params:{residenteName:a.trim(),isActive:e?void 0:!0,limit:50}});return i&&i.residentes&&Array.isArray(i.residentes)?i.residentes.map(t=>({id:t.id||t._id,nombre:t.residenteName,codigo:t.residenteCode,tipo:"residente",activo:t.isActive,email:t.ResidenteEmail,documento:t.residenteCode,fecha_creacion:t.fecha_creacion,fecha_actualizacion:t.fecha_actualizacion,residenteName:t.residenteName,residenteCode:t.residenteCode,InicialesResidente:t.InicialesResidente||"",ResidenteEmail:t.ResidenteEmail,registro_medico:t.registro_medico,observaciones:t.observaciones||"",isActive:t.isActive})):[]}async searchPathologists(a,e=!1){if(!(a!=null&&a.trim()))return[];const i=await Z.get("/patologos/search",{params:{q:a.trim(),isActive:e?void 0:!0,limit:50}});return Array.isArray(i)?i.map(t=>({id:t.id||t._id,nombre:t.patologoName,tipo:"patologo",codigo:t.patologoCode,email:t.PatologoEmail,activo:t.isActive,patologoName:t.patologoName,InicialesPatologo:t.InicialesPatologo||"",patologoCode:t.patologoCode,PatologoEmail:t.PatologoEmail,registro_medico:t.registro_medico,firma:t.firma||"",observaciones:t.observaciones||"",isActive:t.isActive,fecha_creacion:t.fecha_creacion,fecha_actualizacion:t.fecha_actualizacion})):[]}async searchAuxiliaries(a,e=!1){if(!(a!=null&&a.trim()))return[];const i=a.trim(),t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,d=/^[A-Za-z0-9_-]{2,20}$/,c={};t.test(i)?c.AuxiliarEmail=i:d.test(i)?c.auxiliarCode=i:c.auxiliarName=i,e||(c.isActive=!0);const m=await Z.get("/auxiliares/search",{params:c});return m&&m.auxiliares&&Array.isArray(m.auxiliares)?m.auxiliares.map(f=>({id:f.id||f._id,nombre:f.auxiliarName,codigo:f.auxiliarCode,tipo:"auxiliar",activo:f.isActive,email:f.AuxiliarEmail,fecha_creacion:f.fecha_creacion,fecha_actualizacion:f.fecha_actualizacion,auxiliarName:f.auxiliarName,auxiliarCode:f.auxiliarCode,AuxiliarEmail:f.AuxiliarEmail,observaciones:f.observaciones||"",isActive:f.isActive})):[]}}const Ie=new Wi,et={class:"border-b border-gray-200 mb-1"},st={class:"-mb-px flex flex-wrap gap-1 md:gap-4","aria-label":"Tabs"},at=["onClick"],ot={class:"space-y-3 md:space-y-4"},it={key:0},tt={class:"text-base font-semibold text-gray-800 dark:text-white/90 mb-4"},rt={key:1,class:"mt-6 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg"},lt={class:"text-sm font-medium text-green-800 dark:text-green-200"},nt=ae({__name:"UserEditionTabs",setup(r){const a=[{value:"auxiliar",label:"Auxiliar administrativo"},{value:"patologo",label:"Patólogo"},{value:"residente",label:"Residente"},{value:"entidad",label:"Entidad"},{value:"pruebas",label:"Pruebas"}],e=M("auxiliar"),i=M(""),t=M(!1),d=M(!1),c=M(""),m=M([]),f=M(null),g=M(!1),u=M(""),w=H(()=>m.value.filter(s=>s.tipo===e.value)),y=s=>{e.value=s,f.value=null},N=async s=>{i.value=s.query,t.value=!0,d.value=!0,c.value="";try{let p=[];if(s.tipo==="pruebas"?p=await Qi.searchTests(s.query,s.includeInactive):s.tipo==="entidad"?p=await Ie.searchEntities(s.query,s.includeInactive):s.tipo==="residente"?p=await Ie.searchResidents(s.query,s.includeInactive):s.tipo==="patologo"?p=await Ie.searchPathologists(s.query,s.includeInactive):s.tipo==="auxiliar"?p=await Ie.searchAuxiliaries(s.query,s.includeInactive):p=[],m.value=p,p.length===0){const A={auxiliar:"auxiliares",patologo:"patólogos",residente:"residentes",entidad:"entidades",pruebas:"pruebas"}[s.tipo]||"registros",b=s.includeInactive?" (incluyendo inactivos)":"";c.value=`No se encontraron ${A} que coincidan con "${s.query}"${b}`}}catch(p){console.error("Error en búsqueda:",p),c.value=p.message||"Error al realizar la búsqueda. Por favor, inténtelo nuevamente.",m.value=[]}finally{d.value=!1}},$=()=>{i.value="",m.value=[],f.value=null,c.value="",t.value=!1,d.value=!1},n=s=>{s.tipo==="pruebas"?f.value={id:s.id,nombre:s.nombre,tipo:s.tipo,codigo:s.codigo,activo:s.activo,pruebaCode:s.codigo,pruebasName:s.nombre,pruebasDescription:s.descripcion||"",tiempo:s.tiempo||1,isActive:s.activo,fecha_creacion:s.fecha_creacion,fecha_actualizacion:s.fecha_actualizacion}:s.tipo==="entidad"?f.value={id:s.id,nombre:s.nombre,tipo:s.tipo,codigo:s.codigo,activo:s.activo,EntidadName:s.nombre,EntidadCode:s.codigo,observaciones:s.observaciones||"",isActive:s.activo,fecha_creacion:s.fecha_creacion,fecha_actualizacion:s.fecha_actualizacion}:s.tipo==="residente"?f.value={id:s.id,nombre:s.nombre,tipo:s.tipo,codigo:s.codigo,activo:s.activo,email:s.email,residenteName:s.residenteName||s.nombre,residenteCode:s.residenteCode||s.codigo,InicialesResidente:s.InicialesResidente||"",ResidenteEmail:s.ResidenteEmail||s.email,registro_medico:s.registro_medico||"",observaciones:s.observaciones||"",isActive:s.isActive!==void 0?s.isActive:s.activo,fecha_creacion:s.fecha_creacion,fecha_actualizacion:s.fecha_actualizacion}:s.tipo==="patologo"?f.value={id:s.id,nombre:s.nombre,tipo:s.tipo,codigo:s.codigo,activo:s.activo,email:s.email,patologoName:s.patologoName||s.nombre,InicialesPatologo:s.InicialesPatologo||"",patologoCode:s.patologoCode||s.codigo,PatologoEmail:s.PatologoEmail||s.email,registro_medico:s.registro_medico||"",observaciones:s.observaciones||"",isActive:s.isActive!==void 0?s.isActive:s.activo,fecha_creacion:s.fecha_creacion,fecha_actualizacion:s.fecha_actualizacion}:s.tipo==="auxiliar"?f.value={id:s.id,nombre:s.nombre,tipo:s.tipo,codigo:s.codigo,activo:s.activo,email:s.email,auxiliarName:s.auxiliarName||s.nombre,auxiliarCode:s.auxiliarCode||s.codigo,AuxiliarEmail:s.AuxiliarEmail||s.email,observaciones:s.observaciones||"",isActive:s.isActive!==void 0?s.isActive:s.activo,fecha_creacion:s.fecha_creacion,fecha_actualizacion:s.fecha_actualizacion}:f.value={id:s.id,nombre:s.nombre,tipo:s.tipo,documento:s.documento,nit:s.nit,codigo:s.codigo,email:s.email||"",activo:s.activo,role:s.tipo,firstName:s.nombre,lastName:"",phone:"",startDate:"",isActive:s.activo,specialty:s.descripcion||"",medicalLicense:s.licencia||"",residencyYear:s.residencyYear||"",entityName:s.tipo==="entidad"?s.nombre:"",entityType:s.categoria||"",address:"",pruebaCode:s.codigo||"",pruebasName:s.nombre,pruebasCategory:s.categoria||"",pruebasDescription:s.descripcion||"",observaciones:s.observaciones||"",firmaPatologoUrl:""}},l=s=>{var j;const p=(j=f.value)==null?void 0:j.tipo;p==="pruebas"||p==="entidad"||p==="residente"||p==="auxiliar"||(u.value="Registro actualizado exitosamente",g.value=!0,setTimeout(()=>{f.value=null},700),setTimeout(()=>{g.value=!1,u.value=""},3e3))};return(s,p)=>(q(),oe(h(De),{title:"Edición de usuarios",description:"Selecciona una pestaña, busca y edita el perfil.",dense:!0},{icon:ee(()=>[...p[0]||(p[0]=[o("svg",{class:"w-5 h-5 mr-2 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 20h9"}),o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16.5 3.5a2.121 2.121 0 113 3L7 19l-4 1 1-4L16.5 3.5z"})],-1)])]),default:ee(()=>{var j;return[o("div",et,[o("nav",st,[(q(),F(Re,null,Me(a,A=>o("button",{key:A.value,type:"button",class:se(["whitespace-nowrap py-1 px-1 md:px-1 border-b-2 font-medium text-xs md:text-sm",e.value===A.value?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"]),onClick:b=>y(A.value)},P(A.label),11,at)),64))])]),o("div",ot,[o("div",null,[_(Za,{busqueda:i.value,"tipo-busqueda":e.value,"esta-buscando":d.value,error:c.value,onBuscar:N,onLimpiar:$},null,8,["busqueda","tipo-busqueda","esta-buscando","error"])]),o("div",null,[_(go,{resultados:w.value,"busqueda-realizada":t.value,"esta-buscando":d.value,"selected-id":((j=f.value)==null?void 0:j.id)||"",onUsuarioSeleccionado:n},null,8,["resultados","busqueda-realizada","esta-buscando","selected-id"])]),o("div",null,[f.value?(q(),F("div",it,[o("h5",tt," Editando: "+P(f.value.nombre),1),f.value.tipo==="auxiliar"?(q(),oe(Ro,{key:0,usuario:f.value,"usuario-actualizado":g.value,"mensaje-exito":u.value,onUsuarioActualizado:l},null,8,["usuario","usuario-actualizado","mensaje-exito"])):f.value.tipo==="patologo"?(q(),oe(Xo,{key:1,usuario:f.value,"usuario-actualizado":g.value,"mensaje-exito":u.value,onUsuarioActualizado:l},null,8,["usuario","usuario-actualizado","mensaje-exito"])):f.value.tipo==="residente"?(q(),oe(bi,{key:2,usuario:f.value,"usuario-actualizado":g.value,"mensaje-exito":u.value,onUsuarioActualizado:l},null,8,["usuario","usuario-actualizado","mensaje-exito"])):f.value.tipo==="entidad"?(q(),oe(Ii,{key:3,usuario:f.value,"usuario-actualizado":g.value,"mensaje-exito":u.value,onUsuarioActualizado:l},null,8,["usuario","usuario-actualizado","mensaje-exito"])):f.value.tipo==="pruebas"?(q(),oe(Ki,{key:4,usuario:f.value,"usuario-actualizado":g.value,"mensaje-exito":u.value,onUsuarioActualizado:l},null,8,["usuario","usuario-actualizado","mensaje-exito"])):K("",!0)])):K("",!0),g.value&&!f.value?(q(),F("div",rt,[o("p",lt,P(u.value),1)])):K("",!0)])])]}),_:1}))}}),dt={class:"p-3 sm:p-4 md:p-6"},ct={class:"grid grid-cols-1 gap-4 md:gap-6 xl:grid-cols-2"},ut={class:"space-y-4"},wt=ae({__name:"ManageUsersView",setup(r){const a=M("Gestión de Usuarios"),e=t=>{},i=t=>{console.log("Usuario creado:",t)};return(t,d)=>(q(),oe(h(Ge),null,{default:ee(()=>[_(h(Ke),{pageTitle:a.value},null,8,["pageTitle"]),o("div",dt,[o("div",ct,[o("div",ut,[_(Ba,{onUsuarioCreado:i,onFotoSeleccionada:e})]),o("div",null,[_(nt)])])])]),_:1}))}});export{wt as default};
