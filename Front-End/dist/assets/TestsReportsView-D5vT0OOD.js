import{g as ae,d as ne,A as N,u as le,b as ie}from"./PathologistList.vue_vue_type_style_index_0_scoped_45f5ffeb_lang-FwbajLSj.js";import{d as S,c as h,b as f,e as x,h as e,g as C,n as G,t as c,j as A,u as y,w as $,f as b,D as de,F as L,l as J,r as v,k as W,T as ce,q as ue,i as O,v as me,o as pe,J as xe}from"./index-CAHFE_9E.js";import{C as D,_ as fe}from"./DiseaseList.vue_vue_type_style_index_0_scoped_2e8ef3ac_lang-CSxq79ax.js";/* empty css                                                                   */import{_ as ve}from"./AccessDeniedAlert.vue_vue_type_script_setup_true_lang-DQszwtgF.js";import{F as H}from"./FormSelect-Dz8sviG5.js";import{a as ge,_ as be}from"./ClearButton.vue_vue_type_script_setup_true_lang-iqMnWNPk.js";import{E as he}from"./EntityList-gIDUOf46.js";import{R as ye}from"./RefreshIcon-CgqLp7N5.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const we={class:"flex items-center space-x-2"},ke={class:"flex items-center"},$e=S({__name:"BackendStatus",props:{isConnected:{type:Boolean},isLoading:{type:Boolean,default:!1}},emits:["reconnect"],setup(_,{emit:n}){const r=_,m=h(()=>r.isLoading?"bg-yellow-400 animate-pulse":r.isConnected?"bg-green-400":"bg-red-400"),i=h(()=>r.isLoading?"text-yellow-700":r.isConnected?"text-green-700":"text-red-700"),l=h(()=>r.isLoading?"Conectando...":r.isConnected?"Conectado":"Desconectado");return(s,t)=>(x(),f("div",we,[e("div",ke,[e("div",{class:G(["w-2 h-2 rounded-full mr-2",m.value])},null,2),e("span",{class:G(["text-sm font-medium",i.value])},c(l.value),3)]),s.isConnected?C("",!0):(x(),f("button",{key:0,onClick:t[0]||(t[0]=a=>s.$emit("reconnect")),class:"px-2 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors"}," Reintentar "))]))}}),Ce={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Se={class:"bg-blue-50 border border-blue-200 rounded-xl p-4"},Me={class:"flex items-center justify-between"},Ee={class:"text-2xl font-bold text-blue-700"},Te={class:"bg-green-50 border border-green-200 rounded-xl p-4"},je={class:"flex items-center justify-between"},Pe={class:"text-2xl font-bold text-green-700"},Ne={class:"text-xs text-green-600"},Ae={class:"bg-yellow-50 border border-yellow-200 rounded-xl p-4"},De={class:"flex items-center justify-between"},ze={class:"text-2xl font-bold text-yellow-700"},Be=S({__name:"TestsSummary",props:{datos:{},resumen:{}},setup(_){const n=_,r=h(()=>{var s;return(s=n.resumen)!=null&&s.totalSolicitadas?n.resumen.totalSolicitadas:n.datos.reduce((t,a)=>t+a.solicitadas,0)}),m=h(()=>{var s;return(s=n.resumen)!=null&&s.totalCompletadas?n.resumen.totalCompletadas:n.datos.reduce((t,a)=>t+a.completadas,0)}),i=h(()=>r.value===0?0:Math.round(m.value/r.value*100)),l=h(()=>{var t;const s=((t=n.resumen)==null?void 0:t.tiempoPromedio)||0;return s===0?"0.0 días":`${s.toFixed(1)} días`});return(s,t)=>(x(),f("div",Ce,[e("div",Se,[e("div",Me,[e("div",null,[t[0]||(t[0]=e("p",{class:"text-sm text-blue-600 font-medium"},"Total de pruebas realizadas",-1)),e("p",Ee,c(r.value.toLocaleString()),1),t[1]||(t[1]=e("p",{class:"text-xs text-blue-600"},"en el período",-1))]),t[2]||(t[2]=e("div",{class:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})])],-1))])]),e("div",Te,[e("div",je,[e("div",null,[t[3]||(t[3]=e("p",{class:"text-sm text-green-600 font-medium"},"Completadas",-1)),e("p",Pe,c(m.value.toLocaleString()),1),e("p",Ne,c(i.value)+"% del total",1)]),t[4]||(t[4]=e("div",{class:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",Ae,[e("div",De,[e("div",null,[t[5]||(t[5]=e("p",{class:"text-sm text-yellow-600 font-medium"},"Tiempo Promedio",-1)),e("p",ze,c(l.value),1),t[6]||(t[6]=e("p",{class:"text-xs text-yellow-600"},"por prueba",-1))]),t[7]||(t[7]=e("div",{class:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])])]))}}),Ie=S({__name:"TestsPerformanceChart",props:{datos:{}},setup(_){const n=_,r=h(()=>[{name:"Solicitadas",data:n.datos.map(i=>i.solicitadas)},{name:"Completadas",data:n.datos.map(i=>i.completadas)}]),m=h(()=>({chart:{type:"bar",stacked:!0,toolbar:{show:!0,tools:{download:!1,selection:!1,zoom:!1,zoomin:!1,zoomout:!1,pan:!1,reset:!1}},fontFamily:"Inter, sans-serif",background:"#F9FAFB"},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4,dataLabels:{position:"top"}}},dataLabels:{enabled:!0,formatter:function(i,l){const s=l.dataPointIndex;if(l.seriesIndex===1){const t=r.value[0].data[s],a=r.value[1].data[s],p=t+a;return p>0?`${p}`:""}return""},style:{fontSize:"11px",fontWeight:"bold",colors:["#374151"]},offsetY:-18},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{categories:n.datos.map(i=>i.codigo),labels:{style:{fontSize:"12px",fontFamily:"Inter, sans-serif"}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{title:{text:"Pruebas",style:{fontSize:"12px",fontFamily:"Inter, sans-serif"}},labels:{style:{fontSize:"12px",fontFamily:"Inter, sans-serif"}}},fill:{opacity:1},tooltip:{y:{formatter:i=>`${i} pruebas`},theme:"light",style:{fontSize:"12px",fontFamily:"Inter, sans-serif"}},legend:{position:"top",horizontalAlign:"right",fontSize:"12px",fontFamily:"Inter, sans-serif",markers:{width:12,height:12,radius:12}},colors:["#3b82f6","#22c55e"],grid:{borderColor:"#E5E7EB",strokeDashArray:4,xaxis:{lines:{show:!1}}}}));return m.value.responsive=[{breakpoint:1280,options:{plotOptions:{bar:{columnWidth:"60%"}},legend:{position:"top"}}},{breakpoint:1024,options:{plotOptions:{bar:{columnWidth:"70%"}},legend:{position:"bottom"}}},{breakpoint:640,options:{plotOptions:{bar:{columnWidth:"80%"}},xaxis:{labels:{rotate:-45}},legend:{position:"bottom"}}}],(i,l)=>{const s=de("apexchart");return x(),A(y(D),{title:"Distribución de Pruebas por Entidad",description:"Gráfico de barras apiladas mostrando solicitadas y completadas por prueba."},{default:$(()=>[b(s,{type:"bar",height:"320",options:m.value,series:r.value},null,8,["options","series"])]),_:1})}}}),Fe={class:"overflow-x-auto -mx-4 sm:mx-0"},Re={class:"min-w-full divide-y divide-gray-200"},Le={class:"bg-white divide-y divide-gray-200"},Oe=["onClick"],Ve={class:"px-6 py-4 whitespace-nowrap"},Ye={class:"flex items-center"},qe={class:"text-sm font-medium text-gray-900"},Ue={class:"text-sm text-gray-500"},Ge={class:"px-6 py-4 whitespace-nowrap text-center"},He={class:"text-sm font-semibold text-blue-600"},Je={class:"px-6 py-4 whitespace-nowrap text-center"},We={class:"text-sm font-semibold text-green-600"},Ke={class:"px-6 py-4 whitespace-nowrap text-center"},Qe={class:"text-sm font-semibold text-yellow-600"},Xe={class:"bg-gray-50"},Ze={class:"px-6 py-4 text-center text-sm font-bold text-blue-600"},et={class:"px-6 py-4 text-center text-sm font-bold text-green-600"},tt={class:"px-6 py-4 text-center text-sm font-bold text-yellow-600"},st=S({__name:"TestsDetailTable",props:{datos:{}},emits:["test-click"],setup(_,{emit:n}){const r=_,m=h(()=>r.datos.reduce((s,t)=>s+t.solicitadas,0)),i=h(()=>r.datos.reduce((s,t)=>s+t.completadas,0)),l=h(()=>r.datos.length===0?0:r.datos.reduce((t,a)=>t+a.tiempoPromedio,0)/r.datos.length);return(s,t)=>(x(),f("div",Fe,[e("table",Re,[t[2]||(t[2]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Prueba "),e("th",{class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Solicitadas "),e("th",{class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Completadas "),e("th",{class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tiempo Prom. ")])],-1)),e("tbody",Le,[(x(!0),f(L,null,J(s.datos,a=>(x(),f("tr",{key:a.codigo,class:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:p=>s.$emit("test-click",a),title:"Clic para ver detalles"},[e("td",Ve,[e("div",Ye,[e("div",null,[e("div",qe,c(a.nombre),1),e("div",Ue,c(a.codigo),1)]),t[0]||(t[0]=e("svg",{class:"w-4 h-4 ml-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])]),e("td",Ge,[e("span",He,c(a.solicitadas.toLocaleString()),1)]),e("td",Je,[e("span",We,c(a.completadas.toLocaleString()),1)]),e("td",Ke,[e("span",Qe,c(a.tiempoPromedio.toFixed(1))+" días",1)])],8,Oe))),128))]),e("tfoot",Xe,[e("tr",null,[t[1]||(t[1]=e("td",{class:"px-6 py-4 text-sm font-bold text-gray-900"},"Total",-1)),e("td",Ze,c(m.value.toLocaleString()),1),e("td",et,c(i.value.toLocaleString()),1),e("td",tt,c(l.value.toFixed(1))+" días",1)])])])]))}});class ot{async makeRequest(n,r={}){const m=ne(n),i={headers:ae(),...r};try{const l=await fetch(m,i);if(!l.ok){const s=await l.json().catch(()=>({}));throw new Error(s.detail||`HTTP error! status: ${l.status}`)}return await l.json()}catch(l){throw console.error(`Error en API request a ${n}:`,l),l}}async getMonthlyTests(n,r,m){try{const i=m&&m!==""&&m!=="general"?`&entity=${encodeURIComponent(m)}`:"",l=`${N.ENDPOINTS.CASOS.ESTADISTICAS_PRUEBAS}?month=${n}&year=${r}${i}`,s=await this.makeRequest(l);if(s.success&&s.data)return{tests:s.data.pruebas.map(a=>({codigo:a.codigo||"",nombre:a.nombre||"",solicitadas:a.total_solicitadas||0,completadas:a.total_completadas||0,tiempoPromedio:a.tiempo_promedio||0})),summary:s.data.resumen||{totalSolicitadas:0,totalCompletadas:0,tiempoPromedio:0}};throw new Error(s.message||"Error al obtener datos del servidor")}catch(i){throw console.error("Error al obtener estadísticas mensuales:",i),i}}async getTestDetails(n,r,m,i){try{const l=n&&n!==""&&n!=="general"?`&entity=${encodeURIComponent(n)}`:"",s=`${N.ENDPOINTS.CASOS.DETALLE_PRUEBA}/${r}?month=${m}&year=${i}${l}`,t=await this.makeRequest(s);if(t.success&&t.data)return{estadisticas_principales:{total_solicitadas:t.data.estadisticas_principales.total_solicitadas||0,total_completadas:t.data.estadisticas_principales.total_completadas||0,porcentaje_completado:t.data.estadisticas_principales.porcentaje_completado||0},tiempos_procesamiento:{promedio_dias:t.data.tiempos_procesamiento.promedio_dias||0,dentro_oportunidad:t.data.tiempos_procesamiento.dentro_oportunidad||0,fuera_oportunidad:t.data.tiempos_procesamiento.fuera_oportunidad||0,total_casos:t.data.tiempos_procesamiento.total_casos||0},patologos:t.data.patologos.map(a=>({nombre:a.nombre||"",codigo:a.codigo||"",total_procesadas:a.total_procesadas||0,tiempo_promedio:a.tiempo_promedio||0}))||[]};throw new Error(t.message||"Error al obtener detalles de la prueba")}catch(l){throw console.error("Error al obtener detalles de la prueba:",l),l}}async getPathologists(n,r,m,i){try{const l=`${N.ENDPOINTS.CASOS.PATOLOGOS_POR_PRUEBA}/${r}?month=${m}&year=${i}${n?`&entity=${encodeURIComponent(n)}`:""}`,s=await this.makeRequest(l);if(s.success&&s.data)return s.data.map(t=>({nombre:t.nombre||"",codigo:t.codigo||"",total_procesadas:t.total_procesadas||0,tiempo_promedio:t.tiempo_promedio||0}));throw new Error(s.message||"Error al obtener patólogos")}catch(l){throw console.error("Error al obtener patólogos:",l),l}}async getEntities(){try{const n=N.ENDPOINTS.CASOS.ESTADISTICAS_ENTIDADES,r=await this.makeRequest(n);return r.entities?r.entities.map(m=>({codigo:m.codigo||"",nombre:m.nombre||""})):[]}catch(n){return console.error("Error al obtener entidades:",n),[]}}async checkBackendConnection(){try{return(await this.makeRequest(N.ENDPOINTS.CASOS.TEST)).message==="Casos router funcionando correctamente"}catch(n){return console.error("Error de conectividad con el backend:",n),!1}}}const V=new ot,rt={class:"relative bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto overflow-x-hidden mt-4 sm:mt-10 md:mt-16 mx-4 sm:mx-0"},at={class:"sticky top-0 z-10 bg-white border-b border-gray-200 px-4 sm:px-6 py-3 sm:py-4 rounded-t-2xl flex items-center justify-between"},nt={class:"text-sm text-gray-500 mt-1"},lt={class:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-100"},it={class:"flex items-center space-x-4"},dt={class:"text-2xl font-bold text-gray-900"},ct={class:"text-blue-600 font-medium"},ut={key:0,class:"text-center py-12"},mt={key:1,class:"text-center py-12"},pt={class:"mt-1 text-sm text-red-500"},xt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},ft={class:"bg-blue-50 border border-blue-200 rounded-xl p-4"},vt={class:"flex items-center justify-between"},gt={class:"text-2xl font-bold text-blue-700"},bt={class:"bg-green-50 border border-green-200 rounded-xl p-4"},ht={class:"flex items-center justify-between"},yt={class:"text-2xl font-bold text-green-700"},_t={class:"text-xs text-green-600"},wt={class:"bg-yellow-50 border border-yellow-200 rounded-xl p-4"},kt={class:"flex items-center justify-between"},$t={class:"text-2xl font-bold text-yellow-700"},Ct={class:"bg-white rounded-xl border p-6"},St={class:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4"},Mt={class:"flex justify-between items-center p-3 bg-yellow-50 rounded-lg"},Et={class:"text-center w-full"},Tt={class:"text-lg font-bold text-yellow-600"},jt={class:"flex justify-between items-center p-3 bg-green-50 rounded-lg"},Pt={class:"text-center w-full"},Nt={class:"text-lg font-bold text-green-600"},At={class:"flex justify-between items-center p-3 bg-red-50 rounded-lg"},Dt={class:"text-center w-full"},zt={class:"text-lg font-bold text-red-600"},Bt={class:"flex justify-between items-center p-3 bg-gray-50 rounded-lg"},It={class:"text-center w-full"},Ft={class:"text-lg font-bold text-gray-700"},Rt={class:"bg-gray-50 rounded-xl p-6 space-y-4"},Lt={key:0,class:"text-center py-8 text-gray-500"},Ot={key:1,class:"space-y-3"},Vt={class:"flex items-center justify-between"},Yt={class:"flex items-center space-x-3"},qt={class:"text-sm font-medium text-gray-900"},Ut={class:"text-xs text-gray-500"},Gt={class:"text-right"},Ht={class:"text-lg font-bold text-green-600"},Jt={class:"text-sm text-yellow-600"},Wt={class:"sticky bottom-0 bg-white border-t border-gray-200 px-4 sm:px-6 py-3 sm:py-4 rounded-b-2xl flex justify-end"},Kt=S({__name:"TestDetailsModal",props:{test:{},period:{},entity:{}},emits:["close"],setup(_,{emit:n}){const r=_,m=v(null),i=v(!1),l=v(null),s=v(null);W(()=>r.test,async p=>{p?(await me(),t()):(s.value=null,l.value=null)},{immediate:!0});async function t(){if(r.test){i.value=!0,l.value=null;try{s.value=await V.getTestDetails(r.entity||"general",r.test.codigo,r.period.month,r.period.year)}catch(p){console.error("Error al cargar detalles:",p),l.value=p.message||"Error al cargar los detalles de la prueba",s.value=null}finally{i.value=!1}}}function a(){return`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][r.period.month-1]} ${r.period.year}`}return(p,o)=>(x(),A(ce,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"opacity-0 transform scale-95","enter-to-class":"opacity-100 transform scale-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"opacity-100 transform scale-100","leave-to-class":"opacity-0 transform scale-95"},{default:$(()=>[p.test?(x(),f("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:o[2]||(o[2]=ue(g=>p.$emit("close"),["self"]))},[e("div",rt,[e("div",at,[e("div",null,[o[3]||(o[3]=e("h3",{class:"text-xl font-semibold text-gray-900"},"Detalles de la Prueba",-1)),e("p",nt," Período: "+c(a()),1)]),e("button",{onClick:o[0]||(o[0]=g=>p.$emit("close")),class:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-600 hover:text-gray-800 transition-colors"},[...o[4]||(o[4]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",{class:"p-4 sm:p-6 space-y-4 sm:space-y-6",ref_key:"testDetailsContent",ref:m},[e("div",lt,[e("div",it,[o[5]||(o[5]=e("div",{class:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})])],-1)),e("div",null,[e("h4",dt,c(p.test.nombre),1),e("p",ct,c(p.test.codigo),1)])])]),i.value?(x(),f("div",ut,[...o[6]||(o[6]=[e("div",{class:"relative"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-500 mx-auto"}),e("div",{class:"absolute inset-0 flex items-center justify-center"},[e("div",{class:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"})])],-1),e("p",{class:"text-sm text-gray-500 mt-4"},"Cargando estadísticas detalladas...",-1),e("div",{class:"mt-2 h-1 w-32 bg-gray-200 rounded-full mx-auto overflow-hidden"},[e("div",{class:"h-full bg-blue-500 rounded-full animate-pulse"})],-1)])])):l.value?(x(),f("div",mt,[o[7]||(o[7]=e("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100"},[e("svg",{class:"h-6 w-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),o[8]||(o[8]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Error al cargar datos",-1)),e("p",pt,c(l.value),1),e("div",{class:"mt-4"},[e("button",{onClick:t,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Reintentar ")])])):s.value?(x(),f(L,{key:2},[e("div",xt,[e("div",ft,[e("div",vt,[e("div",null,[o[9]||(o[9]=e("p",{class:"text-sm text-blue-600 font-medium"},"Total Pruebas realizadas",-1)),e("p",gt,c(s.value.estadisticas_principales.total_solicitadas),1)]),o[10]||(o[10]=e("div",{class:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})])],-1))])]),e("div",bt,[e("div",ht,[e("div",null,[o[11]||(o[11]=e("p",{class:"text-sm text-green-600 font-medium"},"Completadas",-1)),e("p",yt,c(s.value.estadisticas_principales.total_completadas),1),e("p",_t,c(s.value.estadisticas_principales.porcentaje_completado)+"% completado",1)]),o[12]||(o[12]=e("div",{class:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",wt,[e("div",kt,[e("div",null,[o[13]||(o[13]=e("p",{class:"text-sm text-yellow-600 font-medium"},"Tiempo Promedio",-1)),e("p",$t,c(p.test.tiempoPromedio.toFixed(1))+" días",1)]),o[14]||(o[14]=e("div",{class:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])])]),e("div",Ct,[o[19]||(o[19]=e("h5",{class:"text-lg font-medium mb-4 flex items-center text-gray-800"},[e("svg",{class:"w-5 h-5 mr-2 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),O(" Tiempos de Procesamiento ")],-1)),e("div",St,[e("div",Mt,[e("div",Et,[o[15]||(o[15]=e("span",{class:"text-sm font-medium text-gray-700"},"Promedio",-1)),e("p",Tt,c(s.value.tiempos_procesamiento.promedio_dias.toFixed(1))+" días",1)])]),e("div",jt,[e("div",Pt,[o[16]||(o[16]=e("span",{class:"text-sm font-medium text-gray-700"},"Dentro de oportunidad",-1)),e("p",Nt,c(s.value.tiempos_procesamiento.dentro_oportunidad),1)])]),e("div",At,[e("div",Dt,[o[17]||(o[17]=e("span",{class:"text-sm font-medium text-gray-700"},"Fuera de oportunidad",-1)),e("p",zt,c(s.value.tiempos_procesamiento.fuera_oportunidad),1)])]),e("div",Bt,[e("div",It,[o[18]||(o[18]=e("span",{class:"text-sm font-medium text-gray-700"},"Total",-1)),e("p",Ft,c(s.value.tiempos_procesamiento.total_casos),1)])])])]),e("div",Rt,[o[23]||(o[23]=e("h5",{class:"text-lg font-semibold text-gray-900"},"Patólogos",-1)),s.value.patologos.length===0?(x(),f("div",Lt,[...o[20]||(o[20]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1),e("p",null,"No se encontraron patólogos",-1)])])):(x(),f("div",Ot,[(x(!0),f(L,null,J(s.value.patologos,g=>(x(),f("div",{key:g.codigo,class:"bg-white rounded-lg p-4 border border-gray-200"},[e("div",Vt,[e("div",Yt,[o[21]||(o[21]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])],-1)),e("div",null,[e("h6",qt,c(g.nombre),1),e("p",Ut,c(g.codigo),1)])]),e("div",Gt,[e("div",Ht,c(g.total_procesadas),1),o[22]||(o[22]=e("div",{class:"text-xs text-gray-500"},"procesadas",-1)),e("div",Jt,c(g.tiempo_promedio.toFixed(1))+" días",1)])])]))),128))]))])],64)):C("",!0)],512),e("div",Wt,[e("button",{onClick:o[1]||(o[1]=g=>p.$emit("close")),class:"inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-200 transition-colors"}," Cerrar ")])])])):C("",!0)]),_:1}))}}),Qt=_e(Kt,[["__scopeId","data-v-02beb05b"]]),Xt={class:"space-y-6"},Zt={class:"mb-4 flex justify-end"},es={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4"},ts={class:"flex items-end gap-2"},ss={key:0,class:"bg-red-50 border border-red-200 rounded-xl p-4"},os={key:2,class:"text-center py-12"},rs={key:3,class:"bg-red-50 border border-red-200 rounded-xl p-4"},as={class:"flex items-center"},ns={class:"text-sm text-red-700 mt-1"},ls={key:4,class:"space-y-4"},is={class:"px-2"},ds={class:"text-xl font-bold text-brand-700"},cs={key:0,class:"text-sm font-normal text-gray-600 ml-2"},us={key:0,class:"text-gray-500"},ms={key:1},ps=S({__name:"TestsReport",setup(_){const n=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],r=new Date,m=r.getFullYear(),i=Array.from({length:5},(d,u)=>m-u),s=(r.getMonth()+11)%12,t=m,a=v(String(s)),p=v(String(t)),o=v(""),g=v(!1),M=v(!1),z=v(null),E=v(null),T=v(!0),B=v(!1),j=v([]),Y=v(null),I=v(null),K=h(()=>{const d=new Date,u=d.getFullYear(),w=d.getMonth();return n.map((k,P)=>Number(p.value)===u&&P>=w?null:{value:String(P),label:k}).filter(k=>k!==null)}),Q=h(()=>i.map(d=>({value:String(d),label:String(d)})));W(p,d=>{const u=new Date,w=u.getFullYear(),k=u.getMonth();if(Number(d)===w&&Number(a.value)>=k){const R=(k+11)%12;a.value=String(R)}});const X=h(()=>{const d=Number(a.value);return Number.isFinite(d)&&n[d]?n[d]:""}),q=h(()=>{var d;return((d=I.value)==null?void 0:d.nombre)||""});pe(async()=>{await F()});async function F(){B.value=!0;try{T.value=await V.checkBackendConnection()}catch(d){console.error("Error al verificar conectividad:",d),T.value=!1}finally{B.value=!1}}const Z=d=>{I.value=d,o.value=(d==null?void 0:d.codigo)||""},ee=d=>{console.error("Error al cargar entidades:",d)},U=async()=>{if(!a.value||!p.value)return;const d=new Date,u=d.getFullYear(),w=d.getMonth(),k=Number(p.value),P=Number(a.value);if(k>u||k===u&&P>=w){console.warn("No se puede generar reporte para un mes futuro");return}g.value=!0,E.value=null,M.value=!1;try{await se(),M.value=!0}catch(R){E.value=R.message||"Error al generar el reporte",M.value=!1}finally{g.value=!1}},te=()=>{a.value=String(s),p.value=String(t),o.value="",I.value=null,M.value=!1,E.value=null};async function se(){const d=await V.getMonthlyTests(Number(a.value)+1,Number(p.value),o.value||void 0);j.value=d.tests,Y.value=d.summary}function oe(d){z.value=d}function re(){z.value=null}return(d,u)=>(x(),f("div",Xt,[b(y(D),{title:"Reporte de pruebas realizadas",description:"Seleccione período, entidad y estado para generar el informe."},{default:$(()=>[e("div",Zt,[b(y($e),{"is-connected":T.value,"is-loading":B.value,onReconnect:F},null,8,["is-connected","is-loading"])]),e("div",es,[b(y(H),{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=w=>a.value=w),label:"Mes",options:K.value,placeholder:"Seleccione mes"},null,8,["modelValue","options"]),b(y(H),{modelValue:p.value,"onUpdate:modelValue":u[1]||(u[1]=w=>p.value=w),label:"Año",options:Q.value,placeholder:"Seleccione año"},null,8,["modelValue","options"]),b(y(he),{modelValue:o.value,"onUpdate:modelValue":u[2]||(u[2]=w=>o.value=w),label:"Entidad",placeholder:"Buscar y seleccionar entidad...",onEntitySelected:Z,onLoadError:ee},null,8,["modelValue"]),e("div",ts,[b(y(ge),{loading:g.value,disabled:!a.value||!p.value||!T.value,text:g.value?"Generando...":"Generar Informe",onClick:U},null,8,["loading","disabled","text"]),b(y(be),{onClick:te},{icon:$(()=>[b(y(ye),{class:"w-4 h-4 mr-2"})]),default:$(()=>[u[3]||(u[3]=O(" Limpiar ",-1))]),_:1})])])]),_:1}),T.value?C("",!0):(x(),f("div",ss,[e("div",{class:"flex items-center"},[u[4]||(u[4]=e("svg",{class:"w-5 h-5 text-red-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),u[5]||(u[5]=e("div",null,[e("h3",{class:"text-sm font-medium text-red-800"},"Error de conectividad"),e("p",{class:"text-sm text-red-700 mt-1"},"No se puede conectar con el backend. Verifique que el servidor esté ejecutándose.")],-1)),e("button",{onClick:F,class:"ml-auto px-3 py-1 text-sm bg-red-100 text-red-700 rounded-md hover:bg-red-200"}," Reintentar ")])])),!M.value&&!g.value?(x(),A(y(D),{key:1,title:"Vista previa",description:"Selecciona un período y genera el informe."},{default:$(()=>[...u[6]||(u[6]=[e("div",{class:"text-gray-600"},'Aún no se ha generado el informe. Selecciona mes y año y presiona "Generar Informe".',-1)])]),_:1})):C("",!0),g.value?(x(),f("div",os,[...u[7]||(u[7]=[xe('<div class="relative"><div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-500 mx-auto"></div><div class="absolute inset-0 flex items-center justify-center"><div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></div></div></div><p class="text-sm text-gray-500 mt-4">Generando reporte...</p><div class="mt-2 h-1 w-32 bg-gray-200 rounded-full mx-auto overflow-hidden"><div class="h-full bg-blue-500 rounded-full animate-pulse"></div></div>',3)])])):E.value?(x(),f("div",rs,[e("div",as,[u[9]||(u[9]=e("svg",{class:"w-5 h-5 text-red-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",null,[u[8]||(u[8]=e("h3",{class:"text-sm font-medium text-red-800"},"Error al generar reporte",-1)),e("p",ns,c(E.value),1)]),e("button",{onClick:U,class:"ml-auto px-3 py-1 text-sm bg-red-100 text-red-700 rounded-md hover:bg-red-200"}," Reintentar ")])])):M.value&&!g.value?(x(),f("div",ls,[e("div",is,[e("h2",ds,[O(" Reporte de Pruebas - "+c(X.value)+" "+c(p.value)+" ",1),q.value?(x(),f("span",cs," - "+c(q.value),1)):C("",!0)])]),b(Be,{datos:j.value,resumen:Y.value},null,8,["datos","resumen"]),b(Ie,{datos:j.value},null,8,["datos"]),b(y(D),{title:"Detalle por Prueba",description:"Tabla con métricas detalladas. Haz clic en una fila para ver detalles completos."},{default:$(()=>[j.value.length===0?(x(),f("div",us,"No hay pruebas con datos para el período seleccionado.")):(x(),f("div",ms,[b(st,{datos:j.value,onTestClick:oe},null,8,["datos"])]))]),_:1})])):C("",!0),b(Qt,{test:z.value,period:{month:Number(a.value)+1,year:Number(p.value)},entity:o.value||"",onClose:re},null,8,["test","period","entity"])]))}}),xs={class:"p-6"},fs={key:1,class:"space-y-6"},Ss=S({__name:"TestsReportsView",setup(_){const n=v("Reportes de Pruebas"),{canAccessStatistics:r}=le();return(m,i)=>(x(),A(y(ie),null,{default:$(()=>[b(y(fe),{pageTitle:n.value},null,8,["pageTitle"]),e("div",xs,[y(r)?(x(),f("div",fs,[b(ps)])):(x(),A(ve,{key:0}))])]),_:1}))}});export{Ss as default};
