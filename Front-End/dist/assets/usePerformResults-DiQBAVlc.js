var Ce=Object.defineProperty;var De=(i,a,o)=>a in i?Ce(i,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[a]=o;var pe=(i,a,o)=>De(i,typeof a!="symbol"?a+"":a,o);/* empty css                                                                   */import{_ as Se}from"./Notification.vue_vue_type_script_setup_true_lang-Dr_eoe6-.js";import{d as se,b as r,e as n,h as e,F as U,l as G,n as re,t as l,f as le,u as de,g as u,i as h,c as R,j as Ee,T as Ae,w as Ne,q as ze,r as f}from"./index-CAHFE_9E.js";import{U as Pe}from"./UserCircleIcon-DNVwMiGR.js";import{D as Oe,c as Re,A as Me,a as ne}from"./PathologistList.vue_vue_type_style_index_0_scoped_45f5ffeb_lang-FwbajLSj.js";import{c as ve}from"./casesApi.service-DwGpQD03.js";const Fe={class:"h-full flex flex-col"},Te={class:"flex flex-wrap items-center gap-4 mb-4 flex-shrink-0"},Ve=["onClick"],Be={class:"flex-1 min-h-0"},Ks=se({__name:"ResultEditor",props:{modelValue:{},activeSection:{},sections:{}},emits:["update:modelValue","update:activeSection"],setup(i){const a=i,o=[{key:"method",label:"M√©todo"},{key:"macro",label:"Corte Macro"},{key:"micro",label:"Corte Micro"},{key:"diagnosis",label:"Diagn√≥stico"}];function d(t){var s;return a.sections?!!((s=a.sections[t])!=null&&s.trim()):!0}function m(t){const s=t===a.activeSection,p=d(t);return s?"bg-blue-600 text-white border-blue-600":p?"bg-white text-gray-700 border-gray-300 hover:bg-gray-50":"bg-yellow-50 text-yellow-700 border-yellow-300 hover:bg-yellow-100"}function v(){return d(a.activeSection)?"border-gray-300 focus:border-blue-400 focus:ring-blue-400":"border-yellow-300 focus:border-yellow-400 focus:ring-yellow-400"}return(t,s)=>(n(),r("div",Fe,[e("div",Te,[(n(),r(U,null,G(o,p=>e("button",{key:p.key,class:re(["px-3 py-1.5 rounded text-sm border transition-colors",m(p.key)]),onClick:k=>t.$emit("update:activeSection",p.key)},l(p.label),11,Ve)),64))]),e("div",Be,[le(de(Se),{"model-value":t.modelValue,"onUpdate:modelValue":s[0]||(s[0]=p=>t.$emit("update:modelValue",p)),class:re(["w-full h-full resize-none py-3 transition-colors",v()]),rows:12,"show-counter":!1},null,8,["model-value","class"])])]))}}),je={class:"flex items-center gap-2 mb-3"},Je={key:0,class:"text-gray-400 text-sm"},Le={key:1,class:"text-gray-400 text-sm"},qe={key:2,class:"space-y-4"},He={class:"grid grid-cols-1 gap-2 text-sm text-gray-700"},Ue={class:"font-medium"},Ge={key:0},We={key:1},Ke={key:2},Qe={key:0,class:"text-xs text-gray-500"},Xe={key:0,class:"text-sm text-gray-700"},Ye={class:"mt-1 p-2 bg-gray-50 rounded whitespace-pre-wrap text-sm"},Ze={class:"text-sm text-gray-700"},et={key:0,class:"mt-1 text-xs text-gray-500"},tt={key:1,class:"mt-2 overflow-x-auto rounded-lg border border-gray-200"},st={class:"min-w-full divide-y divide-gray-200"},ot={class:"bg-white divide-y divide-gray-200"},at=["onClick"],it={class:"px-3 py-2 whitespace-nowrap text-xs text-gray-900 font-medium"},nt={class:"px-3 py-2 text-xs text-gray-900"},rt={class:"px-3 py-2 whitespace-nowrap text-xs text-gray-500"},Qs=se({__name:"PatientInfoCard",props:{patient:{},loading:{type:Boolean},previousCases:{}},emits:["caseClick"],setup(i){return(a,o)=>{var d;return n(),r("div",null,[e("div",je,[le(de(Pe),{class:"w-5 h-5 text-gray-600"}),o[0]||(o[0]=e("h3",{class:"text-lg font-semibold text-gray-800"},"Informaci√≥n del paciente",-1))]),a.loading?(n(),r("div",Je,"Cargando...")):a.patient?(n(),r("div",qe,[e("div",He,[e("div",Ue,l(a.patient.fullName),1),e("div",null,[o[1]||(o[1]=e("span",{class:"font-bold"},"Documento:",-1)),h(" "+l(a.patient.document),1)]),e("div",null,[o[2]||(o[2]=e("span",{class:"font-bold"},"Edad:",-1)),h(" "+l(a.patient.age)+" a√±os",1)]),a.patient.sexo?(n(),r("div",Ge,[o[3]||(o[3]=e("span",{class:"font-bold"},"Sexo:",-1)),h(" "+l(a.patient.sexo),1)])):u("",!0),a.patient.tipoAtencion?(n(),r("div",We,[o[4]||(o[4]=e("span",{class:"font-bold"},"Tipo de atenci√≥n:",-1)),h(" "+l(a.patient.tipoAtencion),1)])):u("",!0),a.patient.entity?(n(),r("div",Ke,[o[5]||(o[5]=e("span",{class:"font-bold"},"Entidad:",-1)),h(" "+l(a.patient.entity)+" ",1),a.patient.entityCode?(n(),r("span",Qe,"("+l(a.patient.entityCode)+")",1)):u("",!0)])):u("",!0)]),a.patient.observaciones?(n(),r("div",Xe,[o[6]||(o[6]=e("span",{class:"font-bold"},"Observaciones:",-1)),e("div",Ye,l(a.patient.observaciones),1)])):u("",!0),e("div",Ze,[o[8]||(o[8]=e("span",{class:"font-bold"},"Casos anteriores:",-1)),(d=a.previousCases)!=null&&d.length?(n(),r("div",tt,[e("table",st,[o[7]||(o[7]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"C√≥digo"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Fecha creaci√≥n")])],-1)),e("tbody",ot,[(n(!0),r(U,null,G(a.previousCases,m=>(n(),r("tr",{key:m._id,class:"hover:bg-gray-50 cursor-pointer",onClick:v=>a.$emit("caseClick",m)},[e("td",it,l(m.CasoCode),1),e("td",nt,l(m.estado),1),e("td",rt,l(new Date(m.fecha_ingreso).toLocaleDateString()),1)],8,at))),128))])])])):(n(),r("div",et,"Sin casos anteriores"))])])):(n(),r("div",Le,"Sin datos de paciente"))])}}}),lt={class:"flex items-center gap-2 mb-3"},dt={key:0,class:"text-gray-400 text-sm"},ct={key:1,class:"text-gray-400 text-sm"},ut={key:2,class:"space-y-4"},mt={class:"grid grid-cols-1 gap-2 text-sm text-gray-700"},gt={class:"capitalize"},pt={key:0},vt={key:1},ft={key:2},yt={key:3},bt={class:"space-y-2"},_t={class:"space-y-2"},xt={class:"text-sm"},ht={class:"list-disc list-inside text-xs text-gray-700 mt-1"},wt={class:"font-bold"},It={key:0,class:"text-sm text-gray-700"},kt={class:"mt-1 p-2 bg-gray-50 rounded whitespace-pre-wrap text-sm"},Xs=se({__name:"CaseDetailsCard",props:{details:{},loading:{type:Boolean}},setup(i){function a(o){if(!o)return"-";try{return new Date(o).toLocaleString()}catch{return o}}return(o,d)=>{var m,v,t,s,p;return n(),r("div",null,[e("div",lt,[le(de(Oe),{class:"w-5 h-5 text-gray-600"}),d[0]||(d[0]=e("h3",{class:"text-lg font-semibold text-gray-800"},"Detalles del caso",-1))]),o.loading?(n(),r("div",dt,"Cargando...")):o.details?(n(),r("div",ut,[e("div",mt,[e("div",null,[d[1]||(d[1]=e("span",{class:"font-bold"},"Caso:",-1)),h(" "+l(o.details.CasoCode),1)]),e("div",null,[d[2]||(d[2]=e("span",{class:"font-bold"},"Estado:",-1)),d[3]||(d[3]=h()),e("span",gt,l(o.details.estado),1)]),e("div",null,[d[4]||(d[4]=e("span",{class:"font-bold"},"Creaci√≥n:",-1)),h(" "+l(a(o.details.fecha_creacion)),1)]),o.details.fecha_firma?(n(),r("div",pt,[d[5]||(d[5]=e("span",{class:"font-bold"},"Firma:",-1)),h(" "+l(a(o.details.fecha_firma)),1)])):u("",!0),o.details.entidad_info?(n(),r("div",vt,[d[6]||(d[6]=e("span",{class:"font-bold"},"Entidad:",-1)),h(" "+l((m=o.details.entidad_info)==null?void 0:m.nombre)+" ("+l((v=o.details.entidad_info)==null?void 0:v.codigo)+")",1)])):u("",!0),o.details.medico_solicitante?(n(),r("div",ft,[d[7]||(d[7]=e("span",{class:"font-bold"},"M√©dico solicitante:",-1)),h(" "+l((t=o.details.medico_solicitante)==null?void 0:t.nombre),1)])):u("",!0),o.details.patologo_asignado?(n(),r("div",yt,[d[8]||(d[8]=e("span",{class:"font-bold"},"Pat√≥logo asignado:",-1)),h(" "+l((s=o.details.patologo_asignado)==null?void 0:s.nombre)+" ("+l((p=o.details.patologo_asignado)==null?void 0:p.codigo)+")",1)])):u("",!0)]),e("div",bt,[d[10]||(d[10]=e("div",{class:"text-sm text-gray-500"},"Muestras y pruebas",-1)),e("div",_t,[(n(!0),r(U,null,G(o.details.muestras,(k,A)=>(n(),r("div",{key:A,class:"border rounded p-2"},[e("div",xt,[d[9]||(d[9]=e("span",{class:"font-bold"},"Regi√≥n:",-1)),h(" "+l(k.region_cuerpo),1)]),e("ul",ht,[(n(!0),r(U,null,G(k.pruebas,(D,N)=>(n(),r("li",{key:N},[e("span",wt,l(D.id),1),h(" - "+l(D.nombre),1)]))),128))])]))),128))])]),o.details.observaciones_generales?(n(),r("div",It,[d[11]||(d[11]=e("span",{class:"font-bold"},"Observaciones generales:",-1)),e("div",kt,l(o.details.observaciones_generales),1)])):u("",!0)])):(n(),r("div",ct,"Sin datos del caso"))])}}}),$t={class:"relative bg-white w-full max-w-4xl rounded-t-2xl sm:rounded-2xl shadow-2xl h-[85vh] sm:h-auto sm:max-h-[90vh] overflow-y-auto overflow-x-hidden"},Ct={class:"sticky top-0 z-10 bg-white border-b border-gray-200 px-6 py-4 rounded-t-2xl flex items-center justify-between"},Dt={class:"p-6 space-y-6"},St={class:"grid grid-cols-2 gap-4 bg-gray-50 rounded-xl p-4"},Et={class:"text-base font-medium text-gray-900"},At={class:"text-base font-medium text-gray-900"},Nt={class:"text-base font-medium text-gray-900"},zt={class:"text-base font-medium text-gray-900"},Pt={key:0},Ot={class:"text-base font-medium text-gray-900"},Rt={key:1},Mt={class:"text-base font-medium text-gray-900"},Ft={key:2},Tt={class:"text-base font-medium text-gray-900 capitalize"},Vt={key:3},Bt={class:"text-base font-medium text-gray-900"},jt={class:"grid grid-cols-3 gap-4 bg-gray-50 rounded-xl p-4"},Jt={class:"text-base font-medium text-gray-900"},Lt={key:0},qt={class:"text-base font-medium text-gray-900"},Ht={key:1},Ut={class:"text-base font-medium text-gray-900"},Gt={key:0,class:"bg-gray-50 rounded-xl p-4 space-y-3"},Wt={key:0,class:"border border-gray-200 rounded-lg p-3 bg-white"},Kt={class:"text-sm font-medium text-gray-900"},Qt={key:1,class:"border border-gray-200 rounded-lg p-3 bg-white"},Xt={class:"text-sm text-gray-800 break-words"},Yt={class:"bg-gray-50 rounded-xl p-4 space-y-3"},Zt={key:0,class:"space-y-3"},es={class:"flex items-center justify-between mb-2"},ts={class:"text-sm font-medium text-gray-900"},ss={class:"flex flex-wrap gap-2"},os=["title"],as={key:1,class:"text-sm text-gray-500"},is={key:1,class:"bg-gray-50 rounded-xl p-4 space-y-3"},ns={key:0,class:"border border-gray-200 rounded-lg p-3 bg-white"},rs={class:"text-sm font-medium text-gray-900 break-words"},ls={key:1,class:"border border-gray-200 rounded-lg p-3 bg-white"},ds={class:"text-sm text-gray-800 break-words"},cs={key:2,class:"border border-gray-200 rounded-lg p-3 bg-white"},us={class:"text-sm text-gray-800 break-words"},ms={key:3,class:"border border-gray-200 rounded-lg p-3 bg-white"},gs={class:"text-sm text-gray-800 break-words"},ps={key:2,class:"bg-gray-50 rounded-xl p-4 space-y-3"},vs={key:0,class:"border border-gray-200 rounded-lg p-3 bg-white"},fs={class:"flex items-center gap-2 mb-2"},ys={class:"text-sm font-mono text-gray-600"},bs={class:"text-sm text-gray-800"},_s={key:1,class:"border border-gray-200 rounded-lg p-3 bg-white"},xs={class:"flex items-center gap-2 mb-2"},hs={class:"text-sm font-mono text-gray-600"},ws={class:"text-sm text-gray-800"},Is={key:3,class:"bg-gray-50 rounded-xl p-4"},ks={class:"grid grid-cols-2 gap-4"},$s={class:"text-base font-medium text-gray-900"},Cs={class:"text-base font-medium text-gray-900"},Ds={key:4,class:"bg-gray-50 rounded-xl p-4"},Ss={class:"grid grid-cols-2 gap-4"},Es={key:0},As={class:"text-base font-medium text-gray-900"},Ns={key:1},zs={class:"text-base font-medium text-gray-900"},Ps={key:2},Os={class:"text-base font-medium text-gray-900"},Ys=se({__name:"PreviousCaseDetailsModal",props:{caseItem:{}},emits:["close"],setup(i){function a(t){return t?new Date(t).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A"}const{isExpanded:o,isMobileOpen:d,isHovered:m}=Re(),v=R(()=>o.value&&!d.value||!o.value&&m.value?"left-0 lg:left-72":"left-0 lg:left-20");return(t,s)=>(n(),Ee(Ae,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"opacity-0 transform scale-95","enter-to-class":"opacity-100 transform scale-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"opacity-100 transform scale-100","leave-to-class":"opacity-0 transform scale-95"},{default:Ne(()=>{var p,k,A,D,N,y,$,x,S,B,O,Y,j,M,F,g,C,W,w,z,K,J,Z,L,Q,T,q,X;return[t.caseItem?(n(),r("div",{key:0,class:re(["fixed right-0 bottom-0 z-[9999] flex items-end sm:items-center justify-center p-2 sm:p-4 bg-black/40","top-16",v.value]),onClick:s[1]||(s[1]=ze(H=>t.$emit("close"),["self"]))},[e("div",$t,[e("div",Ct,[s[2]||(s[2]=e("h3",{class:"text-xl font-semibold text-gray-900"},"Detalles del Caso Anterior",-1)),e("button",{onClick:s[0]||(s[0]=H=>t.$emit("close")),class:"text-gray-400 hover:text-gray-600"},"‚úï")]),e("div",Dt,[e("div",St,[e("div",null,[s[3]||(s[3]=e("p",{class:"text-sm text-gray-500"},"C√≥digo del Caso",-1)),e("p",Et,l(((p=t.caseItem)==null?void 0:p.CasoCode)||"N/A"),1)]),e("div",null,[s[4]||(s[4]=e("p",{class:"text-sm text-gray-500"},"Estado",-1)),e("p",At,l(((k=t.caseItem)==null?void 0:k.estado)||"N/A"),1)]),e("div",null,[s[5]||(s[5]=e("p",{class:"text-sm text-gray-500"},"Nombre del Paciente",-1)),e("p",Nt,l(((D=(A=t.caseItem)==null?void 0:A.paciente)==null?void 0:D.nombre)||"N/A"),1)]),e("div",null,[s[6]||(s[6]=e("p",{class:"text-sm text-gray-500"},"C√©dula",-1)),e("p",zt,l(((y=(N=t.caseItem)==null?void 0:N.paciente)==null?void 0:y.cedula)||"N/A"),1)]),(x=($=t.caseItem)==null?void 0:$.paciente)!=null&&x.edad?(n(),r("div",Pt,[s[7]||(s[7]=e("p",{class:"text-sm text-gray-500"},"Edad",-1)),e("p",Ot,l(t.caseItem.paciente.edad)+" a√±os",1)])):u("",!0),(B=(S=t.caseItem)==null?void 0:S.paciente)!=null&&B.sexo?(n(),r("div",Rt,[s[8]||(s[8]=e("p",{class:"text-sm text-gray-500"},"Sexo",-1)),e("p",Mt,l(t.caseItem.paciente.sexo),1)])):u("",!0),(Y=(O=t.caseItem)==null?void 0:O.paciente)!=null&&Y.tipo_atencion?(n(),r("div",Ft,[s[9]||(s[9]=e("p",{class:"text-sm text-gray-500"},"Tipo de Atenci√≥n",-1)),e("p",Tt,l(t.caseItem.paciente.tipo_atencion),1)])):u("",!0),(M=(j=t.caseItem)==null?void 0:j.paciente)!=null&&M.entidad_info?(n(),r("div",Vt,[s[10]||(s[10]=e("p",{class:"text-sm text-gray-500"},"Entidad",-1)),e("p",Bt,l(t.caseItem.paciente.entidad_info.nombre||"No especificada"),1)])):u("",!0)]),e("div",jt,[e("div",null,[s[11]||(s[11]=e("p",{class:"text-sm text-gray-500"},"Fecha de Ingreso",-1)),e("p",Jt,l((F=t.caseItem)!=null&&F.fecha_ingreso?a(t.caseItem.fecha_ingreso):"N/A"),1)]),(g=t.caseItem)!=null&&g.fecha_firma?(n(),r("div",Lt,[s[12]||(s[12]=e("p",{class:"text-sm text-gray-500"},"Fecha de Firma",-1)),e("p",qt,l(a(t.caseItem.fecha_firma)),1)])):(n(),r("div",Ht,[...s[13]||(s[13]=[e("p",{class:"text-sm text-gray-500"},"Fecha de Firma",-1),e("p",{class:"text-base font-medium text-gray-900"},"Pendiente",-1)])])),e("div",null,[s[14]||(s[14]=e("p",{class:"text-sm text-gray-500"},"Pat√≥logo Asignado",-1)),e("p",Ut,l(((W=(C=t.caseItem)==null?void 0:C.patologo_asignado)==null?void 0:W.nombre)||"Sin asignar"),1)])]),(w=t.caseItem)!=null&&w.servicio||(z=t.caseItem)!=null&&z.observaciones_generales?(n(),r("div",Gt,[s[17]||(s[17]=e("h5",{class:"text-sm font-medium text-gray-700"},"Informaci√≥n Adicional",-1)),t.caseItem.servicio?(n(),r("div",Wt,[s[15]||(s[15]=e("div",{class:"mb-2"},[e("p",{class:"text-sm text-gray-600"},"Servicio")],-1)),e("p",Kt,l(t.caseItem.servicio),1)])):u("",!0),t.caseItem.observaciones_generales?(n(),r("div",Qt,[s[16]||(s[16]=e("div",{class:"mb-2"},[e("p",{class:"text-sm text-gray-600"},"Observaciones Generales")],-1)),e("p",Xt,l(t.caseItem.observaciones_generales),1)])):u("",!0)])):u("",!0),e("div",Yt,[s[19]||(s[19]=e("h5",{class:"text-sm font-medium text-gray-700"},"Muestras y Pruebas",-1)),(K=t.caseItem)!=null&&K.muestras&&t.caseItem.muestras.length?(n(),r("div",Zt,[(n(!0),r(U,null,G(t.caseItem.muestras,(H,oe)=>(n(),r("div",{key:oe,class:"border border-gray-200 rounded-lg p-3 bg-white"},[e("div",es,[s[18]||(s[18]=e("p",{class:"text-sm text-gray-600"},"Regi√≥n del cuerpo",-1)),e("p",ts,l(H.region_cuerpo||"No especificada"),1)]),e("div",ss,[(n(!0),r(U,null,G(H.pruebas,(E,ae)=>(n(),r("span",{key:ae,class:"relative inline-flex items-center justify-center bg-gray-100 text-gray-700 font-mono text-xs pl-2 pr-6 py-0.5 rounded border text-nowrap",title:E.nombre&&E.nombre!==E.id?E.nombre:""},l(E.id)+" - "+l(E.nombre||E.id),9,os))),128))])]))),128))])):(n(),r("div",as,"Sin muestras registradas"))]),(J=t.caseItem)!=null&&J.resultado&&(t.caseItem.resultado.resultado_macro||t.caseItem.resultado.resultado_micro||t.caseItem.resultado.diagnostico||t.caseItem.resultado.tipo_resultado)?(n(),r("div",is,[s[24]||(s[24]=e("h5",{class:"text-sm font-medium text-gray-700"},"Resultado del Informe",-1)),t.caseItem.resultado.tipo_resultado?(n(),r("div",ns,[s[20]||(s[20]=e("div",{class:"mb-2"},[e("p",{class:"text-sm text-gray-600"},"Tipo de Resultado")],-1)),e("p",rs,l(t.caseItem.resultado.tipo_resultado),1)])):u("",!0),t.caseItem.resultado.resultado_macro?(n(),r("div",ls,[s[21]||(s[21]=e("div",{class:"mb-2"},[e("p",{class:"text-sm text-gray-600"},"Resultado Macrosc√≥pico")],-1)),e("p",ds,l(t.caseItem.resultado.resultado_macro),1)])):u("",!0),t.caseItem.resultado.resultado_micro?(n(),r("div",cs,[s[22]||(s[22]=e("div",{class:"mb-2"},[e("p",{class:"text-sm text-gray-600"},"Resultado Microsc√≥pico")],-1)),e("p",us,l(t.caseItem.resultado.resultado_micro),1)])):u("",!0),t.caseItem.resultado.diagnostico?(n(),r("div",ms,[s[23]||(s[23]=e("div",{class:"mb-2"},[e("p",{class:"text-sm text-gray-600"},"Diagn√≥stico")],-1)),e("p",gs,l(t.caseItem.resultado.diagnostico),1)])):u("",!0)])):u("",!0),(Z=t.caseItem)!=null&&Z.resultado&&(t.caseItem.resultado.diagnostico_cie10||t.caseItem.resultado.diagnostico_cieo)?(n(),r("div",ps,[s[27]||(s[27]=e("h5",{class:"text-sm font-medium text-gray-700"},"Diagn√≥sticos Clasificados",-1)),t.caseItem.resultado.diagnostico_cie10?(n(),r("div",vs,[e("div",fs,[s[25]||(s[25]=e("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"}," CIE-10 ",-1)),e("span",ys,l(t.caseItem.resultado.diagnostico_cie10.codigo),1)]),e("p",bs,l(t.caseItem.resultado.diagnostico_cie10.nombre),1)])):u("",!0),t.caseItem.resultado.diagnostico_cieo?(n(),r("div",_s,[e("div",xs,[s[26]||(s[26]=e("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"}," CIE-O ",-1)),e("span",hs,l(t.caseItem.resultado.diagnostico_cieo.codigo),1)]),e("p",ws,l(t.caseItem.resultado.diagnostico_cieo.nombre),1)])):u("",!0)])):u("",!0),(Q=(L=t.caseItem)==null?void 0:L.resultado)!=null&&Q.firmado?(n(),r("div",Is,[s[30]||(s[30]=e("h5",{class:"text-sm font-medium text-gray-700 mb-3"},"Informaci√≥n de Firma",-1)),e("div",ks,[e("div",null,[s[28]||(s[28]=e("p",{class:"text-sm text-gray-500"},"Fecha de Firma",-1)),e("p",$s,l(t.caseItem.resultado.fecha_firma?a(t.caseItem.resultado.fecha_firma):"N/A"),1)]),e("div",null,[s[29]||(s[29]=e("p",{class:"text-sm text-gray-500"},"Pat√≥logo Firmante",-1)),e("p",Cs,l(t.caseItem.resultado.patologo_firma||"N/A"),1)])])])):u("",!0),(T=t.caseItem)!=null&&T.creado_por||(q=t.caseItem)!=null&&q.actualizado_por||(X=t.caseItem)!=null&&X.fecha_actualizacion?(n(),r("div",Ds,[s[34]||(s[34]=e("h5",{class:"text-sm font-medium text-gray-700 mb-3"},"Informaci√≥n de Auditor√≠a",-1)),e("div",Ss,[t.caseItem.creado_por?(n(),r("div",Es,[s[31]||(s[31]=e("p",{class:"text-sm text-gray-500"},"Creado por",-1)),e("p",As,l(t.caseItem.creado_por),1)])):u("",!0),t.caseItem.actualizado_por?(n(),r("div",Ns,[s[32]||(s[32]=e("p",{class:"text-sm text-gray-500"},"Actualizado por",-1)),e("p",zs,l(t.caseItem.actualizado_por),1)])):u("",!0),t.caseItem.fecha_actualizacion?(n(),r("div",Ps,[s[33]||(s[33]=e("p",{class:"text-sm text-gray-500"},"√öltima actualizaci√≥n",-1)),e("p",Os,l(a(t.caseItem.fecha_actualizacion)),1)])):u("",!0)])])):u("",!0)])])],2)):u("",!0)]}),_:1}))}}),Rs=i=>new Promise(a=>setTimeout(a,i));async function Ms(i,a){return await Rs(250),{html:a}}function Fs(i){var o,d,m,v;const a=i.paciente;return{id:a.codigo,fullName:a.nombre,document:a.cedula,age:a.edad,entity:((o=i.entidad_info)==null?void 0:o.nombre)||((d=a.entidad_info)==null?void 0:d.nombre),entityCode:((m=i.entidad_info)==null?void 0:m.codigo)||((v=a.entidad_info)==null?void 0:v.codigo),sexo:a.sexo,tipoAtencion:a.tipo_atencion,observaciones:a.observaciones||""}}function Ts(i){var a,o;return{_id:i._id||"",CasoCode:i.CasoCode,paciente:{codigo:i.paciente.codigo,nombre:i.paciente.nombre,edad:i.paciente.edad,sexo:i.paciente.sexo,entidad_info:{codigo:(a=i.paciente.entidad_info)==null?void 0:a.codigo,nombre:(o=i.paciente.entidad_info)==null?void 0:o.nombre},tipo_atencion:i.paciente.tipo_atencion,cedula:i.paciente.cedula,observaciones:i.paciente.observaciones||"",fecha_actualizacion:i.paciente.fecha_actualizacion},medico_solicitante:i.medico_solicitante?{nombre:i.medico_solicitante.nombre}:void 0,muestras:(i.muestras||[]).map(d=>({region_cuerpo:d.region_cuerpo,pruebas:(d.pruebas||[]).map(m=>({id:m.id,nombre:m.nombre}))})),estado:i.estado,fecha_creacion:i.fecha_creacion||i.fecha_ingreso,fecha_firma:i.fecha_firma||null,fecha_actualizacion:i.fecha_actualizacion,observaciones_generales:i.observaciones_generales||"",fecha_creacion:i.fecha_creacion||i.fecha_ingreso,is_active:i.activo??!0,patologo_asignado:i.patologo_asignado?{codigo:i.patologo_asignado.codigo,nombre:i.patologo_asignado.nombre}:void 0,actualizado_por:i.actualizado_por,entidad_info:i.entidad_info?{codigo:i.entidad_info.codigo,nombre:i.entidad_info.nombre}:void 0,servicio:i.servicio}}class Vs{constructor(){pe(this,"endpoint",Me.ENDPOINTS.CASES)}async upsertResultado(a,o){var m,v;console.log("üîÑ ResultsApiService.upsertResultado iniciado"),console.log("üì§ Datos enviados:",{casoCode:a,data:o});const d=`${this.endpoint}/caso-code/${a}/resultado`;console.log("üåê Endpoint:",d);try{const t=await ne.put(d,{metodo:o.metodo,resultado_macro:o.resultado_macro,resultado_micro:o.resultado_micro,diagnostico:o.diagnostico,observaciones:o.observaciones,diagnostico_cie10:o.diagnostico_cie10,diagnostico_cieo:o.diagnostico_cieo});return console.log("‚úÖ upsertResultado exitoso:",t),t}catch(t){throw console.error("‚ùå Error en upsertResultado:",t),console.error("Error details:",{message:t.message,response:(m=t.response)==null?void 0:m.data,status:(v=t.response)==null?void 0:v.status}),t}}async firmarResultado(a,o,d){var v,t,s,p,k,A,D,N;console.log("üîÑ ResultsApiService.firmarResultado iniciado"),console.log("üì§ Datos enviados:",{casoCode:a,data:o,patologoCodigo:d});const m=`${this.endpoint}/caso-code/${a}/resultado/firmar-con-diagnosticos`;console.log("üåê Endpoint:",m);try{console.log("üîÑ Intentando con endpoint espec√≠fico de firma...");const y=await ne.post(m,{metodo:o.metodo,resultado_macro:o.resultado_macro,resultado_micro:o.resultado_micro,diagnostico:o.diagnostico,observaciones:o.observaciones,diagnostico_cie10:o.diagnostico_cie10,diagnostico_cieo:o.diagnostico_cieo},{params:{patologo_codigo:d}});return console.log("‚úÖ Endpoint espec√≠fico de firma exitoso:",y),y}catch(y){if(console.error("‚ùå Error en endpoint espec√≠fico de firma:",y),console.error("Error details:",{message:y.message,response:(v=y.response)==null?void 0:v.data,status:(t=y.response)==null?void 0:t.status}),(k=(p=(s=y.response)==null?void 0:s.data)==null?void 0:p.message)!=null&&k.includes("estado")||(A=y.message)!=null&&A.includes("estado")){console.warn("üîÑ Endpoint de firma fall√≥ por restricci√≥n de estado, intentando con actualizaci√≥n regular...");try{console.log("üîÑ Actualizando resultado...");const $=await this.upsertResultado(a,o);console.log("‚úÖ Resultado actualizado:",$);try{console.log("üîÑ Cambiando estado a COMPLETADO...");const x=await ne.put(`${this.endpoint}/caso-code/${a}`,{estado:"COMPLETADO"});console.log("‚úÖ Estado cambiado exitosamente:",x)}catch(x){console.warn("‚ö†Ô∏è No se pudo cambiar el estado autom√°ticamente:",x),console.warn("State error details:",{message:x.message,response:(D=x.response)==null?void 0:D.data,status:(N=x.response)==null?void 0:N.status})}return $}catch($){throw console.error("‚ùå Error en fallback de actualizaci√≥n:",$),$}}throw y}}}const Bs=new Vs;function js(){const i=f(null),a=R(()=>!!i.value),o=p=>{i.value=p},d=()=>{i.value=null},m=()=>{i.value=null},v=()=>i.value?`${i.value.codigo} - ${i.value.nombre}`:"";return{primaryDisease:i,hasDisease:a,setPrimaryDisease:o,clearPrimaryDisease:d,clearDiagnosis:m,formatDiagnosisForReport:v,getDiagnosisData:()=>({primary:i.value,formatted:v()}),validateDiagnosis:()=>{const p=[];return i.value||p.push("Debe seleccionar un diagn√≥stico"),{isValid:p.length===0,errors:p}}}}function Zs(i){const a=f(!1),o=f(!1),d=f(!1),m=f(!1),{primaryDisease:v,hasDisease:t,setPrimaryDisease:s,clearPrimaryDisease:p,clearDiagnosis:k,formatDiagnosisForReport:A,getDiagnosisData:D,validateDiagnosis:N}=js(),y=f(null),$=R(()=>!!y.value),x=f(!1),S=f(null),B=f(null),O=f([]),Y=f([]),j=f(null),M=f(void 0),F=f("method"),g=f({method:"",macro:"",micro:"",diagnosis:""}),C=f([]),W=f(void 0),w=f(null),z=f(null),K=f(null),J=f(!1),Z=R(()=>{}),L=R(()=>{const c=[];return g.value.method.trim()||c.push("M√©todo"),g.value.macro.trim()||c.push("Corte Macro"),g.value.micro.trim()||c.push("Corte Micro"),g.value.diagnosis.trim()||c.push("Diagn√≥stico"),c}),Q=R(()=>L.value.length===0),T=f(""),q=f(void 0),X=f("[]"),H=R(()=>{const c=JSON.stringify(C.value);return JSON.stringify(g.value)!==T.value||M.value!==q.value||c!==X.value});async function oe(){if(i){a.value=!0,w.value=null;try{i&&await E(i),C.value.length===0&&C.value.push({id:"att-demo",fileName:"macro-demo.png",fileType:"image/png",sizeKb:128}),T.value=JSON.stringify(g.value),q.value=M.value,X.value=JSON.stringify(C.value)}catch{w.value="No se pudo cargar la informaci√≥n inicial."}finally{a.value=!1}}}async function E(c){var b,P,V,ee,te;a.value=!0,w.value=null;try{const _=await ve.getCaseByCode(c);if(B.value=Fs(_),j.value=Ts(_),S.value={id:_.CasoCode,type:"Caso",collectedAt:_.fecha_creacion||_.fecha_ingreso,status:_.estado,patientId:_.paciente.codigo},(b=_.paciente)!=null&&b.cedula)try{const ue=await ve.getCasesByPatient(_.paciente.cedula);O.value=ue.filter(I=>I.CasoCode!==_.CasoCode).map(I=>{var me,ge;return{_id:I._id||I.CasoCode,CasoCode:I.CasoCode,paciente:{nombre:((me=I.paciente)==null?void 0:me.nombre)||"",cedula:((ge=I.paciente)==null?void 0:ge.cedula)||""},estado:I.estado,fecha_ingreso:I.fecha_creacion||I.fecha_ingreso,patologo_asignado:I.patologo_asignado?{nombre:I.patologo_asignado.nombre}:void 0}})}catch{O.value=[]}else O.value=[];_.resultado&&(g.value={method:((P=_.resultado)==null?void 0:P.metodo)||"",macro:((V=_.resultado)==null?void 0:V.resultado_macro)||"",micro:((ee=_.resultado)==null?void 0:ee.resultado_micro)||"",diagnosis:((te=_.resultado)==null?void 0:te.diagnostico)||""},T.value=JSON.stringify(g.value))}catch(_){w.value=_.message||"No se pudo cargar el caso"}finally{a.value=!1}}function ae(c,b,P){C.value.push({id:Math.random().toString(36).slice(2),fileName:c,fileType:b,sizeKb:P})}function fe(c){C.value=C.value.filter(b=>b.id!==c)}async function ye(){var c;z.value=null,o.value=!0;try{if(!Q.value)return z.value=`Debe completar: ${L.value.join(", ")}`,!1;if(!((c=S.value)!=null&&c.id))throw new Error("No hay caso cargado");const b=t.value&&v.value?{id:v.value.id,codigo:v.value.codigo,nombre:v.value.nombre}:void 0,P=$.value&&y.value?{id:y.value.id,codigo:y.value.codigo,nombre:y.value.nombre}:void 0,V={metodo:g.value.method,resultado_macro:g.value.macro,resultado_micro:g.value.micro,diagnostico:g.value.diagnosis,observaciones:void 0,diagnostico_cie10:b,diagnostico_cieo:P};return await Bs.upsertResultado(S.value.id,V),W.value=new Date().toISOString(),ce(),!0}catch{return w.value="No se pudo guardar el borrador.",!1}finally{o.value=!1}}async function be(){if(!g.value.diagnosis.trim())return z.value="El diagn√≥stico no puede estar vac√≠o.",!1;d.value=!0;try{return!0}catch{return w.value="No se pudo finalizar el resultado.",!1}finally{d.value=!1}}async function _e(){m.value=!0;try{const c=we();K.value=await Ms(i,c),J.value=!0}finally{m.value=!1}}function xe(){J.value=!1}const he=R({get:()=>g.value[F.value],set:c=>{g.value[F.value]=c}});function we(){var P,V;const c=(ee,te)=>`
<h3 style="margin:16px 0 4px 0">${ee}</h3>
<div style="white-space:pre-wrap">${te}</div>`,b=[];return b.push('<h2 style="margin:0 0 8px 0">Informe de Resultado</h2>'),b.push(`<div><strong>Caso:</strong> ${(P=S.value)==null?void 0:P.id} (${(V=S.value)==null?void 0:V.type})</div>`),b.push("<hr/>"),g.value.method.trim()&&b.push(c("M√©todo",g.value.method)),g.value.macro.trim()&&b.push(c("Corte Macro",g.value.macro)),g.value.micro.trim()&&b.push(c("Corte Micro",g.value.micro)),g.value.diagnosis.trim()&&b.push(c("Diagn√≥stico",g.value.diagnosis)),b.join(`
`)}function Ie(){g.value={method:"",macro:"",micro:"",diagnosis:""},z.value=null,w.value=null}function ce(){g.value={method:"",macro:"",micro:"",diagnosis:""},F.value="method",z.value=null,w.value=null,p(),ie(),x.value=!1,T.value=JSON.stringify(g.value),q.value=M.value,S.value=null,B.value=null,j.value=null,O.value=[],typeof window<"u"&&window.dispatchEvent(new CustomEvent("clear-search")),setTimeout(()=>{const c=document.querySelector('[data-notification="success"], .notification-container, .notification')||document.querySelector(".mt-3[data-notification]")||document.querySelector(".bg-green-50, .bg-blue-50, .bg-yellow-50, .bg-red-50");c&&c.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},150)}function ke(c){y.value=c}function ie(){y.value=null}function $e(){x.value=!x.value,x.value||ie()}return{loading:a,saving:o,finalizing:d,previewing:m,sample:S,patient:B,caseDetails:j,previousCases:O,selectedTemplateId:M,selectedTemplate:Z,sampleSearchResults:Y,activeSection:F,sections:g,sectionContent:he,attachments:C,lastSavedAt:W,errorMessage:w,validationMessage:z,previewData:K,isPreviewOpen:J,canSave:Q,missingFields:L,initialize:oe,loadCaseByCode:E,addAttachment:ae,removeAttachment:fe,onSaveDraft:ye,onFinalize:be,onPreview:_e,closePreview:xe,onClear:Ie,clearAfterSuccess:ce,isDirty:H,primaryDisease:v,hasDisease:t,setPrimaryDisease:s,clearPrimaryDisease:p,clearDiagnosis:k,formatDiagnosisForReport:A,getDiagnosisData:D,validateDiagnosis:N,primaryDiseaseCIEO:y,hasDiseaseCIEO:$,showCIEODiagnosis:x,setPrimaryDiseaseCIEO:ke,clearPrimaryDiseaseCIEO:ie,toggleCIEODiagnosis:$e}}export{Ks as _,Qs as a,Xs as b,Ys as c,js as d,Bs as r,Zs as u};
