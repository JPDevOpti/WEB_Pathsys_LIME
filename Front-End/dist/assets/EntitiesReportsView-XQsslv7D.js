import{g as J,d as K,A as T,u as Q,b as X}from"./PathologistList.vue_vue_type_style_index_0_scoped_45f5ffeb_lang-FwbajLSj.js";import{b as g,e as m,h as e,d as D,c as _,j as A,u as k,w as S,t as u,f as h,D as ee,F,l as R,r as C,k as Y,T as te,g as H,q as se,i as L}from"./index-CAHFE_9E.js";import{C as I,_ as oe}from"./DiseaseList.vue_vue_type_style_index_0_scoped_2e8ef3ac_lang-CSxq79ax.js";/* empty css                                                                   */import{_ as ae}from"./AccessDeniedAlert.vue_vue_type_script_setup_true_lang-DQszwtgF.js";import{F as V}from"./FormSelect-Dz8sviG5.js";import{a as ne,_ as re}from"./ClearButton.vue_vue_type_script_setup_true_lang-iqMnWNPk.js";import{R as le}from"./RefreshIcon-CgqLp7N5.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={},de={width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ce($,r){return m(),g("svg",de,[...r[0]||(r[0]=[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7.33633 4.79297C6.39425 4.79297 5.63054 5.55668 5.63054 6.49876C5.63054 7.44084 6.39425 8.20454 7.33633 8.20454C8.27841 8.20454 9.04212 7.44084 9.04212 6.49876C9.04212 5.55668 8.27841 4.79297 7.33633 4.79297ZM4.13054 6.49876C4.13054 4.72825 5.56582 3.29297 7.33633 3.29297C9.10684 3.29297 10.5421 4.72825 10.5421 6.49876C10.5421 8.26926 9.10684 9.70454 7.33633 9.70454C5.56582 9.70454 4.13054 8.26926 4.13054 6.49876ZM4.24036 12.7602C3.61952 13.3265 3.28381 14.0575 3.10504 14.704C3.06902 14.8343 3.09994 14.9356 3.17904 15.0229C3.26864 15.1218 3.4319 15.2073 3.64159 15.2073H10.9411C11.1507 15.2073 11.314 15.1218 11.4036 15.0229C11.4827 14.9356 11.5136 14.8343 11.4776 14.704C11.2988 14.0575 10.9631 13.3265 10.3423 12.7602C9.73639 12.2075 8.7967 11.7541 7.29132 11.7541C5.78595 11.7541 4.84626 12.2075 4.24036 12.7602ZM3.22949 11.652C4.14157 10.82 5.4544 10.2541 7.29132 10.2541C9.12825 10.2541 10.4411 10.82 11.3532 11.652C12.2503 12.4703 12.698 13.4893 12.9234 14.3042C13.1054 14.9627 12.9158 15.5879 12.5152 16.03C12.1251 16.4605 11.5496 16.7073 10.9411 16.7073H3.64159C3.03301 16.7073 2.45751 16.4605 2.06745 16.03C1.66689 15.5879 1.47723 14.9627 1.65929 14.3042C1.88464 13.4893 2.33237 12.4703 3.22949 11.652ZM12.7529 9.70454C12.1654 9.70454 11.6148 9.54648 11.1412 9.27055C11.4358 8.86714 11.6676 8.4151 11.8226 7.92873C12.0902 8.10317 12.4097 8.20454 12.7529 8.20454C13.695 8.20454 14.4587 7.44084 14.4587 6.49876C14.4587 5.55668 13.695 4.79297 12.7529 4.79297C12.4097 4.79297 12.0901 4.89435 11.8226 5.0688C11.6676 4.58243 11.4357 4.13039 11.1412 3.72698C11.6147 3.45104 12.1654 3.29297 12.7529 3.29297C14.5235 3.29297 15.9587 4.72825 15.9587 6.49876C15.9587 8.26926 14.5235 9.70454 12.7529 9.70454ZM16.3577 16.7072H13.8902C14.1962 16.2705 14.4012 15.7579 14.4688 15.2072H16.3577C16.5674 15.2072 16.7307 15.1217 16.8203 15.0228C16.8994 14.9355 16.9303 14.8342 16.8943 14.704C16.7155 14.0574 16.3798 13.3264 15.759 12.7601C15.2556 12.301 14.5219 11.9104 13.425 11.7914C13.1434 11.3621 12.7952 10.9369 12.3641 10.5437C12.2642 10.4526 12.1611 10.3643 12.0548 10.2791C12.2648 10.2626 12.4824 10.2541 12.708 10.2541C14.5449 10.2541 15.8577 10.82 16.7698 11.6519C17.6669 12.4702 18.1147 13.4892 18.34 14.3042C18.5221 14.9626 18.3324 15.5879 17.9319 16.03C17.5418 16.4605 16.9663 16.7072 16.3577 16.7072Z",fill:"currentColor"},null,-1)])])}const ue=q(ie,[["render",ce]]),me={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4"},pe={class:"bg-yellow-50 p-4 rounded-md border border-yellow-100"},ge={class:"flex items-end justify-between"},xe={class:"text-2xl font-bold text-yellow-600"},fe={class:"bg-green-50 p-4 rounded-md border border-green-100"},ye={class:"flex items-end justify-between"},be={class:"text-2xl font-bold text-green-600"},ve={class:"text-sm text-green-500"},he={class:"bg-blue-50 p-4 rounded-md border border-blue-100"},_e={class:"flex items-end justify-between"},we={class:"text-2xl font-bold text-blue-600"},ke={class:"text-sm text-blue-500"},Ce={class:"bg-gray-50 p-4 rounded-md border border-gray-200"},$e={class:"flex items-end justify-between"},Ee={class:"text-2xl font-bold text-gray-700"},Me=D({__name:"EntitiesSummary",props:{datos:{},resumen:{}},setup($){const r=$,o=_(()=>{var a;return(a=r.resumen)!=null&&a.total?r.resumen.total:r.datos.reduce((s,b)=>s+b.total,0)}),l=_(()=>{var a;return(a=r.resumen)!=null&&a.ambulatorios?r.resumen.ambulatorios:r.datos.reduce((s,b)=>s+b.ambulatorios,0)}),n=_(()=>{var a;return(a=r.resumen)!=null&&a.hospitalizados?r.resumen.hospitalizados:r.datos.reduce((s,b)=>s+b.hospitalizados,0)}),i=_(()=>o.value===0?0:Math.round(l.value/o.value*100)),p=_(()=>o.value===0?0:Math.round(n.value/o.value*100)),c=_(()=>{var s;const a=((s=r.resumen)==null?void 0:s.tiempoPromedio)||0;return a===0?"0 días":`${a.toFixed(1)} días`});return(a,s)=>(m(),A(k(I),{title:"Resumen de Entidades"},{default:S(()=>[e("div",me,[e("div",pe,[s[1]||(s[1]=e("h4",{class:"text-sm font-semibold text-yellow-700 mb-1"},"Tiempo Promedio",-1)),e("div",ge,[e("span",xe,u(c.value),1),s[0]||(s[0]=e("span",{class:"text-sm text-yellow-500"},"por caso",-1))])]),e("div",fe,[s[2]||(s[2]=e("h4",{class:"text-sm font-semibold text-green-700 mb-1"},"Ambulatorios",-1)),e("div",ye,[e("span",be,u(l.value),1),e("span",ve,u(i.value)+"%",1)])]),e("div",he,[s[3]||(s[3]=e("h4",{class:"text-sm font-semibold text-blue-700 mb-1"},"Hospitalizados",-1)),e("div",_e,[e("span",we,u(n.value),1),e("span",ke,u(p.value)+"%",1)])]),e("div",Ce,[s[5]||(s[5]=e("h4",{class:"text-sm font-semibold text-gray-700 mb-1"},"Total Pacientes",-1)),e("div",$e,[e("span",Ee,u(o.value),1),s[4]||(s[4]=e("span",{class:"text-sm text-gray-500"},"100%",-1))])])])]),_:1}))}}),Se=D({__name:"EntitiesPerformanceChart",props:{datos:{}},setup($){const r=$,o=_(()=>[{name:"Ambulatorios",data:r.datos.map(n=>n.ambulatorios)},{name:"Hospitalizados",data:r.datos.map(n=>n.hospitalizados)}]),l=_(()=>({chart:{type:"bar",stacked:!0,toolbar:{show:!0,tools:{download:!1,selection:!1,zoom:!1,zoomin:!1,zoomout:!1,pan:!1,reset:!1}},fontFamily:"Inter, sans-serif",background:"#F9FAFB"},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4,dataLabels:{position:"top"}}},dataLabels:{enabled:!0,formatter:function(n,i){const p=i.dataPointIndex;if(i.seriesIndex===1){const c=o.value[0].data[p],a=o.value[1].data[p],s=c+a;return s>0?`${s}`:""}return""},style:{fontSize:"11px",fontWeight:"bold",colors:["#374151"]},offsetY:-18},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{categories:r.datos.map(n=>n.nombre),labels:{style:{fontSize:"12px",fontFamily:"Inter, sans-serif"}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{title:{text:"Pacientes",style:{fontSize:"12px",fontFamily:"Inter, sans-serif"}},labels:{style:{fontSize:"12px",fontFamily:"Inter, sans-serif"}}},fill:{opacity:1},tooltip:{y:{formatter:n=>`${n} pacientes`},theme:"light",style:{fontSize:"12px",fontFamily:"Inter, sans-serif"}},legend:{position:"top",horizontalAlign:"right",fontSize:"12px",fontFamily:"Inter, sans-serif",markers:{width:12,height:12,radius:12}},colors:["#22c55e","#3b82f6"],grid:{borderColor:"#E5E7EB",strokeDashArray:4,xaxis:{lines:{show:!1}}}}));return l.value.responsive=[{breakpoint:1280,options:{plotOptions:{bar:{columnWidth:"60%"}},legend:{position:"top"}}},{breakpoint:1024,options:{plotOptions:{bar:{columnWidth:"70%"}},legend:{position:"bottom"}}},{breakpoint:640,options:{plotOptions:{bar:{columnWidth:"80%"}},xaxis:{labels:{rotate:-45}},legend:{position:"bottom"}}}],(n,i)=>{const p=ee("apexchart");return m(),A(k(I),{title:"Distribución de Pacientes por Entidad",description:"Gráfico de barras apiladas mostrando ambulatorios y hospitalizados por entidad."},{default:S(()=>[h(p,{type:"bar",height:"320",options:l.value,series:o.value},null,8,["options","series"])]),_:1})}}}),ze={class:"overflow-x-auto -mx-4 sm:mx-0"},Ne={class:"min-w-full divide-y divide-gray-200"},Ae={class:"bg-white divide-y divide-gray-200"},De=["onClick"],je={class:"px-6 py-4 whitespace-nowrap"},Pe={class:"flex items-center space-x-2"},Ie={class:"text-sm font-medium text-gray-900"},Te={class:"px-6 py-4 whitespace-nowrap text-center"},Fe={class:"text-sm font-semibold text-green-600"},Re={class:"px-6 py-4 whitespace-nowrap text-center"},Le={class:"text-sm font-semibold text-blue-600"},Oe={class:"px-6 py-4 whitespace-nowrap text-center"},Be={class:"text-sm font-bold text-gray-900"},He={class:"bg-gray-50"},Ve={class:"px-6 py-4 text-center text-sm font-bold text-green-600"},Ye={class:"px-6 py-4 text-center text-sm font-bold text-blue-600"},qe={class:"px-6 py-4 text-center text-sm font-bold text-gray-900"},Ge=D({__name:"EntitiesDetailTable",props:{datos:{}},emits:["entity-click"],setup($,{emit:r}){const o=$,l=_(()=>o.datos.reduce((c,a)=>c+a.total,0)),n=_(()=>o.datos.reduce((c,a)=>c+a.ambulatorios,0)),i=_(()=>o.datos.reduce((c,a)=>c+a.hospitalizados,0)),p=_(()=>[...o.datos].sort((c,a)=>a.total-c.total));return(c,a)=>(m(),g("div",ze,[e("table",Ne,[a[2]||(a[2]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Entidad "),e("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Ambulatorios "),e("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Hospitalizados "),e("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Total ")])],-1)),e("tbody",Ae,[(m(!0),g(F,null,R(p.value,s=>(m(),g("tr",{key:s.nombre,class:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:b=>c.$emit("entity-click",s),title:"Clic para ver detalles"},[e("td",je,[e("div",Pe,[e("span",Ie,u(s.nombre),1),a[0]||(a[0]=e("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])]),e("td",Te,[e("span",Fe,u(s.ambulatorios.toLocaleString()),1)]),e("td",Re,[e("span",Le,u(s.hospitalizados.toLocaleString()),1)]),e("td",Oe,[e("span",Be,u(s.total.toLocaleString()),1)])],8,De))),128))]),e("tfoot",He,[e("tr",null,[a[1]||(a[1]=e("td",{class:"px-6 py-4 text-sm font-bold text-gray-900"},"Total",-1)),e("td",Ve,u(n.value.toLocaleString()),1),e("td",Ye,u(i.value.toLocaleString()),1),e("td",qe,u(l.value.toLocaleString()),1)])])])]))}});class Ue{async makeRequest(r,o={}){const l=K(r),n={headers:J(),...o};try{const i=await fetch(l,n);if(!i.ok){const p=await i.json().catch(()=>({}));throw new Error(p.detail||`HTTP error! status: ${i.status}`)}return await i.json()}catch(i){throw console.error(`Error en API request a ${r}:`,i),i}}async getMonthlyEntities(r,o,l){try{let n=`${T.ENDPOINTS.CASOS.ESTADISTICAS_ENTIDADES}?month=${r}&year=${o}`;l&&l.trim()&&(n+=`&entity=${encodeURIComponent(l.trim())}`);const i=await this.makeRequest(n);if(i.entities)return{entities:i.entities.map(c=>({nombre:c.nombre||"",codigo:c.codigo||"",ambulatorios:c.ambulatorios||0,hospitalizados:c.hospitalizados||0,total:c.total||0})),summary:i.summary||{total:0,ambulatorios:0,hospitalizados:0,tiempoPromedio:0}};throw new Error("Formato de respuesta inválido del servidor")}catch(n){throw console.error("Error al obtener estadísticas de entidades:",n),n}}async getEntityDetails(r,o,l){var n,i,p,c,a,s,b,d,t;try{const w=`${T.ENDPOINTS.CASOS.DETALLE_ENTIDAD}?entidad=${encodeURIComponent(r)}&month=${o}&year=${l}`;console.log("🔗 Llamando endpoint:",w);const z=await this.makeRequest(w);if(console.log("📡 Respuesta raw del backend:",z),z.detalles){const v=z.detalles;console.log("🔍 Detalles extraídos:",v);const f={estadisticas_basicas:{total_pacientes:((n=v.estadisticas_basicas)==null?void 0:n.total_pacientes)||0,ambulatorios:((i=v.estadisticas_basicas)==null?void 0:i.ambulatorios)||0,hospitalizados:((p=v.estadisticas_basicas)==null?void 0:p.hospitalizados)||0,promedio_muestras_por_paciente:((c=v.estadisticas_basicas)==null?void 0:c.promedio_muestras_por_paciente)||0},tiempos_procesamiento:{promedio_dias:((a=v.tiempos_procesamiento)==null?void 0:a.promedio_dias)||0,minimo_dias:((s=v.tiempos_procesamiento)==null?void 0:s.minimo_dias)||0,maximo_dias:((b=v.tiempos_procesamiento)==null?void 0:b.maximo_dias)||0,muestras_completadas:((d=v.tiempos_procesamiento)==null?void 0:d.muestras_completadas)||0},pruebas_mas_solicitadas:((t=v.pruebas_mas_solicitadas)==null?void 0:t.map(N=>({codigo:N.codigo||"",nombre:N.nombre||N.codigo||"",total_solicitudes:N.total_solicitudes||0})))||[]};return console.log("✅ Resultado transformado:",f),f}else throw console.error('❌ No se encontró la propiedad "detalles" en la respuesta'),new Error("Formato de respuesta inválido del servidor")}catch(w){throw console.error("❌ Error al obtener detalles de entidad:",w),w}}async getPathologistsByEntity(r,o,l){try{const n=`${T.ENDPOINTS.CASOS.PATOLOGOS_POR_ENTIDAD}?entidad=${encodeURIComponent(r)}&month=${o}&year=${l}`;console.log("🔗 Llamando endpoint patólogos:",n);const i=await this.makeRequest(n);if(console.log("📡 Respuesta raw patólogos:",i),i.patologos){const p={patologos:i.patologos.map(c=>({name:c.name||"",codigo:c.codigo||"",casesCount:c.casesCount||0}))};return console.log("✅ Patólogos transformados:",p),p}else return console.warn('⚠️ No se encontró la propiedad "patologos" en la respuesta'),{patologos:[]}}catch(n){return console.error("❌ Error al obtener patólogos por entidad:",n),{patologos:[]}}}async checkBackendConnection(){try{return(await this.makeRequest(T.ENDPOINTS.CASOS.TEST)).message==="Casos router funcionando correctamente"}catch(r){return console.error("Error de conectividad con el backend:",r),!1}}}const O=new Ue,Ze={class:"relative bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto overflow-x-hidden mt-4 sm:mt-10 md:mt-16 mx-4 sm:mx-0"},We={class:"sticky top-0 z-10 bg-white border-b border-gray-200 px-4 sm:px-6 py-3 sm:py-4 rounded-t-2xl flex items-center justify-between"},Je={class:"text-sm text-gray-500 mt-1"},Ke={class:"p-4 sm:p-6 space-y-4 sm:space-y-6"},Qe={class:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-100"},Xe={class:"flex items-center space-x-4"},et={class:"text-2xl font-bold text-gray-900"},tt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},st={class:"bg-green-50 border border-green-200 rounded-xl p-4"},ot={class:"flex items-center justify-between"},at={class:"text-2xl font-bold text-green-700"},nt={class:"bg-blue-50 border border-blue-200 rounded-xl p-4"},rt={class:"flex items-center justify-between"},lt={class:"text-2xl font-bold text-blue-700"},it={class:"bg-gray-50 border border-gray-200 rounded-xl p-4"},dt={class:"flex items-center justify-between"},ct={class:"text-2xl font-bold text-gray-700"},ut={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center"},mt={class:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6"},pt={key:0,class:"lg:col-span-2"},gt={class:"bg-yellow-50 border border-yellow-200 rounded-xl p-6 text-center"},xt={class:"text-yellow-700 mb-4"},ft={class:"bg-gray-50 rounded-xl p-6 space-y-4"},yt={key:0,class:"flex items-center justify-center py-8"},bt={key:1,class:"text-center py-8 text-gray-500"},vt={key:2,class:"text-center py-8 text-gray-500"},ht={class:"text-sm text-gray-400 mt-1"},_t={key:3,class:"space-y-3"},wt={class:"flex items-center justify-between"},kt={class:"flex items-center space-x-3"},Ct={class:"text-sm font-medium text-gray-900"},$t={class:"text-xs text-gray-500"},Et={class:"text-right"},Mt={class:"text-lg font-bold text-blue-600"},St={class:"bg-gray-50 rounded-xl p-6 space-y-4"},zt={key:0,class:"flex items-center justify-center py-8"},Nt={key:1,class:"text-center py-8 text-gray-500"},At={class:"text-sm text-gray-400 mt-1"},Dt={key:2,class:"space-y-3"},jt={class:"flex items-center justify-between"},Pt={class:"flex items-center space-x-3"},It={class:"text-sm font-medium text-gray-900"},Tt={class:"text-xs text-gray-500"},Ft={class:"text-right"},Rt={class:"text-lg font-bold text-green-600"},Lt={class:"sticky bottom-0 bg-white border-t border-gray-200 px-4 sm:px-6 py-3 sm:py-4 rounded-b-2xl flex justify-end"},Ot=D({__name:"EntityDetailsModal",props:{entity:{},period:{}},emits:["close"],setup($,{emit:r}){const o=$,l=C(null),n=C([]),i=C(!1),p=C(!1);Y(()=>o.entity,async d=>{d?c():(l.value=null,n.value=[])},{immediate:!0});async function c(){if(o.entity){console.log("🔍 Cargando detalles para entidad:",o.entity.nombre,"código:",o.entity.codigo),console.log("📅 Período:",o.period),p.value=!0;try{const d=await O.getEntityDetails(o.entity.codigo,o.period.month,o.period.year);console.log("✅ Respuesta del backend (detalles):",d),l.value=d,await a()}catch(d){console.error("❌ Error al cargar detalles:",d),console.error("❌ Detalles del error:",{message:d.message,stack:d.stack,entity:o.entity.nombre,codigo:o.entity.codigo,period:o.period}),l.value=null}finally{p.value=!1}}}async function a(){var d;if(o.entity){console.log("👨‍⚕️ Cargando patólogos para entidad:",o.entity.nombre,"código:",o.entity.codigo),i.value=!0;try{const t=await O.getPathologistsByEntity(o.entity.codigo,o.period.month,o.period.year);console.log("✅ Respuesta del backend (patólogos):",t),n.value=((d=t.patologos)==null?void 0:d.map(w=>({name:w.name,codigo:w.codigo,casesCount:w.casesCount})))||[],console.log("📊 Patólogos procesados:",n.value)}catch(t){console.error("❌ Error cargando patólogos:",t),console.error("❌ Detalles del error:",{message:t.message,stack:t.stack,entity:o.entity.nombre,codigo:o.entity.codigo,period:o.period}),n.value=[]}finally{i.value=!1}}}function s(){return`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][o.period.month-1]} ${o.period.year}`}function b(){if(!l.value)return!1;const d=l.value.estadisticas_basicas;return d.total_pacientes>0||d.ambulatorios>0||d.hospitalizados>0||l.value.pruebas_mas_solicitadas&&l.value.pruebas_mas_solicitadas.length>0||n.value.length>0}return(d,t)=>(m(),A(te,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"opacity-0 transform scale-95","enter-to-class":"opacity-100 transform scale-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"opacity-100 transform scale-100","leave-to-class":"opacity-0 transform scale-95"},{default:S(()=>{var w,z,v;return[d.entity?(m(),g("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:t[2]||(t[2]=se(f=>d.$emit("close"),["self"]))},[e("div",Ze,[e("div",We,[e("div",null,[t[3]||(t[3]=e("h3",{class:"text-xl font-semibold text-gray-900"},"Detalles de la Entidad",-1)),e("p",Je,"Período: "+u(s()),1)]),e("button",{onClick:t[0]||(t[0]=f=>d.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors"},[...t[4]||(t[4]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Ke,[e("div",Qe,[e("div",Xe,[t[6]||(t[6]=e("div",{class:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})])],-1)),e("div",null,[e("h4",et,u(d.entity.nombre),1),t[5]||(t[5]=e("p",{class:"text-blue-600 font-medium"},"Entidad",-1))])])]),e("div",tt,[e("div",st,[e("div",ot,[e("div",null,[t[7]||(t[7]=e("p",{class:"text-sm text-green-600 font-medium"},"Ambulatorios",-1)),e("p",at,u(d.entity.ambulatorios),1),t[8]||(t[8]=e("p",{class:"text-xs text-green-600"},"pacientes",-1))]),t[9]||(t[9]=e("div",{class:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",nt,[e("div",rt,[e("div",null,[t[10]||(t[10]=e("p",{class:"text-sm text-blue-600 font-medium"},"Hospitalizados",-1)),e("p",lt,u(d.entity.hospitalizados),1),t[11]||(t[11]=e("p",{class:"text-xs text-blue-600"},"pacientes",-1))]),t[12]||(t[12]=e("div",{class:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})])],-1))])]),e("div",it,[e("div",dt,[e("div",null,[t[13]||(t[13]=e("p",{class:"text-sm text-gray-600 font-medium"},"Total",-1)),e("p",ct,u(d.entity.total),1),t[14]||(t[14]=e("p",{class:"text-xs text-gray-600"},"pacientes",-1))]),e("div",ut,[h(k(ue),{class:"w-6 h-6 text-gray-600"})])])])]),e("div",mt,[!p.value&&!i.value&&!b()?(m(),g("div",pt,[e("div",gt,[t[16]||(t[16]=e("svg",{class:"w-12 h-12 mx-auto text-yellow-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),t[17]||(t[17]=e("h5",{class:"text-lg font-semibold text-yellow-800 mb-2"},"No hay datos disponibles",-1)),e("p",xt,[t[15]||(t[15]=L("No se encontraron datos para la entidad ",-1)),e("strong",null,u(d.entity.nombre),1),L(" en "+u(s())+".",1)]),t[18]||(t[18]=e("div",{class:"text-sm text-yellow-600"},[e("p",null,"Sugerencias:"),e("ul",{class:"mt-2 space-y-1"},[e("li",null,"• Verifica que la entidad tenga casos registrados"),e("li",null,"• Intenta con un período diferente"),e("li",null,"• Asegúrate de que los datos estén cargados en el sistema")])],-1))])])):(m(),g(F,{key:1},[e("div",ft,[t[25]||(t[25]=e("h5",{class:"text-lg font-semibold text-gray-900"},"Pruebas más solicitadas",-1)),p.value?(m(),g("div",yt,[...t[19]||(t[19]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),e("span",{class:"ml-2 text-gray-600"},"Cargando pruebas...",-1)])])):l.value?((z=(w=l.value)==null?void 0:w.pruebas_mas_solicitadas)==null?void 0:z.length)===0?(m(),g("div",vt,[t[21]||(t[21]=e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})],-1)),t[22]||(t[22]=e("p",{class:"font-medium text-gray-600"},"No se encontraron pruebas",-1)),e("p",ht,"No hay datos de pruebas para "+u(s()),1)])):(v=l.value)!=null&&v.pruebas_mas_solicitadas?(m(),g("div",_t,[(m(!0),g(F,null,R(l.value.pruebas_mas_solicitadas,f=>(m(),g("div",{key:f.codigo,class:"bg-white rounded-lg p-4 border border-gray-200"},[e("div",wt,[e("div",kt,[t[23]||(t[23]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})])],-1)),e("div",null,[e("h6",Ct,u(f.nombre||f.codigo),1),e("p",$t,u(f.codigo),1)])]),e("div",Et,[e("div",Mt,u(f.total_solicitudes),1),t[24]||(t[24]=e("div",{class:"text-xs text-gray-500"},"solicitudes",-1))])])]))),128))])):H("",!0):(m(),g("div",bt,[...t[20]||(t[20]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})],-1),e("p",{class:"font-medium text-gray-600"},"No se pudieron cargar los datos",-1),e("p",{class:"text-sm text-gray-400 mt-1"},"Error al obtener detalles de la entidad",-1)])]))]),e("div",St,[t[31]||(t[31]=e("h5",{class:"text-lg font-semibold text-gray-900"},"Patólogos",-1)),i.value?(m(),g("div",zt,[...t[26]||(t[26]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"},null,-1),e("span",{class:"ml-2 text-gray-600"},"Cargando patólogos...",-1)])])):n.value.length===0?(m(),g("div",Nt,[t[27]||(t[27]=e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),t[28]||(t[28]=e("p",{class:"font-medium text-gray-600"},"No se encontraron patólogos",-1)),e("p",At,"No hay datos de patólogos para "+u(s()),1)])):(m(),g("div",Dt,[(m(!0),g(F,null,R(n.value,f=>(m(),g("div",{key:f.name,class:"bg-white rounded-lg p-4 border border-gray-200"},[e("div",jt,[e("div",Pt,[t[29]||(t[29]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])],-1)),e("div",null,[e("h6",It,u(f.name),1),e("p",Tt,u(f.codigo),1)])]),e("div",Ft,[e("div",Rt,u(f.casesCount),1),t[30]||(t[30]=e("div",{class:"text-xs text-gray-500"},"casos",-1))])])]))),128))]))])],64))])]),e("div",Lt,[e("button",{onClick:t[1]||(t[1]=f=>d.$emit("close")),class:"inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-200 transition-colors"}," Cerrar ")])])])):H("",!0)]}),_:1}))}}),Bt=q(Ot,[["__scopeId","data-v-2f56d7d9"]]),Ht={class:"space-y-6"},Vt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"},Yt={class:"flex items-end gap-2"},qt={key:1,class:"space-y-4"},Gt={class:"px-2"},Ut={class:"text-xl font-bold text-brand-700"},Zt={key:0,class:"text-gray-500"},Wt={key:1},Jt=D({__name:"EntitiesReport",setup($){const r=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],o=new Date,l=o.getFullYear(),n=Array.from({length:5},(x,y)=>l-y),i=o.getMonth(),p=(i+11)%12,c=i===0?l-1:l,a=C(String(p)),s=C(String(c)),b=C(!1),d=C(!1),t=C(null),w=_(()=>{const x=new Date,y=x.getFullYear(),E=x.getMonth();return r.map((M,P)=>Number(s.value)===y&&P>=E?null:{value:String(P),label:M}).filter(M=>M!==null)}),z=_(()=>n.map(x=>({value:String(x),label:String(x)}))),v=_(()=>{const x=Number(a.value);return Number.isFinite(x)&&r[x]?r[x]:""});Y(s,x=>{const y=new Date,E=y.getFullYear(),M=y.getMonth();if(Number(x)===E&&Number(a.value)>=M){const W=(M+11)%12;a.value=String(W)}});const f=async()=>{if(!a.value||!s.value)return;const x=new Date,y=x.getFullYear(),E=x.getMonth(),M=Number(s.value),P=Number(a.value);if(M>y||M===y&&P>=E){console.warn("No se puede generar reporte para un mes futuro");return}b.value=!0;try{await G(),d.value=!0}finally{b.value=!1}},N=()=>{a.value="",s.value="",d.value=!1},j=C([]),B=C(null);async function G(){const x=await O.getMonthlyEntities(Number(a.value)+1,Number(s.value));j.value=x.entities,B.value=x.summary}function U(x){t.value=x}function Z(){t.value=null}return(x,y)=>(m(),g("div",Ht,[h(k(I),{title:"Reporte de entidades",description:"Seleccione mes y año para generar el informe."},{default:S(()=>[e("div",Vt,[h(k(V),{modelValue:a.value,"onUpdate:modelValue":y[0]||(y[0]=E=>a.value=E),label:"Mes",options:w.value,placeholder:"Seleccione mes"},null,8,["modelValue","options"]),h(k(V),{modelValue:s.value,"onUpdate:modelValue":y[1]||(y[1]=E=>s.value=E),label:"Año",options:z.value,placeholder:"Seleccione año"},null,8,["modelValue","options"]),e("div",Yt,[h(k(ne),{loading:b.value,disabled:!a.value||!s.value,text:b.value?"Generando...":"Generar Informe",onClick:f},null,8,["loading","disabled","text"]),h(k(re),{onClick:N},{icon:S(()=>[h(k(le),{class:"w-4 h-4 mr-2"})]),default:S(()=>[y[2]||(y[2]=L(" Limpiar ",-1))]),_:1})])])]),_:1}),d.value?(m(),g("div",qt,[e("div",Gt,[e("h2",Ut,"Reporte de Entidades - "+u(v.value)+" "+u(s.value),1)]),h(Me,{datos:j.value,resumen:B.value},null,8,["datos","resumen"]),h(Se,{datos:j.value},null,8,["datos"]),h(k(I),{title:"Detalle por Entidad",description:"Tabla con métricas detalladas. Haz clic en una fila para ver detalles completos."},{default:S(()=>[j.value.length===0?(m(),g("div",Zt,"No hay entidades con datos para el período seleccionado.")):(m(),g("div",Wt,[h(Ge,{datos:j.value,onEntityClick:U},null,8,["datos"])]))]),_:1})])):(m(),A(k(I),{key:0,title:"Vista previa",description:"Selecciona un período y genera el informe."},{default:S(()=>[...y[3]||(y[3]=[e("div",{class:"text-gray-600"},'Aún no se ha generado el informe. Selecciona mes y año y presiona "Generar Informe".',-1)])]),_:1})),h(Bt,{entity:t.value,period:{month:Number(a.value)+1,year:Number(s.value)},onClose:Z},null,8,["entity","period"])]))}}),Kt={class:"p-6"},Qt={key:1,class:"space-y-6"},is=D({__name:"EntitiesReportsView",setup($){const r=C("Reportes de Entidades"),{canAccessStatistics:o}=Q();return(l,n)=>(m(),A(k(X),null,{default:S(()=>[h(k(oe),{pageTitle:r.value},null,8,["pageTitle"]),e("div",Kt,[k(o)?(m(),g("div",Qt,[h(Jt)])):(m(),A(ae,{key:0}))])]),_:1}))}});export{is as default};
