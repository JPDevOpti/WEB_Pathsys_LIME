import{b as Ke}from"./PathologistList.vue_vue_type_style_index_0_scoped_45f5ffeb_lang-FwbajLSj.js";import{d as Me,c as Qe,o as Ge,a as He,j as m,w as c,u as a,e as p,f as r,h as l,b as We,t as Xe,i as Ye,E as Ze,F as et,p as tt}from"./index-CAHFE_9E.js";import{_ as at}from"./DiseaseList.vue_vue_type_style_index_0_scoped_2e8ef3ac_lang-CSxq79ax.js";import{_ as Se}from"./ActionButton.vue_vue_type_script_setup_true_lang-BQdFEsew.js";import{u as ot,_ as st,a as it,b as nt,C as rt,c as lt,d as dt}from"./useExcelExport-BNuF078Y.js";/* empty css                                                                   */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SearchButton.vue_vue_type_script_setup_true_lang-y2wCoroa.js";import"./FormSelect-Dz8sviG5.js";import"./PathologistList-CbsQJHAr.js";import"./casesApi.service-DwGpQD03.js";import"./EntityList-gIDUOf46.js";import"./TestList-BA4OK-D1.js";import"./RefreshIcon-CgqLp7N5.js";import"./FormCheckbox.vue_vue_type_script_setup_true_lang-DxUtxK1N.js";import"./html2pdf-I8xnP9zX.js";import"./PreviewButton.vue_vue_type_script_setup_true_lang-CTpBWkFw.js";import"./cases.store-BuW2t6qD.js";const ct={class:"space-y-4"},pt={class:"p-8 text-center"},ut={class:"p-8 text-center"},mt={class:"text-red-600 mb-4"},gt={class:"bg-white rounded-xl border border-gray-200"},_t="Casos Actuales",Ft=Me({__name:"CurrentCasesListView",setup(ft){const{cases:ke,isLoading:g,error:_,filters:o,sortKey:De,sortOrder:Ee,currentPage:u,itemsPerPage:f,selectedCaseIds:v,selectedCase:Pe,filteredCases:d,paginatedCases:$e,totalPages:Ne,isAllSelected:Te,loadCases:y,toggleSelectAll:Ie,toggleSelect:Ve,sortBy:Fe,showDetails:Le,closeDetails:ze,validateCase:Be}=ot(),{exportCasesToExcel:Oe}=dt(),b=tt(),Re=[{key:"caseCode",label:"Código Caso",class:"w-[12%]"},{key:"patient",label:"Paciente",class:"w-[18%]"},{key:"entity",label:"Entidad / Patólogo",class:"w-[20%]"},{key:"tests",label:"Pruebas",class:"w-[15%]"},{key:"status",label:"Estado",class:"w-[10%]"},{key:"receivedAt",label:"Fecha creación",class:"w-[10%]"},{key:"deliveredAt",label:"Fecha entrega",class:"w-[10%]"},{key:"actions",label:"Acciones",class:"w-[10%]"}],qe=Qe(()=>!!(o.value.searchQuery||o.value.searchPathologist||o.value.dateFrom||o.value.dateTo||o.value.selectedEntity||o.value.selectedStatus||o.value.selectedTest));function C(){y()}function Ue(){Oe(d.value)}function je(e){}function h(e){const t=(e==null?void 0:e.caseCode)||(e==null?void 0:e.id)||"";t&&b.push({name:"cases-edit-with-code",params:{code:t},query:{auto:"1"}})}const A=e=>{y()};Ge(()=>{window.addEventListener("case-created",A)}),He(()=>{window.removeEventListener("case-created",A)});function Je(e){var w,x,S,k,D,E,P,$,N,T,I,V,F,L,z,B,O,R,q,U,j,J,K,M,Q,G,H,W,X,Y,Z,ee,te,ae,oe,se,ie,ne,re,le,de,ce,pe,ue,me,ge,_e,fe,ve,ye,be,Ce,he,Ae,we,xe;const t={sampleId:e.caseCode||e.CasoCode||e.id,patient:{document:((w=e.patient)==null?void 0:w.dni)||((x=e.paciente)==null?void 0:x.cedula)||"",fullName:((S=e.patient)==null?void 0:S.fullName)||((k=e.paciente)==null?void 0:k.nombre)||"",age:((D=e.patient)==null?void 0:D.age)||((E=e.paciente)==null?void 0:E.edad)||"",gender:((P=e.patient)==null?void 0:P.sex)||(($=e.paciente)==null?void 0:$.sexo)||"",entity:((N=e.patient)==null?void 0:N.entity)||((I=(T=e.paciente)==null?void 0:T.entidad_info)==null?void 0:I.nombre)||""},caseDetails:{CasoCode:e.caseCode||e.CasoCode||e.id||"",fecha_creacion:e.receivedAt||e.fecha_creacion||"",fecha_entrega:e.deliveredAt||e.fecha_entrega||"",patologo_asignado:e.pathologist?{nombre:e.pathologist}:e.patologo_asignado||void 0,medico_solicitante:e.requester?{nombre:e.requester}:e.medico_solicitante||void 0,entidad_info:(V=e.patient)!=null&&V.entity?{nombre:e.patient.entity}:((F=e.paciente)==null?void 0:F.entidad_info)||void 0,muestras:Array.isArray(e.subsamples)?e.subsamples.map(i=>({region_cuerpo:i.bodyRegion,pruebas:Array.isArray(i.tests)?i.tests.map(n=>({id:n.id,nombre:n.name||n.id})):[]})):Array.isArray(e.muestras)?e.muestras.map(i=>({region_cuerpo:i.region_cuerpo,pruebas:Array.isArray(i.pruebas)?i.pruebas.map(n=>({id:n.id,nombre:n.nombre||n.id})):[]})):[]},sections:{method:((L=e.result)==null?void 0:L.method)||((z=e.resultado)==null?void 0:z.metodo)||"",macro:((B=e.result)==null?void 0:B.macro)||((O=e.resultado)==null?void 0:O.resultado_macro)||"",micro:((R=e.result)==null?void 0:R.micro)||((q=e.resultado)==null?void 0:q.resultado_micro)||"",diagnosis:((U=e.result)==null?void 0:U.diagnosis)||((j=e.resultado)==null?void 0:j.diagnostico)||""},diagnosis:{cie10:(J=e.result)!=null&&J.diagnostico_cie10?{primary:e.result.diagnostico_cie10,formatted:(K=e.result.diagnostico_cie10)!=null&&K.codigo&&((M=e.result.diagnostico_cie10)!=null&&M.nombre)?`${e.result.diagnostico_cie10.codigo} - ${e.result.diagnostico_cie10.nombre}`:""}:void 0,cieo:(Q=e.result)!=null&&Q.diagnostico_cieo?{primary:e.result.diagnostico_cieo,formatted:(G=e.result.diagnostico_cieo)!=null&&G.codigo&&((H=e.result.diagnostico_cieo)!=null&&H.nombre)?`${e.result.diagnostico_cieo.codigo} - ${e.result.diagnostico_cieo.nombre}`:""}:void 0,formatted:(X=(W=e.result)==null?void 0:W.diagnostico_cie10)!=null&&X.codigo&&((Z=(Y=e.result)==null?void 0:Y.diagnostico_cie10)!=null&&Z.nombre)?`${e.result.diagnostico_cie10.codigo} - ${e.result.diagnostico_cie10.nombre}`:((ee=e.result)==null?void 0:ee.diagnosis)||((te=e.resultado)==null?void 0:te.diagnostico)||""},generatedAt:new Date().toISOString()},s={sampleId:t.sampleId,patient:{document:t.patient.document,fullName:t.patient.fullName,age:t.patient.age,gender:t.patient.gender,entity:t.patient.entity},caseDetails:{CasoCode:t.caseDetails.CasoCode,fecha_creacion:t.caseDetails.fecha_creacion,fecha_entrega:t.caseDetails.fecha_entrega,patologo_asignado:t.caseDetails.patologo_asignado,medico_solicitante:t.caseDetails.medico_solicitante,entidad_info:t.caseDetails.entidad_info,muestras:t.caseDetails.muestras,paciente:{codigo:((ae=e.patient)==null?void 0:ae.id)||((oe=e.paciente)==null?void 0:oe.codigo)||"",nombre:((se=e.patient)==null?void 0:se.fullName)||((ie=e.paciente)==null?void 0:ie.nombre)||"",edad:((ne=e.patient)==null?void 0:ne.age)||((re=e.paciente)==null?void 0:re.edad)||0,sexo:((le=e.patient)==null?void 0:le.sex)||((de=e.paciente)==null?void 0:de.sexo)||"",entidad_info:(ce=e.patient)!=null&&ce.entity?{codigo:((ue=(pe=e.paciente)==null?void 0:pe.entidad_info)==null?void 0:ue.codigo)||"",nombre:e.patient.entity}:((me=e.paciente)==null?void 0:me.entidad_info)||void 0,tipo_atencion:((ge=e.patient)==null?void 0:ge.attentionType)||((_e=e.paciente)==null?void 0:_e.tipo_atencion)||"",cedula:((fe=e.patient)==null?void 0:fe.dni)||((ve=e.paciente)==null?void 0:ve.cedula)||"",observaciones:((ye=e.patient)==null?void 0:ye.notes)||((be=e.paciente)==null?void 0:be.observaciones)||"",fecha_actualizacion:((Ce=e.patient)==null?void 0:Ce.updatedAt)||((he=e.paciente)==null?void 0:he.fecha_actualizacion)||new Date().toISOString()},servicio:e.servicio||((Ae=e.paciente)==null?void 0:Ae.servicio)||void 0,estado:e.status||e.estado||"",fecha_ingreso:e.receivedAt||e.fecha_creacion||"",fecha_firma:e.deliveredAt||e.fecha_entrega||null,fecha_actualizacion:((we=e.patient)==null?void 0:we.updatedAt)||((xe=e.paciente)==null?void 0:xe.fecha_actualizacion)||new Date().toISOString(),observaciones_generales:e.notes||e.observaciones_generales||"",is_active:e.is_active??!0,actualizado_por:e.actualizado_por||"sistema"},sections:t.sections,diagnosis:t.diagnosis,generatedAt:t.generatedAt};try{sessionStorage.setItem("results_preview_payload",JSON.stringify(s))}catch{}b.push({name:"results-preview"})}return(e,t)=>(p(),m(a(Ke),null,{default:c(()=>[r(at,{pageTitle:_t}),l("div",ct,[a(g)?(p(),m(Se,{key:0},{default:c(()=>[l("div",pt,[r(st)])]),_:1})):a(_)?(p(),m(Se,{key:1},{default:c(()=>[l("div",ut,[l("p",mt,Xe(a(_)),1),r(a(it),{size:"sm",variant:"primary",onClick:C},{default:c(()=>[...t[6]||(t[6]=[Ye("Reintentar",-1)])]),_:1})])]),_:1})):(p(),We(et,{key:2},[r(nt,{modelValue:a(o),"onUpdate:modelValue":t[0]||(t[0]=s=>Ze(o)?o.value=s:null),totalFiltered:a(d).length,totalAll:a(ke).length,isLoading:a(g),canExport:a(d).length>0,onRefresh:C,onExport:Ue},null,8,["modelValue","totalFiltered","totalAll","isLoading","canExport"]),l("div",gt,[r(rt,{cases:a($e),"selected-ids":a(v),"is-all-selected":a(Te),columns:Re,"sort-key":a(De),"sort-order":a(Ee),"current-page":a(u),"total-pages":a(Ne),"items-per-page":a(f),"total-items":a(d).length,"no-results-message":qe.value?"No se encontraron casos con los filtros aplicados":"No hay casos disponibles",onToggleSelect:a(Ve),onToggleSelectAll:a(Ie),onClearSelection:t[1]||(t[1]=s=>v.value=[]),onSort:t[2]||(t[2]=s=>a(Fe)(s)),onShowDetails:a(Le),onEdit:h,onValidate:a(Be),onPerform:je,onUpdateItemsPerPage:t[3]||(t[3]=s=>f.value=s),onPrevPage:t[4]||(t[4]=()=>u.value--),onNextPage:t[5]||(t[5]=()=>u.value++)},null,8,["cases","selected-ids","is-all-selected","sort-key","sort-order","current-page","total-pages","items-per-page","total-items","no-results-message","onToggleSelect","onToggleSelectAll","onShowDetails","onValidate"])]),r(lt,{"case-item":a(Pe),onClose:a(ze),onEdit:h,onPreview:Je},null,8,["case-item","onClose"])],64))])]),_:1}))}});export{Ft as default};
