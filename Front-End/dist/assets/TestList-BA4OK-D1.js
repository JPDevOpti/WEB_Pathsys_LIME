var U=Object.defineProperty;var K=(g,s,t)=>s in g?U(g,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[s]=t;var I=(g,s,t)=>K(g,typeof s!="symbol"?s+"":s,t);import{r as x,d as J,c as A,k as E,o as G,b as c,e as d,g as h,h as i,i as H,t as w,y as Q,z as W,n as M,u as P,F as X,l as Y,v as Z}from"./index-CAHFE_9E.js";import{A as ee,a as B}from"./PathologistList.vue_vue_type_style_index_0_scoped_45f5ffeb_lang-FwbajLSj.js";import"./DiseaseList.vue_vue_type_style_index_0_scoped_2e8ef3ac_lang-CSxq79ax.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";class se{constructor(){I(this,"endpoint",ee.ENDPOINTS.TESTS)}async getTests(s={}){const t=new URLSearchParams;return s.query&&t.append("query",s.query),s.activo!==void 0&&t.append("activo",s.activo.toString()),s.skip!==void 0&&t.append("skip",s.skip.toString()),s.limit!==void 0&&t.append("limit",s.limit.toString()),(await B.get(`${this.endpoint}/?${t.toString()}`)).data}async getAllActiveTests(){try{const s=await B.get(`${this.endpoint}/?activo=true&limit=1000`);return s&&Array.isArray(s.pruebas)?s.pruebas:Array.isArray(s)?s:[]}catch(s){return console.error("游눤 Error detallado en getAllActiveTests:",s),[]}}async getTestByCode(s){const t=await B.get(`${this.endpoint}/${s}/`);return t&&(t.pruebaCode||t.pruebasName)?t:(t==null?void 0:t.data)||t}async searchTests(s,t=50){try{const l=await B.get(`${this.endpoint}/?query=${encodeURIComponent(s)}&activo=true&limit=${t}`);if(!l)throw new Error("La respuesta del servidor est치 vac칤a");if(Array.isArray(l))return l;if(l.pruebas&&Array.isArray(l.pruebas))return l.pruebas;const k=Object.keys(l);for(const _ of k)if(Array.isArray(l[_]))return l[_];throw new Error(`Formato de respuesta inesperado en b칰squeda: ${JSON.stringify(l)}`)}catch(l){throw console.error("游눤 Error detallado en searchTests:",l),l}}}const N=new se;function re(){const g=x([]),s=x(!1),t=x("");return{tests:g,isLoading:s,error:t,loadTests:async()=>{var f,n,o,a,v,m,y,T;s.value=!0,t.value="";try{const u=await N.getAllActiveTests();return g.value=u,{success:!0,tests:u,message:"Pruebas cargadas exitosamente"}}catch(u){let b="Error al cargar pruebas";return console.error("Error completo al cargar pruebas:",{error:u,response:u.response,status:(f=u.response)==null?void 0:f.status,statusText:(n=u.response)==null?void 0:n.statusText,data:(o=u.response)==null?void 0:o.data,message:u.message}),((a=u.response)==null?void 0:a.status)===307?b="Error de redirecci칩n en el servidor. Verificar configuraci칩n de endpoints.":(m=(v=u.response)==null?void 0:v.data)!=null&&m.detail?b=`Error de validaci칩n: ${JSON.stringify(u.response.data.detail)}`:(T=(y=u.response)==null?void 0:y.data)!=null&&T.message?b=u.response.data.message:u.message&&(b=u.message),t.value=b,{success:!1,error:b}}finally{s.value=!1}},searchTests:async(f,n=50)=>{var o,a;s.value=!0,t.value="";try{return{success:!0,tests:await N.searchTests(f,n),message:"B칰squeda completada"}}catch(v){const m=((a=(o=v.response)==null?void 0:o.data)==null?void 0:a.message)||v.message||"Error en la b칰squeda";return t.value=m,console.error("Error al buscar pruebas:",v),{success:!1,error:m}}finally{s.value=!1}},getTestByCode:async f=>{var n,o;s.value=!0,t.value="";try{return{success:!0,test:await N.getTestByCode(f),message:"Prueba encontrada"}}catch(a){const v=((o=(n=a.response)==null?void 0:n.data)==null?void 0:o.message)||a.message||"Prueba no encontrada";return t.value=v,{success:!1,error:v}}finally{s.value=!1}},clearState:()=>{t.value=""}}}const ae={class:"test-combobox"},le={key:0,class:"block text-sm font-medium text-gray-700 mb-1"},oe={key:0,class:"text-red-500 ml-1"},ne={class:"relative"},ue={class:"relative"},ie=["placeholder","disabled"],ce={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},de={key:1,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},ve={key:0,class:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"},pe={key:0,class:"px-3 py-2 text-sm text-gray-500 text-center"},fe={key:1,class:"px-3 py-2 text-sm text-gray-500 text-center"},me=["onClick","onMouseenter"],ye={class:"flex items-center justify-between"},be={class:"flex flex-col"},ge={class:"font-medium"},he={class:"flex items-center gap-2 text-xs text-gray-500"},xe={key:0,class:"text-blue-600"},we={key:0,class:"text-xs text-gray-400 mt-1"},ke={key:0,class:"h-4 w-4 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20"},Te={key:1,class:"mt-1 text-xs text-gray-500"},_e={key:2,class:"mt-1 text-sm text-red-600"},Ae={key:3,class:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg"},Ce=J({__name:"TestList",props:{modelValue:{default:""},label:{default:""},placeholder:{default:"Buscar y seleccionar prueba..."},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},helpText:{default:""},errors:{default:()=>[]},autoLoad:{type:Boolean,default:!0}},emits:["update:modelValue","test-selected","load-error","load-success"],setup(g,{emit:s}){const t=g,l=s,{tests:k,loadTests:_,isLoading:L}=re(),f=x(),n=x(""),o=x(!1),a=x(-1),v=x(""),m=x(!1),y=x(t.modelValue),T=A(()=>Array.isArray(t.errors)?t.errors.join(", "):""),u=A(()=>Array.isArray(k.value)?k.value.filter(e=>e.isActive).map(e=>({value:e.pruebaCode,label:e.pruebasName,description:e.pruebasDescription,time:e.tiempo,test:e})):[]),b=A(()=>{if(!n.value.trim())return u.value;const e=n.value.toLowerCase().trim();return u.value.filter(r=>{var O;const p=r.label.toLowerCase(),C=r.test.pruebaCode.toLowerCase(),S=((O=r.description)==null?void 0:O.toLowerCase())||"";return p.includes(e)||C.includes(e)||S.includes(e)})}),V=A(()=>{if(!y.value)return null;const e=u.value.find(r=>r.value===y.value);return(e==null?void 0:e.test)||null}),$=A(()=>m.value?n.value:y.value&&V.value?V.value.pruebasName:n.value),z=()=>{m.value=!0,n.value="",o.value=!0,a.value=-1},F=()=>{setTimeout(()=>{m.value=!1,o.value=!1,y.value||(n.value="")},150)},j=()=>{var e,r;t.disabled||(o.value?(e=f.value)==null||e.blur():(r=f.value)==null||r.focus())},D=e=>{var r;y.value=e.value,n.value="",o.value=!1,a.value=-1,l("update:modelValue",e.value),l("test-selected",e.test),(r=f.value)==null||r.blur()},R=e=>{var r;if(!t.disabled)switch(e.key){case"ArrowDown":e.preventDefault(),o.value||(o.value=!0),a.value=Math.min(a.value+1,b.value.length-1);break;case"ArrowUp":e.preventDefault(),o.value&&(a.value=Math.max(a.value-1,-1));break;case"Enter":e.preventDefault(),o.value&&a.value>=0&&b.value[a.value]&&D(b.value[a.value]);break;case"Escape":e.preventDefault(),o.value=!1,a.value=-1,(r=f.value)==null||r.blur();break;case"Tab":o.value=!1;break}},q=async()=>{try{v.value="";const e=await _();e.success?l("load-success",k.value):(v.value=e.error||"Error al cargar pruebas",l("load-error",v.value))}catch(e){const r="Error al cargar la lista de pruebas";v.value=r,l("load-error",r),console.error("Error al recargar pruebas:",e)}};return E(()=>t.modelValue,e=>{y.value=e||""},{immediate:!0}),E(y,e=>{e!==t.modelValue&&l("update:modelValue",e)}),E(n,()=>{m.value&&n.value.trim()&&(o.value=!0,a.value=-1)}),G(async()=>{t.autoLoad&&k.value.length===0&&await q()}),E([$,m],()=>{m.value||Z(()=>{n.value=$.value})}),(e,r)=>(d(),c("div",ae,[e.label?(d(),c("label",le,[H(w(e.label)+" ",1),e.required?(d(),c("span",oe,"*")):h("",!0)])):h("",!0),i("div",ne,[i("div",ue,[Q(i("input",{ref_key:"inputRef",ref:f,"onUpdate:modelValue":r[0]||(r[0]=p=>n.value=p),type:"text",placeholder:e.placeholder,disabled:e.disabled,class:M(["w-full px-3 py-2 pr-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-colors bg-white appearance-none",T.value?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300",e.disabled?"bg-gray-50 text-gray-500 cursor-not-allowed":"text-gray-900"]),onFocus:z,onBlur:F,onKeydown:R,autocomplete:"off"},null,42,ie),[[W,n.value]]),P(L)?(d(),c("div",ce,[...r[1]||(r[1]=[i("svg",{class:"animate-spin h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24"},[i("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),i("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):(d(),c("div",de,[(d(),c("svg",{class:M(["h-4 w-4 text-gray-400 cursor-pointer transition-transform",{"transform rotate-180":o.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:j},[...r[2]||(r[2]=[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]))]),o.value&&!e.disabled?(d(),c("div",ve,[P(L)?(d(),c("div",pe," Cargando pruebas... ")):b.value.length===0?(d(),c("div",fe,w(n.value.trim()?"No se encontraron pruebas":"No hay pruebas disponibles"),1)):h("",!0),(d(!0),c(X,null,Y(b.value,(p,C)=>(d(),c("div",{key:p.value,class:M(["px-3 py-2 text-sm cursor-pointer transition-colors",C===a.value?"bg-blue-50 text-blue-900":"text-gray-900 hover:bg-gray-100",y.value===p.value?"bg-blue-100 text-blue-900 font-medium":""]),onClick:S=>D(p),onMouseenter:S=>a.value=C},[i("div",ye,[i("div",be,[i("span",ge,w(p.label),1),i("div",he,[i("span",null,w(p.test.pruebaCode),1),p.test.tiempo?(d(),c("span",xe,w(p.test.tiempo)+" d칤a"+w(p.test.tiempo!==1?"s":""),1)):h("",!0)]),p.description?(d(),c("span",we,w(p.description),1)):h("",!0)]),y.value===p.value?(d(),c("svg",ke,[...r[3]||(r[3]=[i("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):h("",!0)])],42,me))),128))])):h("",!0)]),e.helpText?(d(),c("p",Te,w(e.helpText),1)):h("",!0),T.value?(d(),c("p",_e,w(T.value),1)):h("",!0),v.value?(d(),c("div",Ae,[i("div",{class:"flex items-center"},[r[5]||(r[5]=i("svg",{class:"w-5 h-5 text-amber-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),i("div",null,[r[4]||(r[4]=i("p",{class:"text-sm text-amber-800"},"No se pudieron cargar las pruebas.",-1)),i("button",{onClick:q,class:"mt-1 text-sm text-amber-700 hover:text-amber-800 underline font-medium"}," Intentar cargar nuevamente ")])])])):h("",!0)]))}}),Ne=te(Ce,[["__scopeId","data-v-432a8441"]]);export{Ne as T};
