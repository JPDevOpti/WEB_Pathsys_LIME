<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Informe de resultados - {{ case.caso_code or case.id }}</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, Helvetica, sans-serif; color:#000; margin:0; padding:0; }
    .page { width: 210mm; min-height: 297mm; padding: 2mm 15mm 15mm 15mm; margin: 0 auto; background: white; }
    
    /* Header Section */
    .header-container { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 0; }
    .logos-section { 
      border: 2px solid #000; 
      padding: 3mm; 
      display: flex; 
      align-items: center; 
      justify-content: space-around; 
      gap: 4mm; 
      flex: 1; 
      height: 18mm;
    }
    .logo { height: 12mm; width: auto; object-fit: contain; }
    .code-box { 
      border: 2px solid #000; 
      padding: 0; 
      text-align: center; 
      font-size: 9px; 
      font-weight: bold;
      min-width: 25mm;
      height: 18mm;
      display: flex;
      flex-direction: column;
    }
    .code-row { 
      display: flex; 
      justify-content: flex-start; 
      align-items: center;
      padding: 0 3mm;
      flex: 1;
      gap: 3mm;
    }
    .code-row:first-child {
      border-bottom: 1px solid #000;
    }
    
    /* Title Bar */
    .title-bar { 
      text-align: center; 
      font-weight: bold; 
      font-size: 12px; 
      letter-spacing: 0.5px; 
      border: 2px solid #000; 
      padding: 3mm 0; 
      margin: 0; 
      background: white;
    }
    
    /* Department and Info Section */
    .dept-info-container { display: flex; gap: 0; margin: 0; }
    .dept-section { 
      flex: 1; 
      border: 2px solid #000; 
      padding: 4mm; 
    }
    .dept-header { display: flex; align-items: center; gap: 1mm; margin-bottom: 1mm; }
    .dept-icon { 
      width: 4mm; 
      height: 4mm; 
      fill: #000;
    }
    .dept-title { font-weight: bold; font-size: 11px; }
    .dept-address { font-size: 9px; line-height: 1.3; }
    
    .info-section { 
      width: 80mm; 
      border: 2px solid #000; 
      padding: 0; 
    }
    .info-header { 
      background: #f0f0f0; 
      padding: 2mm 4mm; 
      font-weight: bold; 
      font-size: 10px; 
      border-bottom: 1px solid #000; 
    }
    .info-row { 
      display: flex; 
      align-items: center;
      padding: 0.5mm 4mm; 
      border-bottom: 1px solid #ccc; 
      font-size: 9px; 
      height: 8mm;
    }
    .info-row:last-child { border-bottom: none; }
    .info-label { font-weight: bold; width: 30mm; margin-right: 2mm; }
    .info-value { flex: 1; min-height: 3mm; }
    
    /* Patient Info Table */
    .patient-table { 
      width: 100%; 
      border-collapse: collapse; 
      margin: 4mm 0; 
      font-size: 10px; 
    }
    .patient-table td { 
      padding: 2mm 3mm; 
      border-bottom: 1px solid #ccc; 
      vertical-align: top; 
    }
    .patient-label { font-weight: bold; width: 35%; }
    .patient-value { width: 65%; }
    
    /* Content Sections */
    .section-title { 
      font-size: 11px; 
      font-weight: bold; 
      margin: 6mm 0 2mm 0; 
      text-transform: uppercase; 
    }
    .content-box { 
      border: 2px solid #000; 
      padding: 4mm; 
      min-height: 25mm; 
      font-size: 10px; 
      line-height: 1.4; 
      word-wrap: break-word; 
      overflow-wrap: anywhere; 
      white-space: pre-wrap; 
    }
    .content-box.large { min-height: 35mm; }
    .content-box.small { min-height: 15mm; }
    
    /* Signature Section */
    .signature-section { 
      margin-top: 8mm; 
      font-size: 10px; 
    }
    .signature-line { 
      border-top: 1px solid #000; 
      width: 60mm; 
      margin: 6mm 0 2mm 0; 
    }
    .signature-label { font-weight: bold; }
    
    /* Footer */
    .footer { 
      margin-top: auto; 
      padding-top: 6mm; 
      font-size: 8px; 
      color: #666; 
    }
    .footer-note { margin-bottom: 2mm; }
    .page-number { text-align: right; font-weight: bold; }
    
    /* Utility Classes */
    .bold { font-weight: bold; }
    .small { font-size: 9px; }
    .center { text-align: center; }
    .nowrap { white-space: nowrap; }
  </style>
</head>
<body>
  <div class="page">
    <!-- Header with logos and code -->
    <div class="header-container">
      <div class="logos-section">
        <img src="http://localhost:5174/src/assets/images/Logo-LIME-NoFondo.png" alt="LIME" class="logo" />
        <img src="http://localhost:5174/src/assets/images/Banner_UDEA.png" alt="Universidad de Antioquia" class="logo" />
        <img src="http://localhost:5174/src/assets/images/Baner_HAMA.png" alt="Hospital AlmaMáter" class="logo" />
      </div>
      <div class="code-box">
        <div class="code-row">
          <span>Código:</span>
          <span>F-025-LIME</span>
        </div>
        <div class="code-row">
          <span>Versión:</span>
          <span>05</span>
        </div>
      </div>
    </div>

    <!-- Title Bar -->
    <div class="title-bar">INFORME DE RESULTADOS ANATOMOPATOLÓGICOS</div>

    <!-- Department Info and Case Info -->
    <div class="dept-info-container">
      <div class="dept-section">
        <div class="dept-header">
          <svg class="dept-icon" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
            <path d="M28.292 1.326C27.226 1.116 26.127 1 25 1c-4.71 0-8.98 1.93-12.06 5.04l6.92 5.592L28.292 1.326zM18.595 13.178L11.62 7.55C9.35 10.43 8 14.07 8 18c0 2.281.452 4.487 1.304 6.534L18.595 13.178zM22.608 11.432C23.353 11.159 24.154 11 25 11c3.87 0 7 3.13 7 7 0 .338-.032.667-.078.992l7.772-9.499c-2.058-3.539-5.348-6.268-9.285-7.595L22.608 11.432zM27.341 24.591C26.608 24.851 25.822 25 25 25c-3.87 0-7-3.13-7-7 0-.354.034-.7.084-1.039l-7.803 9.537c.386.666.809 1.315 1.289 1.932.37.5.87 1.14 1.45 1.89 1.267 1.633 2.959 3.816 4.59 6.164L27.341 24.591zM18.778 38.215c2.082 3.184 3.852 6.497 4.172 9.055.14.99.99 1.73 1.99 1.73 1.02 0 1.87-.75 1.99-1.75.61-4.83 6.57-12.48 9.78-16.6.56-.72 1.05-1.35 1.5-1.94C40.65 25.69 42 21.89 42 18c0-2.322-.471-4.536-1.319-6.555L18.778 38.215z"/>
          </svg>
          <div class="dept-title">Departamento de Patología</div>
        </div>
        <div class="dept-address">
          Hospital San Vicente Fundación<br/>
          Calle 64 Carrera 51D. Bloque 13<br/>
          Tel. 6042192400
        </div>
      </div>
      
      <div class="info-section">
        <div class="info-header">
          Informe No {{ case.caso_code or case.id }}
        </div>
        <div class="info-row">
          <span class="info-label">Fecha de Recibo:</span>
          <div class="info-value">
            {% if case.fecha_creacion %}
              {% set fecha = case.fecha_creacion %}
              {% if fecha.strftime %}
                {{ fecha.strftime('%A %d de %B, %Y')|replace('Monday', 'Lunes')|replace('Tuesday', 'Martes')|replace('Wednesday', 'Miércoles')|replace('Thursday', 'Jueves')|replace('Friday', 'Viernes')|replace('Saturday', 'Sábado')|replace('Sunday', 'Domingo')|replace('January', 'enero')|replace('February', 'febrero')|replace('March', 'marzo')|replace('April', 'abril')|replace('May', 'mayo')|replace('June', 'junio')|replace('July', 'julio')|replace('August', 'agosto')|replace('September', 'septiembre')|replace('October', 'octubre')|replace('November', 'noviembre')|replace('December', 'diciembre') }}
              {% else %}
                {{ fecha[:10] }}
              {% endif %}
            {% else %}
              Haga clic aquí para escribir una fecha.
            {% endif %}
          </div>
        </div>
        <div class="info-row">
          <span class="info-label">Fecha de Informe:</span>
          <div class="info-value">
            {% if case.fecha_firma %}
              {% set fecha = case.fecha_firma %}
              {% if fecha.strftime %}
                {{ fecha.strftime('%A %d de %B, %Y')|replace('Monday', 'Lunes')|replace('Tuesday', 'Martes')|replace('Wednesday', 'Miércoles')|replace('Thursday', 'Jueves')|replace('Friday', 'Viernes')|replace('Saturday', 'Sábado')|replace('Sunday', 'Domingo')|replace('January', 'enero')|replace('February', 'febrero')|replace('March', 'marzo')|replace('April', 'abril')|replace('May', 'mayo')|replace('June', 'junio')|replace('July', 'julio')|replace('August', 'agosto')|replace('September', 'septiembre')|replace('October', 'octubre')|replace('November', 'noviembre')|replace('December', 'diciembre') }}
              {% else %}
                {{ fecha[:10] }}
              {% endif %}
            {% elif case.fecha_entrega %}
              {% set fecha = case.fecha_entrega %}
              {% if fecha.strftime %}
                {{ fecha.strftime('%A %d de %B, %Y')|replace('Monday', 'Lunes')|replace('Tuesday', 'Martes')|replace('Wednesday', 'Miércoles')|replace('Thursday', 'Jueves')|replace('Friday', 'Viernes')|replace('Saturday', 'Sábado')|replace('Sunday', 'Domingo')|replace('January', 'enero')|replace('February', 'febrero')|replace('March', 'marzo')|replace('April', 'abril')|replace('May', 'mayo')|replace('June', 'junio')|replace('July', 'julio')|replace('August', 'agosto')|replace('September', 'septiembre')|replace('October', 'octubre')|replace('November', 'noviembre')|replace('December', 'diciembre') }}
              {% else %}
                {{ fecha[:10] }}
              {% endif %}
            {% else %}
              Haga clic aquí para escribir una fecha.
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Patient Information -->
    <table class="patient-table" style="margin-top: 0;">
      <tr>
        <td class="patient-label">Documento de identidad N°:</td>
        <td class="patient-value">{{ case.paciente.paciente_code if case.paciente else '' }}</td>
      </tr>
      <tr>
        <td class="patient-label">Paciente:</td>
        <td class="patient-value">{{ case.paciente.nombre if case.paciente else '' }}</td>
      </tr>
      <tr>
        <td class="patient-label">Edad:</td>
        <td class="patient-value">
          {{ case.paciente.edad if case.paciente else 'Elija un elemento.' }}
          &nbsp;&nbsp;<span class="bold">Sexo:</span> {{ case.paciente.sexo if case.paciente else 'Elija un elemento.' }}
          &nbsp;&nbsp;<span class="bold">Teléfono:</span> {{ case.paciente.telefono if case.paciente and case.paciente.telefono else '' }}
        </td>
      </tr>
      <tr>
        <td class="patient-label">Institución:</td>
        <td class="patient-value">
          {{ case.paciente.entidad_info.nombre if case.paciente and case.paciente.entidad_info else 'Elija un elemento.' }}
          &nbsp;&nbsp;<span class="bold">Servicio:</span> {{ case.servicio or '' }}
          &nbsp;&nbsp;<span class="bold">Recibo N°:</span> {{ case.recibo or '' }}
        </td>
      </tr>
      <tr>
        <td class="patient-label">Médico Remitente:</td>
        <td class="patient-value">{{ case.medico_solicitante.nombre if case.medico_solicitante and case.medico_solicitante.nombre else (case.medico_solicitante or '') }}</td>
      </tr>
    </table>

    <!-- Sample Section -->
    <div class="section-title">MUESTRA:</div>
    <div style="border-bottom: 1px solid #000; margin-bottom: 4mm;"></div>
    {% if case.muestras %}
      <div style="margin: 2mm 0; font-size: 10px;">
        {% for m in case.muestras %}
          • {{ m.region_cuerpo or '—' }}{% if m.pruebas and m.pruebas|length %}: {% for p in m.pruebas %}{{ p.id }} - {{ p.nombre or p.id }}{% if not loop.last %}, {% endif %}{% endfor %}{% endif %}<br/>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Macroscopic Description -->
    <div class="section-title">DESCRIPCIÓN MACROSCÓPICA</div>
    <div class="content-box large">{{ case.resultado.resultado_macro if case.resultado and case.resultado.resultado_macro else '' }}</div>

    <!-- Microscopic Description -->
    <div class="section-title">DESCRIPCIÓN MICROSCÓPICA</div>
    <div class="content-box large">{{ case.resultado.resultado_micro if case.resultado and case.resultado.resultado_micro else '' }}</div>

    <!-- Method -->
    <div class="section-title">MÉTODO UTILIZADO:</div>
    <div class="content-box small">
      {% if case.resultado and case.resultado.metodo %}
        {% if case.resultado.metodo is iterable and case.resultado.metodo is not string %}
          {{ case.resultado.metodo|join(', ') }}
        {% else %}
          {{ case.resultado.metodo }}
        {% endif %}
      {% else %}
        Elija un elemento.
      {% endif %}
    </div>

    <!-- Diagnosis -->
    <div class="section-title">DIAGNÓSTICO:</div>
    <div class="content-box">
      {% if case.resultado %}
        {% if case.resultado.diagnostico_cie10 and case.resultado.diagnostico_cie10.codigo %}
          <div><span class="bold">CIE-10:</span> {{ case.resultado.diagnostico_cie10.codigo }} - {{ case.resultado.diagnostico_cie10.nombre }}</div>
        {% endif %}
        {% if case.resultado.diagnostico_cieo and case.resultado.diagnostico_cieo.codigo %}
          <div><span class="bold">CIE-O:</span> {{ case.resultado.diagnostico_cieo.codigo }} - {{ case.resultado.diagnostico_cieo.nombre }}</div>
        {% endif %}
        <div>{{ case.resultado.diagnostico or '' }}</div>
      {% endif %}
    </div>

    <!-- Signature -->
    <div class="signature-section">
      <div class="signature-line"></div>
      <div><span class="signature-label">Médico Patólogo:</span> {{ case.patologo_asignado.nombre if case.patologo_asignado else '' }}</div>
      <div class="small" style="margin-top: 2mm; font-style: italic;">Digitado por:</div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <div class="footer-note">Los informes de resultados, las placas y bloques de estudios anatomopatológicos se archivan por 15 años</div>
      <div class="page-number">Página 1 de 1</div>
    </div>
  </div>
</body>
</html>


